/* Wishlist King SDK 4.0.0 */
var ks=Object.create;var sn=Object.defineProperty;var Fs=Object.getOwnPropertyDescriptor;var Ks=Object.getOwnPropertyNames;var js=Object.getPrototypeOf,Ls=Object.prototype.hasOwnProperty;var an=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Ns=(t,e)=>{for(var r in e)sn(t,r,{get:e[r],enumerable:!0})},Bs=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Ks(e))!Ls.call(t,i)&&i!==r&&sn(t,i,{get:()=>e[i],enumerable:!(n=Fs(e,i))||n.enumerable});return t};var or=(t,e,r)=>(r=t!=null?ks(js(t)):{},Bs(e||!t||!t.__esModule?sn(r,"default",{value:t,enumerable:!0}):r,t));var Xi=an((mu,cr)=>{var Oi,Ri,Ui,Mi,Di,ki,Fi,Ki,ji,sr,cn,Li,Ni,Bi,Ge,Vi,$i,qi,Hi,Yi,zi,Gi,Ji,Qi,ar;(function(t){var e=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:{};typeof define=="function"&&define.amd?define("tslib",["exports"],function(n){t(r(e,r(n)))}):typeof cr=="object"&&typeof cr.exports=="object"?t(r(e,r(cr.exports))):t(r(e));function r(n,i){return n!==e&&(typeof Object.create=="function"?Object.defineProperty(n,"__esModule",{value:!0}):n.__esModule=!0),function(o,s){return n[o]=i?i(o,s):s}}})(function(t){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])};Oi=function(n,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");e(n,i);function o(){this.constructor=n}n.prototype=i===null?Object.create(i):(o.prototype=i.prototype,new o)},Ri=Object.assign||function(n){for(var i,o=1,s=arguments.length;o<s;o++){i=arguments[o];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},Ui=function(n,i){var o={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&i.indexOf(s)<0&&(o[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,s=Object.getOwnPropertySymbols(n);a<s.length;a++)i.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(n,s[a])&&(o[s[a]]=n[s[a]]);return o},Mi=function(n,i,o,s){var a=arguments.length,c=a<3?i:s===null?s=Object.getOwnPropertyDescriptor(i,o):s,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(n,i,o,s);else for(var l=n.length-1;l>=0;l--)(u=n[l])&&(c=(a<3?u(c):a>3?u(i,o,c):u(i,o))||c);return a>3&&c&&Object.defineProperty(i,o,c),c},Di=function(n,i){return function(o,s){i(o,s,n)}},ki=function(n,i){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,i)},Fi=function(n,i,o,s){function a(c){return c instanceof o?c:new o(function(u){u(c)})}return new(o||(o=Promise))(function(c,u){function l(h){try{f(s.next(h))}catch(g){u(g)}}function d(h){try{f(s.throw(h))}catch(g){u(g)}}function f(h){h.done?c(h.value):a(h.value).then(l,d)}f((s=s.apply(n,i||[])).next())})},Ki=function(n,i){var o={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},s,a,c,u;return u={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function l(f){return function(h){return d([f,h])}}function d(f){if(s)throw new TypeError("Generator is already executing.");for(;o;)try{if(s=1,a&&(c=f[0]&2?a.return:f[0]?a.throw||((c=a.return)&&c.call(a),0):a.next)&&!(c=c.call(a,f[1])).done)return c;switch(a=0,c&&(f=[f[0]&2,c.value]),f[0]){case 0:case 1:c=f;break;case 4:return o.label++,{value:f[1],done:!1};case 5:o.label++,a=f[1],f=[0];continue;case 7:f=o.ops.pop(),o.trys.pop();continue;default:if(c=o.trys,!(c=c.length>0&&c[c.length-1])&&(f[0]===6||f[0]===2)){o=0;continue}if(f[0]===3&&(!c||f[1]>c[0]&&f[1]<c[3])){o.label=f[1];break}if(f[0]===6&&o.label<c[1]){o.label=c[1],c=f;break}if(c&&o.label<c[2]){o.label=c[2],o.ops.push(f);break}c[2]&&o.ops.pop(),o.trys.pop();continue}f=i.call(n,o)}catch(h){f=[6,h],a=0}finally{s=c=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}},ji=function(n,i){for(var o in n)o!=="default"&&!Object.prototype.hasOwnProperty.call(i,o)&&ar(i,n,o)},ar=Object.create?function(n,i,o,s){s===void 0&&(s=o);var a=Object.getOwnPropertyDescriptor(i,o);(!a||("get"in a?!i.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return i[o]}}),Object.defineProperty(n,s,a)}:function(n,i,o,s){s===void 0&&(s=o),n[s]=i[o]},sr=function(n){var i=typeof Symbol=="function"&&Symbol.iterator,o=i&&n[i],s=0;if(o)return o.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&s>=n.length&&(n=void 0),{value:n&&n[s++],done:!n}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")},cn=function(n,i){var o=typeof Symbol=="function"&&n[Symbol.iterator];if(!o)return n;var s=o.call(n),a,c=[],u;try{for(;(i===void 0||i-- >0)&&!(a=s.next()).done;)c.push(a.value)}catch(l){u={error:l}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(u)throw u.error}}return c},Li=function(){for(var n=[],i=0;i<arguments.length;i++)n=n.concat(cn(arguments[i]));return n},Ni=function(){for(var n=0,i=0,o=arguments.length;i<o;i++)n+=arguments[i].length;for(var s=Array(n),a=0,i=0;i<o;i++)for(var c=arguments[i],u=0,l=c.length;u<l;u++,a++)s[a]=c[u];return s},Bi=function(n,i,o){if(o||arguments.length===2)for(var s=0,a=i.length,c;s<a;s++)(c||!(s in i))&&(c||(c=Array.prototype.slice.call(i,0,s)),c[s]=i[s]);return n.concat(c||Array.prototype.slice.call(i))},Ge=function(n){return this instanceof Ge?(this.v=n,this):new Ge(n)},Vi=function(n,i,o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=o.apply(n,i||[]),a,c=[];return a={},u("next"),u("throw"),u("return"),a[Symbol.asyncIterator]=function(){return this},a;function u(p){s[p]&&(a[p]=function(b){return new Promise(function(y,x){c.push([p,b,y,x])>1||l(p,b)})})}function l(p,b){try{d(s[p](b))}catch(y){g(c[0][3],y)}}function d(p){p.value instanceof Ge?Promise.resolve(p.value.v).then(f,h):g(c[0][2],p)}function f(p){l("next",p)}function h(p){l("throw",p)}function g(p,b){p(b),c.shift(),c.length&&l(c[0][0],c[0][1])}},$i=function(n){var i,o;return i={},s("next"),s("throw",function(a){throw a}),s("return"),i[Symbol.iterator]=function(){return this},i;function s(a,c){i[a]=n[a]?function(u){return(o=!o)?{value:Ge(n[a](u)),done:a==="return"}:c?c(u):u}:c}},qi=function(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=n[Symbol.asyncIterator],o;return i?i.call(n):(n=typeof sr=="function"?sr(n):n[Symbol.iterator](),o={},s("next"),s("throw"),s("return"),o[Symbol.asyncIterator]=function(){return this},o);function s(c){o[c]=n[c]&&function(u){return new Promise(function(l,d){u=n[c](u),a(l,d,u.done,u.value)})}}function a(c,u,l,d){Promise.resolve(d).then(function(f){c({value:f,done:l})},u)}},Hi=function(n,i){return Object.defineProperty?Object.defineProperty(n,"raw",{value:i}):n.raw=i,n};var r=Object.create?function(n,i){Object.defineProperty(n,"default",{enumerable:!0,value:i})}:function(n,i){n.default=i};Yi=function(n){if(n&&n.__esModule)return n;var i={};if(n!=null)for(var o in n)o!=="default"&&Object.prototype.hasOwnProperty.call(n,o)&&ar(i,n,o);return r(i,n),i},zi=function(n){return n&&n.__esModule?n:{default:n}},Gi=function(n,i,o,s){if(o==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof i=="function"?n!==i||!s:!i.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return o==="m"?s:o==="a"?s.call(n):s?s.value:i.get(n)},Ji=function(n,i,o,s,a){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof i=="function"?n!==i||!a:!i.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?a.call(n,o):a?a.value=o:i.set(n,o),o},Qi=function(n,i){if(i===null||typeof i!="object"&&typeof i!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof n=="function"?i===n:n.has(i)},t("__extends",Oi),t("__assign",Ri),t("__rest",Ui),t("__decorate",Mi),t("__param",Di),t("__metadata",ki),t("__awaiter",Fi),t("__generator",Ki),t("__exportStar",ji),t("__createBinding",ar),t("__values",sr),t("__read",cn),t("__spread",Li),t("__spreadArrays",Ni),t("__spreadArray",Bi),t("__await",Ge),t("__asyncGenerator",Vi),t("__asyncDelegator",$i),t("__asyncValues",qi),t("__makeTemplateObject",Hi),t("__importStar",Yi),t("__importDefault",zi),t("__classPrivateFieldGet",Gi),t("__classPrivateFieldSet",Ji),t("__classPrivateFieldIn",Qi)})});var ko=an((nd,Do)=>{"use strict";var da=function(){function t(r,n){if(typeof r!="function")throw new TypeError("DataLoader must be constructed with a function which accepts "+("Array<key> and returns Promise<Array<value>>, but got: "+r+"."));this._batchLoadFn=r,this._maxBatchSize=va(n),this._batchScheduleFn=ba(n),this._cacheKeyFn=_a(n),this._cacheMap=wa(n),this._batch=null}var e=t.prototype;return e.load=function(n){if(n==null)throw new TypeError("The loader.load() function must be called with a value, "+("but got: "+String(n)+"."));var i=ya(this),o=this._cacheMap,s=this._cacheKeyFn(n);if(o){var a=o.get(s);if(a){var c=i.cacheHits||(i.cacheHits=[]);return new Promise(function(l){c.push(function(){l(a)})})}}i.keys.push(n);var u=new Promise(function(l,d){i.callbacks.push({resolve:l,reject:d})});return o&&o.set(s,u),u},e.loadMany=function(n){if(!Mo(n))throw new TypeError("The loader.loadMany() function must be called with Array<key> "+("but got: "+n+"."));for(var i=[],o=0;o<n.length;o++)i.push(this.load(n[o]).catch(function(s){return s}));return Promise.all(i)},e.clear=function(n){var i=this._cacheMap;if(i){var o=this._cacheKeyFn(n);i.delete(o)}return this},e.clearAll=function(){var n=this._cacheMap;return n&&n.clear(),this},e.prime=function(n,i){var o=this._cacheMap;if(o){var s=this._cacheKeyFn(n);if(o.get(s)===void 0){var a;i instanceof Error?(a=Promise.reject(i),a.catch(function(){})):a=Promise.resolve(i),o.set(s,a)}}return this},t}(),ma=typeof process=="object"&&typeof process.nextTick=="function"?function(t){In||(In=Promise.resolve()),In.then(function(){process.nextTick(t)})}:typeof setImmediate=="function"?function(t){setImmediate(t)}:function(t){setTimeout(t)},In;function ya(t){var e=t._batch;if(e!==null&&!e.hasDispatched&&e.keys.length<t._maxBatchSize&&(!e.cacheHits||e.cacheHits.length<t._maxBatchSize))return e;var r={hasDispatched:!1,keys:[],callbacks:[]};return t._batch=r,t._batchScheduleFn(function(){ga(t,r)}),r}function ga(t,e){if(e.hasDispatched=!0,e.keys.length===0){Sn(e);return}var r=t._batchLoadFn(e.keys);if(!r||typeof r.then!="function")return Uo(t,e,new TypeError("DataLoader must be constructed with a function which accepts Array<key> and returns Promise<Array<value>>, but the function did "+("not return a Promise: "+String(r)+".")));r.then(function(n){if(!Mo(n))throw new TypeError("DataLoader must be constructed with a function which accepts Array<key> and returns Promise<Array<value>>, but the function did "+("not return a Promise of an Array: "+String(n)+"."));if(n.length!==e.keys.length)throw new TypeError("DataLoader must be constructed with a function which accepts Array<key> and returns Promise<Array<value>>, but the function did not return a Promise of an Array of the same length as the Array of keys."+(`

Keys:
`+String(e.keys))+(`

Values:
`+String(n)));Sn(e);for(var i=0;i<e.callbacks.length;i++){var o=n[i];o instanceof Error?e.callbacks[i].reject(o):e.callbacks[i].resolve(o)}}).catch(function(n){Uo(t,e,n)})}function Uo(t,e,r){Sn(e);for(var n=0;n<e.keys.length;n++)t.clear(e.keys[n]),e.callbacks[n].reject(r)}function Sn(t){if(t.cacheHits)for(var e=0;e<t.cacheHits.length;e++)t.cacheHits[e]()}function va(t){var e=!t||t.batch!==!1;if(!e)return 1;var r=t&&t.maxBatchSize;if(r===void 0)return 1/0;if(typeof r!="number"||r<1)throw new TypeError("maxBatchSize must be a positive number: "+r);return r}function ba(t){var e=t&&t.batchScheduleFn;if(e===void 0)return ma;if(typeof e!="function")throw new TypeError("batchScheduleFn must be a function: "+e);return e}function _a(t){var e=t&&t.cacheKeyFn;if(e===void 0)return function(r){return r};if(typeof e!="function")throw new TypeError("cacheKeyFn must be a function: "+e);return e}function wa(t){var e=!t||t.cache!==!1;if(!e)return null;var r=t&&t.cacheMap;if(r===void 0)return new Map;if(r!==null){var n=["get","set","delete","clear"],i=n.filter(function(o){return r&&typeof r[o]!="function"});if(i.length!==0)throw new TypeError("Custom cacheMap missing methods: "+i.join(", "))}return r}function Mo(t){return typeof t=="object"&&t!==null&&typeof t.length=="number"&&(t.length===0||t.length>0&&Object.prototype.hasOwnProperty.call(t,t.length-1))}Do.exports=da});var Ii=an((nm,xi)=>{var wi=(()=>{var t=Object.defineProperty,e=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,i=(g,p,b)=>p in g?t(g,p,{enumerable:!0,configurable:!0,writable:!0,value:b}):g[p]=b,o=(g,p)=>{for(var b in p||(p={}))r.call(p,b)&&i(g,b,p[b]);if(e)for(var b of e(p))n.call(p,b)&&i(g,b,p[b]);return g},s=g=>t(g,"__esModule",{value:!0}),a=(g,p)=>{s(g);for(var b in p)t(g,b,{get:p[b],enumerable:!0})},c={};a(c,{DEFAULT_UUID_LENGTH:()=>l,default:()=>h});var u="4.4.4",l=6,d={dictionary:"alphanum",shuffle:!0,debug:!1,length:l},f=class extends Function{constructor(g={}){super(),this.dictIndex=0,this.dictRange=[],this.lowerBound=0,this.upperBound=0,this.dictLength=0,this._digit_first_ascii=48,this._digit_last_ascii=58,this._alpha_lower_first_ascii=97,this._alpha_lower_last_ascii=123,this._hex_last_ascii=103,this._alpha_upper_first_ascii=65,this._alpha_upper_last_ascii=91,this._number_dict_ranges={digits:[this._digit_first_ascii,this._digit_last_ascii]},this._alpha_dict_ranges={lowerCase:[this._alpha_lower_first_ascii,this._alpha_lower_last_ascii],upperCase:[this._alpha_upper_first_ascii,this._alpha_upper_last_ascii]},this._alpha_lower_dict_ranges={lowerCase:[this._alpha_lower_first_ascii,this._alpha_lower_last_ascii]},this._alpha_upper_dict_ranges={upperCase:[this._alpha_upper_first_ascii,this._alpha_upper_last_ascii]},this._alphanum_dict_ranges={digits:[this._digit_first_ascii,this._digit_last_ascii],lowerCase:[this._alpha_lower_first_ascii,this._alpha_lower_last_ascii],upperCase:[this._alpha_upper_first_ascii,this._alpha_upper_last_ascii]},this._alphanum_lower_dict_ranges={digits:[this._digit_first_ascii,this._digit_last_ascii],lowerCase:[this._alpha_lower_first_ascii,this._alpha_lower_last_ascii]},this._alphanum_upper_dict_ranges={digits:[this._digit_first_ascii,this._digit_last_ascii],upperCase:[this._alpha_upper_first_ascii,this._alpha_upper_last_ascii]},this._hex_dict_ranges={decDigits:[this._digit_first_ascii,this._digit_last_ascii],alphaDigits:[this._alpha_lower_first_ascii,this._hex_last_ascii]},this.log=(...v)=>{let m=[...v];if(m[0]=`[short-unique-id] ${v[0]}`,this.debug===!0&&typeof console!="undefined"&&console!==null)return console.log(...m)},this.setDictionary=(v,m)=>{let w;if(v&&Array.isArray(v)&&v.length>1)w=v;else{w=[];let _;this.dictIndex=_=0;let I=`_${v}_dict_ranges`,E=this[I];Object.keys(E).forEach(W=>{let k=W;for(this.dictRange=E[k],this.lowerBound=this.dictRange[0],this.upperBound=this.dictRange[1],this.dictIndex=_=this.lowerBound;this.lowerBound<=this.upperBound?_<this.upperBound:_>this.upperBound;this.dictIndex=this.lowerBound<=this.upperBound?_+=1:_-=1)w.push(String.fromCharCode(this.dictIndex))})}m&&(w=w.sort(()=>Math.random()-.5)),this.dict=w,this.dictLength=this.dict.length,this.counter=0},this.seq=()=>this.sequentialUUID(),this.sequentialUUID=()=>{let v,m,w="";v=this.counter;do m=v%this.dictLength,v=Math.trunc(v/this.dictLength),w+=this.dict[m];while(v!==0);return this.counter+=1,w},this.randomUUID=(v=this.uuidLength||l)=>{let m,w,_;if(v===null||typeof v=="undefined"||v<1)throw new Error("Invalid UUID Length Provided");let I=v>=0;for(m="",_=0;_<v;_+=1)w=parseInt((Math.random()*this.dictLength).toFixed(0),10)%this.dictLength,m+=this.dict[w];return m},this.availableUUIDs=(v=this.uuidLength)=>parseFloat(Math.pow([...new Set(this.dict)].length,v).toFixed(0)),this.approxMaxBeforeCollision=(v=this.availableUUIDs(this.uuidLength))=>parseFloat(Math.sqrt(Math.PI/2*v).toFixed(20)),this.collisionProbability=(v=this.availableUUIDs(this.uuidLength),m=this.uuidLength)=>parseFloat((this.approxMaxBeforeCollision(v)/this.availableUUIDs(m)).toFixed(20)),this.uniqueness=(v=this.availableUUIDs(this.uuidLength))=>{let m=parseFloat((1-this.approxMaxBeforeCollision(v)/v).toFixed(20));return m>1?1:m<0?0:m},this.getVersion=()=>this.version,this.stamp=v=>{if(typeof v!="number"||v<10)throw new Error("Param finalLength must be number greater than 10");let m=Math.floor(+new Date/1e3).toString(16),w=v-9,_=Math.round(Math.random()*(w>15?15:w)),I=this.randomUUID(w);return`${I.substr(0,_)}${m}${I.substr(_)}${_.toString(16)}`},this.parseStamp=v=>{if(v.length<10)throw new Error("Stamp length invalid");let m=parseInt(v.substr(v.length-1,1),16);return new Date(parseInt(v.substr(m,8),16)*1e3)};let p=o(o({},d),g);this.counter=0,this.debug=!1,this.dict=[],this.version=u;let{dictionary:b,shuffle:y,length:x}=p;return this.uuidLength=x,this.setDictionary(b,y),this.debug=p.debug,this.log(this.dict),this.log(`Generator instantiated with Dictionary Size ${this.dictLength}`),new Proxy(this,{apply:(v,m,w)=>this.randomUUID(...w)})}},h=f;return h.default=f,c})();typeof xi!="undefined"&&(xi.exports=wi.default),typeof window!="undefined"&&(wi=wi.default)});var Zi=or(Xi(),1),{__extends:pe,__assign:un,__rest:eo,__decorate:yu,__param:gu,__metadata:vu,__awaiter:to,__generator:ur,__exportStar:bu,__createBinding:_u,__values:De,__read:z,__spread:wu,__spreadArrays:xu,__spreadArray:ee,__await:lr,__asyncGenerator:ro,__asyncDelegator:Iu,__asyncValues:no,__makeTemplateObject:Su,__importStar:Eu,__importDefault:Pu,__classPrivateFieldGet:Au,__classPrivateFieldSet:Tu,__classPrivateFieldIn:Wu}=Zi.default;function T(t){return typeof t=="function"}function Je(t){var e=function(n){Error.call(n),n.stack=new Error().stack},r=t(e);return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}var fr=Je(function(t){return function(r){t(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(n,i){return i+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r}});function wt(t,e){if(t){var r=t.indexOf(e);0<=r&&t.splice(r,1)}}var Qe=function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,r,n,i,o;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var a=De(s),c=a.next();!c.done;c=a.next()){var u=c.value;u.remove(this)}}catch(p){e={error:p}}finally{try{c&&!c.done&&(r=a.return)&&r.call(a)}finally{if(e)throw e.error}}else s.remove(this);var l=this.initialTeardown;if(T(l))try{l()}catch(p){o=p instanceof fr?p.errors:[p]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var f=De(d),h=f.next();!h.done;h=f.next()){var g=h.value;try{io(g)}catch(p){o=o!=null?o:[],p instanceof fr?o=ee(ee([],z(o)),z(p.errors)):o.push(p)}}}catch(p){n={error:p}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(n)throw n.error}}}if(o)throw new fr(o)}},t.prototype.add=function(e){var r;if(e&&e!==this)if(this.closed)io(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(r=this._finalizers)!==null&&r!==void 0?r:[]).push(e)}},t.prototype._hasParent=function(e){var r=this._parentage;return r===e||Array.isArray(r)&&r.includes(e)},t.prototype._addParent=function(e){var r=this._parentage;this._parentage=Array.isArray(r)?(r.push(e),r):r?[r,e]:e},t.prototype._removeParent=function(e){var r=this._parentage;r===e?this._parentage=null:Array.isArray(r)&&wt(r,e)},t.prototype.remove=function(e){var r=this._finalizers;r&&wt(r,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}();var ln=Qe.EMPTY;function hr(t){return t instanceof Qe||t&&"closed"in t&&T(t.remove)&&T(t.add)&&T(t.unsubscribe)}function io(t){T(t)?t():t.unsubscribe()}var fe={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var Xe={setTimeout:function(t,e){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i=Xe.delegate;return i!=null&&i.setTimeout?i.setTimeout.apply(i,ee([t,e],z(r))):setTimeout.apply(void 0,ee([t,e],z(r)))},clearTimeout:function(t){var e=Xe.delegate;return((e==null?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0};function pr(t){Xe.setTimeout(function(){var e=fe.onUnhandledError;if(e)e(t);else throw t})}function fn(){}var oo=function(){return hn("C",void 0,void 0)}();function so(t){return hn("E",void 0,t)}function ao(t){return hn("N",t,void 0)}function hn(t,e,r){return{kind:t,value:e,error:r}}var ke=null;function Ze(t){if(fe.useDeprecatedSynchronousErrorHandling){var e=!ke;if(e&&(ke={errorThrown:!1,error:null}),t(),e){var r=ke,n=r.errorThrown,i=r.error;if(ke=null,n)throw i}}else t()}function co(t){fe.useDeprecatedSynchronousErrorHandling&&ke&&(ke.errorThrown=!0,ke.error=t)}var xt=function(t){pe(e,t);function e(r){var n=t.call(this)||this;return n.isStopped=!1,r?(n.destination=r,hr(r)&&r.add(n)):n.destination=Hs,n}return e.create=function(r,n,i){return new Fe(r,n,i)},e.prototype.next=function(r){this.isStopped?dn(ao(r),this):this._next(r)},e.prototype.error=function(r){this.isStopped?dn(so(r),this):(this.isStopped=!0,this._error(r))},e.prototype.complete=function(){this.isStopped?dn(oo,this):(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(r){this.destination.next(r)},e.prototype._error=function(r){try{this.destination.error(r)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(Qe);var Vs=Function.prototype.bind;function pn(t,e){return Vs.call(t,e)}var $s=function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var r=this.partialObserver;if(r.next)try{r.next(e)}catch(n){dr(n)}},t.prototype.error=function(e){var r=this.partialObserver;if(r.error)try{r.error(e)}catch(n){dr(n)}else dr(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(r){dr(r)}},t}(),Fe=function(t){pe(e,t);function e(r,n,i){var o=t.call(this)||this,s;if(T(r)||!r)s={next:r!=null?r:void 0,error:n!=null?n:void 0,complete:i!=null?i:void 0};else{var a;o&&fe.useDeprecatedNextContext?(a=Object.create(r),a.unsubscribe=function(){return o.unsubscribe()},s={next:r.next&&pn(r.next,a),error:r.error&&pn(r.error,a),complete:r.complete&&pn(r.complete,a)}):s=r}return o.destination=new $s(s),o}return e}(xt);function dr(t){fe.useDeprecatedSynchronousErrorHandling?co(t):pr(t)}function qs(t){throw t}function dn(t,e){var r=fe.onStoppedNotification;r&&Xe.setTimeout(function(){return r(t,e)})}var Hs={closed:!0,next:fn,error:qs,complete:fn};function V(t,e,r,n,i){return new Ys(t,e,r,n,i)}var Ys=function(t){pe(e,t);function e(r,n,i,o,s,a){var c=t.call(this,r)||this;return c.onFinalize=s,c.shouldUnsubscribe=a,c._next=n?function(u){try{n(u)}catch(l){r.error(l)}}:t.prototype._next,c._error=o?function(u){try{o(u)}catch(l){r.error(l)}finally{this.unsubscribe()}}:t.prototype._error,c._complete=i?function(){try{i()}catch(u){r.error(u)}finally{this.unsubscribe()}}:t.prototype._complete,c}return e.prototype.unsubscribe=function(){var r;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;t.prototype.unsubscribe.call(this),!n&&((r=this.onFinalize)===null||r===void 0||r.call(this))}},e}(xt);var et=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Ae(t){return t}function mn(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return yn(t)}function yn(t){return t.length===0?Ae:t.length===1?t[0]:function(r){return t.reduce(function(n,i){return i(n)},r)}}var M=function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var r=new t;return r.source=this,r.operator=e,r},t.prototype.subscribe=function(e,r,n){var i=this,o=Gs(e)?e:new Fe(e,r,n);return Ze(function(){var s=i,a=s.operator,c=s.source;o.add(a?a.call(o,c):c?i._subscribe(o):i._trySubscribe(o))}),o},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(r){e.error(r)}},t.prototype.forEach=function(e,r){var n=this;return r=uo(r),new r(function(i,o){var s=new Fe({next:function(a){try{e(a)}catch(c){o(c),s.unsubscribe()}},error:o,complete:i});n.subscribe(s)})},t.prototype._subscribe=function(e){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(e)},t.prototype[et]=function(){return this},t.prototype.pipe=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return yn(e)(this)},t.prototype.toPromise=function(e){var r=this;return e=uo(e),new e(function(n,i){var o;r.subscribe(function(s){return o=s},function(s){return i(s)},function(){return n(o)})})},t.create=function(e){return new t(e)},t}();function uo(t){var e;return(e=t!=null?t:fe.Promise)!==null&&e!==void 0?e:Promise}function zs(t){return t&&T(t.next)&&T(t.error)&&T(t.complete)}function Gs(t){return t&&t instanceof xt||zs(t)&&hr(t)}var tt=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function mr(t){return T(t==null?void 0:t.then)}function yr(t){return T(t[et])}function gr(t){return Symbol.asyncIterator&&T(t==null?void 0:t[Symbol.asyncIterator])}function vr(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function Js(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var br=Js();function _r(t){return T(t==null?void 0:t[br])}function wr(t){return ro(this,arguments,function(){var r,n,i,o;return ur(this,function(s){switch(s.label){case 0:r=t.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,lr(r.read())];case 3:return n=s.sent(),i=n.value,o=n.done,o?[4,lr(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,lr(i)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return r.releaseLock(),[7];case 10:return[2]}})})}function xr(t){return T(t==null?void 0:t.getReader)}function L(t){if(t instanceof M)return t;if(t!=null){if(yr(t))return Qs(t);if(tt(t))return Xs(t);if(mr(t))return Zs(t);if(gr(t))return lo(t);if(_r(t))return ea(t);if(xr(t))return ta(t)}throw vr(t)}function Qs(t){return new M(function(e){var r=t[et]();if(T(r.subscribe))return r.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Xs(t){return new M(function(e){for(var r=0;r<t.length&&!e.closed;r++)e.next(t[r]);e.complete()})}function Zs(t){return new M(function(e){t.then(function(r){e.closed||(e.next(r),e.complete())},function(r){return e.error(r)}).then(null,pr)})}function ea(t){return new M(function(e){var r,n;try{for(var i=De(t),o=i.next();!o.done;o=i.next()){var s=o.value;if(e.next(s),e.closed)return}}catch(a){r={error:a}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}e.complete()})}function lo(t){return new M(function(e){ra(t,e).catch(function(r){return e.error(r)})})}function ta(t){return lo(wr(t))}function ra(t,e){var r,n,i,o;return to(this,void 0,void 0,function(){var s,a;return ur(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),r=no(t),c.label=1;case 1:return[4,r.next()];case 2:if(n=c.sent(),!!n.done)return[3,4];if(s=n.value,e.next(s),e.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),i={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),n&&!n.done&&(o=r.return)?[4,o.call(r)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function It(t,e){e===void 0&&(e={});var r=e.selector,n=eo(e,["selector"]);return new M(function(i){var o=new AbortController,s=o.signal,a=!0,c=n.signal;if(c)if(c.aborted)o.abort();else{var u=function(){s.aborted||o.abort()};c.addEventListener("abort",u),i.add(function(){return c.removeEventListener("abort",u)})}var l=un(un({},n),{signal:s}),d=function(f){a=!1,i.error(f)};return fetch(t,l).then(function(f){r?L(r(f)).subscribe(V(i,void 0,function(){a=!1,i.complete()},d)):(a=!1,i.next(f),i.complete())}).catch(d),function(){a&&o.abort()}})}function na(t){return T(t==null?void 0:t.lift)}function N(t){return function(e){if(na(e))return e.lift(function(r){try{return t(r,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}var gn={now:function(){return(gn.delegate||Date).now()},delegate:void 0};function fo(t){return t&&T(t.schedule)}function vn(t){return t[t.length-1]}function ho(t){return T(vn(t))?t.pop():void 0}function Te(t){return fo(vn(t))?t.pop():void 0}function po(t,e){return typeof vn(t)=="number"?t.pop():e}function se(t,e,r,n,i){n===void 0&&(n=0),i===void 0&&(i=!1);var o=e.schedule(function(){r(),i?t.add(this.schedule(null,n)):this.unsubscribe()},n);if(t.add(o),!i)return o}function G(t){return N(function(e,r){var n=null,i=!1,o;n=e.subscribe(V(r,void 0,void 0,function(s){o=L(t(s,G(t)(e))),n?(n.unsubscribe(),n=null,o.subscribe(r)):i=!0})),i&&(n.unsubscribe(),n=null,o.subscribe(r))})}var ia=Array.isArray,oa=Object.getPrototypeOf,sa=Object.prototype,aa=Object.keys;function mo(t){if(t.length===1){var e=t[0];if(ia(e))return{args:e,keys:null};if(ca(e)){var r=aa(e);return{args:r.map(function(n){return e[n]}),keys:r}}}return{args:t,keys:null}}function ca(t){return t&&typeof t=="object"&&oa(t)===sa}function Ir(t,e){return e===void 0&&(e=0),N(function(r,n){r.subscribe(V(n,function(i){return se(n,t,function(){return n.next(i)},e)},function(){return se(n,t,function(){return n.complete()},e)},function(i){return se(n,t,function(){return n.error(i)},e)}))})}function Sr(t,e){return e===void 0&&(e=0),N(function(r,n){n.add(t.schedule(function(){return r.subscribe(n)},e))})}function yo(t,e){return L(t).pipe(Sr(e),Ir(e))}function go(t,e){return L(t).pipe(Sr(e),Ir(e))}function vo(t,e){return new M(function(r){var n=0;return e.schedule(function(){n===t.length?r.complete():(r.next(t[n++]),r.closed||this.schedule())})})}function bo(t,e){return new M(function(r){var n;return se(r,e,function(){n=t[br](),se(r,e,function(){var i,o,s;try{i=n.next(),o=i.value,s=i.done}catch(a){r.error(a);return}s?r.complete():r.next(o)},0,!0)}),function(){return T(n==null?void 0:n.return)&&n.return()}})}function Er(t,e){if(!t)throw new Error("Iterable cannot be null");return new M(function(r){se(r,e,function(){var n=t[Symbol.asyncIterator]();se(r,e,function(){n.next().then(function(i){i.done?r.complete():r.next(i.value)})},0,!0)})})}function _o(t,e){return Er(wr(t),e)}function wo(t,e){if(t!=null){if(yr(t))return yo(t,e);if(tt(t))return vo(t,e);if(mr(t))return go(t,e);if(gr(t))return Er(t,e);if(_r(t))return bo(t,e);if(xr(t))return _o(t,e)}throw vr(t)}function U(t,e){return e?wo(t,e):L(t)}function O(t,e){return N(function(r,n){var i=0;r.subscribe(V(n,function(o){n.next(t.call(e,o,i++))}))})}var ua=Array.isArray;function la(t,e){return ua(e)?t.apply(void 0,ee([],z(e))):t(e)}function Pr(t){return O(function(e){return la(t,e)})}function xo(t,e){return t.reduce(function(r,n,i){return r[n]=e[i],r},{})}function Io(t,e,r,n,i,o,s,a){var c=[],u=0,l=0,d=!1,f=function(){d&&!c.length&&!u&&e.complete()},h=function(p){return u<n?g(p):c.push(p)},g=function(p){o&&e.next(p),u++;var b=!1;L(r(p,l++)).subscribe(V(e,function(y){i==null||i(y),o?h(y):e.next(y)},function(){b=!0},void 0,function(){if(b)try{u--;for(var y=function(){var x=c.shift();s?se(e,s,function(){return g(x)}):g(x)};c.length&&u<n;)y();f()}catch(x){e.error(x)}}))};return t.subscribe(V(e,h,function(){d=!0,f()})),function(){a==null||a()}}function St(t,e,r){return r===void 0&&(r=1/0),T(e)?St(function(n,i){return O(function(o,s){return e(n,o,i,s)})(L(t(n,i)))},r):(typeof e=="number"&&(r=e),N(function(n,i){return Io(n,i,t,r)}))}var fa=Array.isArray;function So(t){return t.length===1&&fa(t[0])?t[0]:t}function Ar(t){return t===void 0&&(t=1/0),St(Ae,t)}function Eo(){return Ar(1)}var Po=Je(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}});var Et=function(t){pe(e,t);function e(){var r=t.call(this)||this;return r.closed=!1,r.currentObservers=null,r.observers=[],r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return e.prototype.lift=function(r){var n=new Ao(this,this);return n.operator=r,n},e.prototype._throwIfClosed=function(){if(this.closed)throw new Po},e.prototype.next=function(r){var n=this;Ze(function(){var i,o;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var s=De(n.currentObservers),a=s.next();!a.done;a=s.next()){var c=a.value;c.next(r)}}catch(u){i={error:u}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}}})},e.prototype.error=function(r){var n=this;Ze(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=r;for(var i=n.observers;i.length;)i.shift().error(r)}})},e.prototype.complete=function(){var r=this;Ze(function(){if(r._throwIfClosed(),!r.isStopped){r.isStopped=!0;for(var n=r.observers;n.length;)n.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var r;return((r=this.observers)===null||r===void 0?void 0:r.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(r){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,r)},e.prototype._subscribe=function(r){return this._throwIfClosed(),this._checkFinalizedStatuses(r),this._innerSubscribe(r)},e.prototype._innerSubscribe=function(r){var n=this,i=this,o=i.hasError,s=i.isStopped,a=i.observers;return o||s?ln:(this.currentObservers=null,a.push(r),new Qe(function(){n.currentObservers=null,wt(a,r)}))},e.prototype._checkFinalizedStatuses=function(r){var n=this,i=n.hasError,o=n.thrownError,s=n.isStopped;i?r.error(o):s&&r.complete()},e.prototype.asObservable=function(){var r=new M;return r.source=this,r},e.create=function(r,n){return new Ao(r,n)},e}(M);var Ao=function(t){pe(e,t);function e(r,n){var i=t.call(this)||this;return i.destination=r,i.source=n,i}return e.prototype.next=function(r){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.next)===null||i===void 0||i.call(n,r)},e.prototype.error=function(r){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.error)===null||i===void 0||i.call(n,r)},e.prototype.complete=function(){var r,n;(n=(r=this.destination)===null||r===void 0?void 0:r.complete)===null||n===void 0||n.call(r)},e.prototype._subscribe=function(r){var n,i;return(i=(n=this.source)===null||n===void 0?void 0:n.subscribe(r))!==null&&i!==void 0?i:ln},e}(Et);function bn(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Eo()(U(t,Te(t)))}var ae=new M(function(t){return t.complete()});function Ke(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=Te(t);return U(t,r)}function _n(t,e){var r=T(t)?t:function(){return t},n=function(i){return i.error(r())};return new M(e?function(i){return e.schedule(n,0,i)}:n)}function rt(t,e){return e===void 0&&(e=Ae),t=t!=null?t:ha,N(function(r,n){var i,o=!0;r.subscribe(V(n,function(s){var a=e(s);(o||!t(i,a))&&(o=!1,i=a,n.next(s))}))})}function ha(t,e){return t===e}function wn(t,e){return N(function(r,n){var i=0;r.subscribe(V(n,function(o){return t.call(e,o,i++)&&n.next(o)}))})}var To=Je(function(t){return function(){t(this),this.name="EmptyError",this.message="no elements in sequence"}});function Wo(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=Te(t),n=po(t,1/0);return t=So(t),N(function(i,o){Ar(n)(U(ee([i],z(t)),r)).subscribe(o)})}function nt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Wo.apply(void 0,ee([],z(t)))}var Co=function(t){pe(e,t);function e(r,n,i){r===void 0&&(r=1/0),n===void 0&&(n=1/0),i===void 0&&(i=gn);var o=t.call(this)||this;return o._bufferSize=r,o._windowTime=n,o._timestampProvider=i,o._buffer=[],o._infiniteTimeWindow=!0,o._infiniteTimeWindow=n===1/0,o._bufferSize=Math.max(1,r),o._windowTime=Math.max(1,n),o}return e.prototype.next=function(r){var n=this,i=n.isStopped,o=n._buffer,s=n._infiniteTimeWindow,a=n._timestampProvider,c=n._windowTime;i||(o.push(r),!s&&o.push(a.now()+c)),this._trimBuffer(),t.prototype.next.call(this,r)},e.prototype._subscribe=function(r){this._throwIfClosed(),this._trimBuffer();for(var n=this._innerSubscribe(r),i=this,o=i._infiniteTimeWindow,s=i._buffer,a=s.slice(),c=0;c<a.length&&!r.closed;c+=o?1:2)r.next(a[c]);return this._checkFinalizedStatuses(r),n},e.prototype._trimBuffer=function(){var r=this,n=r._bufferSize,i=r._timestampProvider,o=r._buffer,s=r._infiniteTimeWindow,a=(s?1:2)*n;if(n<1/0&&a<o.length&&o.splice(0,o.length-a),!s){for(var c=i.now(),u=0,l=1;l<o.length&&o[l]<=c;l+=2)u=l;u&&o.splice(0,u+1)}},e}(Et);function Oo(t){t===void 0&&(t={});var e=t.connector,r=e===void 0?function(){return new Et}:e,n=t.resetOnError,i=n===void 0?!0:n,o=t.resetOnComplete,s=o===void 0?!0:o,a=t.resetOnRefCountZero,c=a===void 0?!0:a;return function(u){var l,d,f,h=0,g=!1,p=!1,b=function(){d==null||d.unsubscribe(),d=void 0},y=function(){b(),l=f=void 0,g=p=!1},x=function(){var v=l;y(),v==null||v.unsubscribe()};return N(function(v,m){h++,!p&&!g&&b();var w=f=f!=null?f:r();m.add(function(){h--,h===0&&!p&&!g&&(d=xn(x,c))}),w.subscribe(m),!l&&h>0&&(l=new Fe({next:function(_){return w.next(_)},error:function(_){p=!0,b(),d=xn(y,i,_),w.error(_)},complete:function(){g=!0,b(),d=xn(y,s),w.complete()}}),L(v).subscribe(l))})(u)}}function xn(t,e){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];if(e===!0){t();return}if(e!==!1){var i=new Fe({next:function(){i.unsubscribe(),t()}});return e.apply(void 0,ee([],z(r))).subscribe(i)}}function it(t,e,r){var n,i,o,s,a=!1;return t&&typeof t=="object"?(n=t.bufferSize,s=n===void 0?1/0:n,i=t.windowTime,e=i===void 0?1/0:i,o=t.refCount,a=o===void 0?!1:o,r=t.scheduler):s=t!=null?t:1/0,Oo({connector:function(){return new Co(s,e,r)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}function Tr(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=Te(t);return N(function(n,i){(r?bn(t,n,r):bn(t,n)).subscribe(i)})}function D(t,e){return N(function(r,n){var i=null,o=0,s=!1,a=function(){return s&&!i&&n.complete()};r.subscribe(V(n,function(c){i==null||i.unsubscribe();var u=0,l=o++;L(t(c,l)).subscribe(i=V(n,function(d){return n.next(e?e(c,d,l,u++):d)},function(){i=null,a()}))},function(){s=!0,a()}))})}function Wr(t,e,r){var n=T(t)||e||r?{next:t,error:e,complete:r}:t;return n?N(function(i,o){var s;(s=n.subscribe)===null||s===void 0||s.call(n);var a=!0;i.subscribe(V(o,function(c){var u;(u=n.next)===null||u===void 0||u.call(n,c),o.next(c)},function(){var c;a=!1,(c=n.complete)===null||c===void 0||c.call(n),o.complete()},function(c){var u;a=!1,(u=n.error)===null||u===void 0||u.call(n,c),o.error(c)},function(){var c,u;a&&((c=n.unsubscribe)===null||c===void 0||c.call(n)),(u=n.finalize)===null||u===void 0||u.call(n)}))}):Ae}var je=class{constructor(e){this.host=e.host,this.headers={"content-type":"application/json"}}fetch({path:e,method:r="GET",query:n,body:i}){return It(this.host+e+this.getQuerystring(n),{method:r,headers:this.headers,body:i}).pipe(D(o=>{if(o.ok)return o.json();throw Error(`Error ${o.status}`)}))}getQuerystring(e){if(!e)return"";let r=new URLSearchParams;return Object.entries(e).forEach(([n,i])=>{Array.isArray(i)?i.forEach(o=>r.append(n,o)):i&&r.append(n,i)}),"?"+r.toString()}get({path:e,query:r}){return this.fetch({method:"GET",path:e,query:r})}post({path:e,query:r,body:n}){return this.fetch({method:"POST",path:e,query:r,body:n?JSON.stringify(n):void 0})}put({path:e,query:r,body:n}){return this.fetch({method:"PUT",path:e,query:r,body:n?JSON.stringify(n):void 0})}delete({path:e,query:r,body:n}){return this.fetch({method:"DELETE",path:e,query:r,body:n?JSON.stringify(n):void 0})}};var Ro="4.0.0";var Cr=or(ko());function Pt(t,e){var r=typeof e=="object";return new Promise(function(n,i){var o=!1,s;t.subscribe({next:function(a){s=a,o=!0},error:i,complete:function(){o?n(s):r?n(e.defaultValue):i(new To)}})})}function q(t){return new M(function(e){L(t()).subscribe(e)})}function ce(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=ho(t),n=mo(t),i=n.args,o=n.keys,s=new M(function(a){var c=i.length;if(!c){a.complete();return}for(var u=new Array(c),l=c,d=c,f=function(g){var p=!1;L(i[g]).subscribe(V(a,function(b){p||(p=!0,d--),u[g]=b},function(){return l--},void 0,function(){(!l||!p)&&(d||a.next(o?xo(o,u):u),a.complete())}))},h=0;h<c;h++)f(h)});return r?s.pipe(Pr(r)):s}var xa=["addListener","removeListener"],Ia=["addEventListener","removeEventListener"],Sa=["on","off"];function At(t,e,r,n){if(T(r)&&(n=r,r=void 0),n)return At(t,e,r).pipe(Pr(n));var i=z(Aa(t)?Ia.map(function(a){return function(c){return t[a](e,c,r)}}):Ea(t)?xa.map(Fo(t,e)):Pa(t)?Sa.map(Fo(t,e)):[],2),o=i[0],s=i[1];if(!o&&tt(t))return St(function(a){return At(a,e,r)})(L(t));if(!o)throw new TypeError("Invalid event target");return new M(function(a){var c=function(){for(var u=[],l=0;l<arguments.length;l++)u[l]=arguments[l];return a.next(1<u.length?u:u[0])};return o(c),function(){return s(c)}})}function Fo(t,e){return function(r){return function(n){return t[r](e,n)}}}function Ea(t){return T(t.addListener)&&T(t.removeListener)}function Pa(t){return T(t.on)&&T(t.off)}function Aa(t){return T(t.addEventListener)&&T(t.removeEventListener)}var ot=class extends je{constructor(r){var n,i,o;super(r);this.headers={"content-type":"application/json","x-appmate-shp":r.shop,"x-appmate-tkv":Ro,"x-appmate-sid":r.sessionId,"x-appmate-cid":(i=(n=r.customerId)==null?void 0:n.toString())!=null?i:"","x-appmate-src":(o=r.trackingSource)!=null?o:""},this.wishlistLoader=this.createWishlistLoader(),this.productInfoLoader=this.createProductInfoLoader(),this.wishlistItemLoader=this.createWishlistItemLoader()}createWishlistLoader(){return new Cr.default(async r=>{let n=r.map(o=>o.split("-")).reduce((o,[s,a])=>(o[s]||(o[s]=[]),o[s].push(a),o),{}),i=await Promise.all(Object.entries(n).map(([o,s])=>Pt(this.get({path:`wishlists/${o}`,query:{format:s.includes("all")?"all":"minimal"}})))).then(o=>o.map(s=>s.wishlist));return r.map(o=>{var a;let[s]=o.split("-");return(a=i.find(c=>s==="mine"?c.isMine:c.publicId===s))!=null?a:new Error("Wishlist not found")})},{cache:!0,batchScheduleFn:r=>window.requestAnimationFrame(r)})}createProductInfoLoader(){return new Cr.default(async r=>{let{productInfo:n}=await Pt(this.get({path:"wishlists/mine/product-info",query:{ids:r}}));return r.map(i=>{var o;return(o=n.find(s=>s.productId===i))!=null?o:{productId:i,wishlistItems:[]}})},{cache:!0,batchScheduleFn:r=>window.requestAnimationFrame(r)})}createWishlistItemLoader(){return new Cr.default(async r=>{let n=r.map(o=>o.split("-")).reduce((o,[s,a])=>(o[s]||(o[s]=[]),o[s].push(a),o),{}),i=await Promise.all(Object.entries(n).map(([o,s])=>Pt(this.get({path:`wishlists/${o}/items`,query:{ids:s}})))).then(o=>o.flatMap(s=>s.items));return r.map(o=>{var a;let[,s]=o.split("-");return(a=i.find(c=>c.id===s))!=null?a:new Error("Product not found")})},{cache:!0,batchScheduleFn:r=>window.requestAnimationFrame(r)})}loadWishlist({wishlistId:r,format:n}){return U(this.wishlistLoader.load([r,n].join("-")).then(i=>({wishlist:i})))}loadProductInfo({productId:r}){return U(this.productInfoLoader.load(r).then(n=>({productInfo:n})))}loadWishlistItem({wishlistId:r,itemId:n}){return U(this.wishlistItemLoader.load([r,n].join("-")).then(i=>({wishlistItem:i})))}addItem({productId:r,variantId:n}){return typeof r=="string"&&(r=parseInt(r)),typeof n=="string"&&(n=parseInt(n)),this.post({path:"wishlists/mine/items",body:{productId:r,variantId:n}})}updateItem({itemId:r,changes:n}){return this.put({path:`wishlists/mine/items/${r}`,body:{changes:n}})}removeItem({wishlistId:r,itemId:n}){return this.delete({path:`wishlists/${r}/items/${n}`})}clearWishlist(){return this.delete({path:"wishlists/mine/items"})}};var st=class extends je{loadProduct({productHandle:e}){return this.get({path:`products/${e}.js`})}addToCart(e){return this.post({path:"cart/add.js",body:e})}};var ve=class{constructor(e){this.element=e!=null?e:window.document.body}replace(e){return this.element.replaceWith(e),e}append(e){return this.element.append(e),e}prepend(e){return this.element.prepend(e),e}insertBefore(e){return this.element.before(e),e}insertAfter(e){return this.element.after(e),e}closest(e){let r=this.element.closest(e);return r?new ve(r):null}find(e){let r=this.element.querySelector(e);return r?new ve(r):null}};var at=class{constructor({routeUtil:e}){this.subscriber=[],this.routeUtil=e,this.observer=new MutationObserver(r=>{r.reduce((n,i)=>n.concat(Array.from(i.addedNodes)),[]).filter(n=>n instanceof Element&&!n.hasAttribute("data-appmate")).forEach(n=>this.scan(n))}),this.observer.observe(document.body,{subtree:!0,childList:!0,attributes:!1})}watch(e,r){if(!e.template&&e.handle)throw new Error("Template required when watching for handle.");let n={target:e,callback:r};this.subscriber.push(n),Ko(n,this.routeUtil.parse(window.location.pathname))&&this.scan(document.body)}scan(e){this.subscriber.filter(r=>Ko(r,this.routeUtil.parse(window.location.pathname))).forEach(r=>{e.matches(r.target.selector)&&this.notify(r,e),e.querySelectorAll(r.target.selector).forEach(n=>{this.notify(r,n)})})}notify(e,r){if(!r.hasAttribute("data-appmate")){r.setAttribute("data-appmate","");let n=new ve(r);e.callback(n)}}};function Ko({target:t},e){return t.template?t.handle?t.handle===e.handle:e.template===t.template:!0}var j=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global,$=Object.keys,Q=Array.isArray;typeof Promise!="undefined"&&!j.Promise&&(j.Promise=Promise);function Z(t,e){return typeof e!="object"||$(e).forEach(function(r){t[r]=e[r]}),t}var Ut=Object.getPrototypeOf,Ta={}.hasOwnProperty;function ie(t,e){return Ta.call(t,e)}function ht(t,e){typeof e=="function"&&(e=e(Ut(t))),(typeof Reflect=="undefined"?$:Reflect.ownKeys)(e).forEach(r=>{Se(t,r,e[r])})}var Qo=Object.defineProperty;function Se(t,e,r,n){Qo(t,e,Z(r&&ie(r,"get")&&typeof r.get=="function"?{get:r.get,set:r.set,configurable:!0}:{value:r,configurable:!0,writable:!0},n))}function pt(t){return{from:function(e){return t.prototype=Object.create(e.prototype),Se(t.prototype,"constructor",t),{extend:ht.bind(null,t.prototype)}}}}var Wa=Object.getOwnPropertyDescriptor;function oi(t,e){let r=Wa(t,e),n;return r||(n=Ut(t))&&oi(n,e)}var Ca=[].slice;function Xr(t,e,r){return Ca.call(t,e,r)}function Xo(t,e){return e(t)}function Tt(t){if(!t)throw new Error("Assertion Failed")}function Zo(t){j.setImmediate?setImmediate(t):setTimeout(t,0)}function es(t,e){return t.reduce((r,n,i)=>{var o=e(n,i);return o&&(r[o[0]]=o[1]),r},{})}function Oa(t,e,r){try{t.apply(null,r)}catch(n){e&&e(n)}}function Ie(t,e){if(ie(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var r=[],n=0,i=e.length;n<i;++n){var o=Ie(t,e[n]);r.push(o)}return r}var s=e.indexOf(".");if(s!==-1){var a=t[e.substr(0,s)];return a===void 0?void 0:Ie(a,e.substr(s+1))}}function he(t,e,r){if(!(!t||e===void 0)&&!("isFrozen"in Object&&Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){Tt(typeof r!="string"&&"length"in r);for(var n=0,i=e.length;n<i;++n)he(t,e[n],r[n])}else{var o=e.indexOf(".");if(o!==-1){var s=e.substr(0,o),a=e.substr(o+1);if(a==="")r===void 0?Q(t)&&!isNaN(parseInt(s))?t.splice(s,1):delete t[s]:t[s]=r;else{var c=t[s];(!c||!ie(t,s))&&(c=t[s]={}),he(c,a,r)}}else r===void 0?Q(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=r}}function Ra(t,e){typeof e=="string"?he(t,e,void 0):"length"in e&&[].map.call(e,function(r){he(t,r,void 0)})}function ts(t){var e={};for(var r in t)ie(t,r)&&(e[r]=t[r]);return e}var Ua=[].concat;function rs(t){return Ua.apply([],t)}var ns="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(rs([8,16,32,64].map(t=>["Int","Uint","Float"].map(e=>e+t+"Array")))).filter(t=>j[t]),Ma=ns.map(t=>j[t]);es(ns,t=>[t,!0]);var Ce=null;function Lt(t){Ce=typeof WeakMap!="undefined"&&new WeakMap;let e=On(t);return Ce=null,e}function On(t){if(!t||typeof t!="object")return t;let e=Ce&&Ce.get(t);if(e)return e;if(Q(t)){e=[],Ce&&Ce.set(t,e);for(var r=0,n=t.length;r<n;++r)e.push(On(t[r]))}else if(Ma.indexOf(t.constructor)>=0)e=t;else{let o=Ut(t);e=o===Object.prototype?{}:Object.create(o),Ce&&Ce.set(t,e);for(var i in t)ie(t,i)&&(e[i]=On(t[i]))}return e}var{toString:Da}={};function Rn(t){return Da.call(t).slice(8,-1)}var Un=typeof Symbol!="undefined"?Symbol.iterator:"@@iterator",ka=typeof Un=="symbol"?function(t){var e;return t!=null&&(e=t[Un])&&e.apply(t)}:function(){return null},lt={};function we(t){var e,r,n,i;if(arguments.length===1){if(Q(t))return t.slice();if(this===lt&&typeof t=="string")return[t];if(i=ka(t)){for(r=[];n=i.next(),!n.done;)r.push(n.value);return r}if(t==null)return[t];if(e=t.length,typeof e=="number"){for(r=new Array(e);e--;)r[e]=t[e];return r}return[t]}for(e=arguments.length,r=new Array(e);e--;)r[e]=arguments[e];return r}var si=typeof Symbol!="undefined"?t=>t[Symbol.toStringTag]==="AsyncFunction":()=>!1,ye=typeof location!="undefined"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function is(t,e){ye=t,os=e}var os=()=>!0,Fa=!new Error("").stack;function He(){if(Fa)try{throw He.arguments,new Error}catch(t){return t}return new Error}function Mn(t,e){var r=t.stack;return r?(e=e||0,r.indexOf(t.name)===0&&(e+=(t.name+t.message).split(`
`).length),r.split(`
`).slice(e).filter(os).map(n=>`
`+n).join("")):""}var Ka=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"],ss=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],ai=Ka.concat(ss),ja={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function dt(t,e){this._e=He(),this.name=t,this.message=e}pt(dt).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Mn(this._e,2))}},toString:function(){return this.name+": "+this.message}});function as(t,e){return t+". Errors: "+Object.keys(e).map(r=>e[r].toString()).filter((r,n,i)=>i.indexOf(r)===n).join(`
`)}function Br(t,e,r,n){this._e=He(),this.failures=e,this.failedKeys=n,this.successCount=r,this.message=as(t,e)}pt(Br).from(dt);function Ct(t,e){this._e=He(),this.name="BulkError",this.failures=Object.keys(e).map(r=>e[r]),this.failuresByPos=e,this.message=as(t,e)}pt(Ct).from(dt);var ci=ai.reduce((t,e)=>(t[e]=e+"Error",t),{}),La=dt,A=ai.reduce((t,e)=>{var r=e+"Error";function n(i,o){this._e=He(),this.name=r,i?typeof i=="string"?(this.message=`${i}${o?`
 `+o:""}`,this.inner=o||null):typeof i=="object"&&(this.message=`${i.name} ${i.message}`,this.inner=i):(this.message=ja[e]||r,this.inner=null)}return pt(n).from(La),t[e]=n,t},{});A.Syntax=SyntaxError;A.Type=TypeError;A.Range=RangeError;var jo=ss.reduce((t,e)=>(t[e+"Error"]=A[e],t),{});function Na(t,e){if(!t||t instanceof dt||t instanceof TypeError||t instanceof SyntaxError||!t.name||!jo[t.name])return t;var r=new jo[t.name](e||t.message,t);return"stack"in t&&Se(r,"stack",{get:function(){return this.inner.stack}}),r}var Zr=ai.reduce((t,e)=>(["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=A[e]),t),{});Zr.ModifyError=Br;Zr.DexieError=dt;Zr.BulkError=Ct;function F(){}function Nt(t){return t}function Ba(t,e){return t==null||t===Nt?e:function(r){return e(t(r))}}function $e(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function Va(t,e){return t===F?e:function(){var r=t.apply(this,arguments);r!==void 0&&(arguments[0]=r);var n=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return n&&(this.onsuccess=this.onsuccess?$e(n,this.onsuccess):n),i&&(this.onerror=this.onerror?$e(i,this.onerror):i),o!==void 0?o:r}}function $a(t,e){return t===F?e:function(){t.apply(this,arguments);var r=this.onsuccess,n=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),r&&(this.onsuccess=this.onsuccess?$e(r,this.onsuccess):r),n&&(this.onerror=this.onerror?$e(n,this.onerror):n)}}function qa(t,e){return t===F?e:function(r){var n=t.apply(this,arguments);Z(r,n);var i=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var s=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?$e(i,this.onsuccess):i),o&&(this.onerror=this.onerror?$e(o,this.onerror):o),n===void 0?s===void 0?void 0:s:Z(n,s)}}function Ha(t,e){return t===F?e:function(){return e.apply(this,arguments)===!1?!1:t.apply(this,arguments)}}function ui(t,e){return t===F?e:function(){var r=t.apply(this,arguments);if(r&&typeof r.then=="function"){for(var n=this,i=arguments.length,o=new Array(i);i--;)o[i]=arguments[i];return r.then(function(){return e.apply(n,o)})}return e.apply(this,arguments)}}var Mt={},Ya=100,za=20,cs=100,[Dn,Vr,kn]=typeof Promise=="undefined"?[]:(()=>{let t=Promise.resolve();if(typeof crypto=="undefined"||!crypto.subtle)return[t,Ut(t),t];let e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,Ut(e),t]})(),us=Vr&&Vr.then,kr=Dn&&Dn.constructor,li=!!kn,Fn=!1,Ga=kn?()=>{kn.then(Or)}:j.setImmediate?setImmediate.bind(null,Or):j.MutationObserver?()=>{var t=document.createElement("div");new MutationObserver(()=>{Or(),t=null}).observe(t,{attributes:!0}),t.setAttribute("i","1")}:()=>{setTimeout(Or,0)},Dt=function(t,e){Wt.push([t,e]),$r&&(Ga(),$r=!1)},Kn=!0,$r=!0,Be=[],Fr=[],jn=null,Ln=Nt,ft={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Bo,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(t=>{try{Bo(t[0],t[1])}catch(e){}})}},P=ft,Wt=[],Ve=0,Kr=[];function S(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=F,this._lib=!1;var e=this._PSD=P;if(ye&&(this._stackHolder=He(),this._prev=null,this._numPrev=0),typeof t!="function"){if(t!==Mt)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&Bn(this,this._value);return}this._state=null,this._value=null,++e.ref,fs(this,t)}var Nn={get:function(){var t=P,e=qr;function r(n,i){var o=!t.global&&(t!==P||e!==qr);let s=o&&!Ee();var a=new S((c,u)=>{fi(this,new ls(Yr(n,t,o,s),Yr(i,t,o,s),c,u,t))});return ye&&ds(a,this),a}return r.prototype=Mt,r},set:function(t){Se(this,"then",t&&t.prototype===Mt?Nn:{get:function(){return t},set:Nn.set})}};ht(S.prototype,{then:Nn,_then:function(t,e){fi(this,new ls(null,null,t,e,P))},catch:function(t){if(arguments.length===1)return this.then(null,t);var e=arguments[0],r=arguments[1];return typeof e=="function"?this.then(null,n=>n instanceof e?r(n):jr(n)):this.then(null,n=>n&&n.name===e?r(n):jr(n))},finally:function(t){return this.then(e=>(t(),e),e=>(t(),jr(e)))},stack:{get:function(){if(this._stack)return this._stack;try{Fn=!0;var t=ps(this,[],za),e=t.join(`
From previous: `);return this._state!==null&&(this._stack=e),e}finally{Fn=!1}}},timeout:function(t,e){return t<1/0?new S((r,n)=>{var i=setTimeout(()=>n(new A.Timeout(e)),t);this.then(r,n).finally(clearTimeout.bind(null,i))}):this}});typeof Symbol!="undefined"&&Symbol.toStringTag&&Se(S.prototype,Symbol.toStringTag,"Dexie.Promise");ft.env=ms();function ls(t,e,r,n,i){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=r,this.reject=n,this.psd=i}ht(S,{all:function(){var t=we.apply(null,arguments).map(Hr);return new S(function(e,r){t.length===0&&e([]);var n=t.length;t.forEach((i,o)=>S.resolve(i).then(s=>{t[o]=s,--n||e(t)},r))})},resolve:t=>{if(t instanceof S)return t;if(t&&typeof t.then=="function")return new S((r,n)=>{t.then(r,n)});var e=new S(Mt,!0,t);return ds(e,jn),e},reject:jr,race:function(){var t=we.apply(null,arguments).map(Hr);return new S((e,r)=>{t.map(n=>S.resolve(n).then(e,r))})},PSD:{get:()=>P,set:t=>P=t},totalEchoes:{get:()=>qr},newPSD:Re,usePSD:yt,scheduler:{get:()=>Dt,set:t=>{Dt=t}},rejectionMapper:{get:()=>Ln,set:t=>{Ln=t}},follow:(t,e)=>new S((r,n)=>Re((i,o)=>{var s=P;s.unhandleds=[],s.onunhandled=o,s.finalize=$e(function(){Qa(()=>{this.unhandleds.length===0?i():o(this.unhandleds[0])})},s.finalize),t()},e,r,n))});kr&&(kr.allSettled&&Se(S,"allSettled",function(){let t=we.apply(null,arguments).map(Hr);return new S(e=>{t.length===0&&e([]);let r=t.length,n=new Array(r);t.forEach((i,o)=>S.resolve(i).then(s=>n[o]={status:"fulfilled",value:s},s=>n[o]={status:"rejected",reason:s}).then(()=>--r||e(n)))})}),kr.any&&typeof AggregateError!="undefined"&&Se(S,"any",function(){let t=we.apply(null,arguments).map(Hr);return new S((e,r)=>{t.length===0&&r(new AggregateError([]));let n=t.length,i=new Array(n);t.forEach((o,s)=>S.resolve(o).then(a=>e(a),a=>{i[s]=a,--n||r(new AggregateError(i))}))})}));function fs(t,e){try{e(r=>{if(t._state===null){if(r===t)throw new TypeError("A promise cannot be resolved with itself.");var n=t._lib&&Bt();r&&typeof r.then=="function"?fs(t,(i,o)=>{r instanceof S?r._then(i,o):r.then(i,o)}):(t._state=!0,t._value=r,hs(t)),n&&Vt()}},Bn.bind(null,t))}catch(r){Bn(t,r)}}function Bn(t,e){if(Fr.push(e),t._state===null){var r=t._lib&&Bt();e=Ln(e),t._state=!1,t._value=e,ye&&e!==null&&typeof e=="object"&&!e._promise&&Oa(()=>{var n=oi(e,"stack");e._promise=t,Se(e,"stack",{get:()=>Fn?n&&(n.get?n.get.apply(e):n.value):t.stack})}),Xa(t),hs(t),r&&Vt()}}function hs(t){var e=t._listeners;t._listeners=[];for(var r=0,n=e.length;r<n;++r)fi(t,e[r]);var i=t._PSD;--i.ref||i.finalize(),Ve===0&&(++Ve,Dt(()=>{--Ve===0&&hi()},[]))}function fi(t,e){if(t._state===null){t._listeners.push(e);return}var r=t._state?e.onFulfilled:e.onRejected;if(r===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++Ve,Dt(Ja,[r,t,e])}function Ja(t,e,r){try{jn=e;var n,i=e._value;e._state?n=t(i):(Fr.length&&(Fr=[]),n=t(i),Fr.indexOf(i)===-1&&Za(e)),r.resolve(n)}catch(o){r.reject(o)}finally{jn=null,--Ve===0&&hi(),--r.psd.ref||r.psd.finalize()}}function ps(t,e,r){if(e.length===r)return e;var n="";if(t._state===!1){var i=t._value,o,s;i!=null?(o=i.name||"Error",s=i.message||i,n=Mn(i,0)):(o=i,s=""),e.push(o+(s?": "+s:"")+n)}return ye&&(n=Mn(t._stackHolder,2),n&&e.indexOf(n)===-1&&e.push(n),t._prev&&ps(t._prev,e,r)),e}function ds(t,e){var r=e?e._numPrev+1:0;r<Ya&&(t._prev=e,t._numPrev=r)}function Or(){Bt()&&Vt()}function Bt(){var t=Kn;return Kn=!1,$r=!1,t}function Vt(){var t,e,r;do for(;Wt.length>0;)for(t=Wt,Wt=[],r=t.length,e=0;e<r;++e){var n=t[e];n[0].apply(null,n[1])}while(Wt.length>0);Kn=!0,$r=!0}function hi(){var t=Be;Be=[],t.forEach(n=>{n._PSD.onunhandled.call(null,n._value,n)});for(var e=Kr.slice(0),r=e.length;r;)e[--r]()}function Qa(t){function e(){t(),Kr.splice(Kr.indexOf(e),1)}Kr.push(e),++Ve,Dt(()=>{--Ve===0&&hi()},[])}function Xa(t){Be.some(e=>e._value===t._value)||Be.push(t)}function Za(t){for(var e=Be.length;e;)if(Be[--e]._value===t._value){Be.splice(e,1);return}}function jr(t){return new S(Mt,!1,t)}function B(t,e){var r=P;return function(){var n=Bt(),i=P;try{return Ue(r,!0),t.apply(this,arguments)}catch(o){e&&e(o)}finally{Ue(i,!1),n&&Vt()}}}var J={awaits:0,echoes:0,id:0},ec=0,Lr=[],En=0,qr=0,tc=0;function Re(t,e,r,n){var i=P,o=Object.create(i);o.parent=i,o.ref=0,o.global=!1,o.id=++tc;var s=ft.env;o.env=li?{Promise:S,PromiseProp:{value:S,configurable:!0,writable:!0},all:S.all,race:S.race,allSettled:S.allSettled,any:S.any,resolve:S.resolve,reject:S.reject,nthen:Lo(s.nthen,o),gthen:Lo(s.gthen,o)}:{},e&&Z(o,e),++i.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=yt(o,t,r,n);return o.ref===0&&o.finalize(),a}function mt(){return J.id||(J.id=++ec),++J.awaits,J.echoes+=cs,J.id}function Ee(){return J.awaits?(--J.awaits===0&&(J.id=0),J.echoes=J.awaits*cs,!0):!1}(""+us).indexOf("[native code]")===-1&&(mt=Ee=F);function Hr(t){return J.echoes&&t&&t.constructor===kr?(mt(),t.then(e=>(Ee(),e),e=>(Ee(),H(e)))):t}function rc(t){++qr,(!J.echoes||--J.echoes===0)&&(J.echoes=J.id=0),Lr.push(P),Ue(t,!0)}function nc(){var t=Lr[Lr.length-1];Lr.pop(),Ue(t,!1)}function Ue(t,e){var r=P;if((e?J.echoes&&(!En++||t!==P):En&&(!--En||t!==P))&&ys(e?rc.bind(null,t):nc),t!==P&&(P=t,r===ft&&(ft.env=ms()),li)){var n=ft.env.Promise,i=t.env;Vr.then=i.nthen,n.prototype.then=i.gthen,(r.global||t.global)&&(Object.defineProperty(j,"Promise",i.PromiseProp),n.all=i.all,n.race=i.race,n.resolve=i.resolve,n.reject=i.reject,i.allSettled&&(n.allSettled=i.allSettled),i.any&&(n.any=i.any))}}function ms(){var t=j.Promise;return li?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(j,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:Vr.then,gthen:t.prototype.then}:{}}function yt(t,e,r,n,i){var o=P;try{return Ue(t,!0),e(r,n,i)}finally{Ue(o,!1)}}function ys(t){us.call(Dn,t)}function Yr(t,e,r,n){return typeof t!="function"?t:function(){var i=P;r&&mt(),Ue(e,!0);try{return t.apply(this,arguments)}finally{Ue(i,!1),n&&ys(Ee)}}}function Lo(t,e){return function(r,n){return t.call(this,Yr(r,e),Yr(n,e))}}var No="unhandledrejection";function Bo(t,e){var r;try{r=e.onuncatched(t)}catch(o){}if(r!==!1)try{var n,i={promise:e,reason:t};if(j.document&&document.createEvent?(n=document.createEvent("Event"),n.initEvent(No,!0,!0),Z(n,i)):j.CustomEvent&&(n=new CustomEvent(No,{detail:i}),Z(n,i)),n&&j.dispatchEvent&&(dispatchEvent(n),!j.PromiseRejectionEvent&&j.onunhandledrejection))try{j.onunhandledrejection(n)}catch(o){}ye&&n&&!n.defaultPrevented&&console.warn(`Unhandled rejection: ${t.stack||t}`)}catch(o){}}var H=S.reject;function Vn(t,e,r,n){if(!t.idbdb||!t._state.openComplete&&!P.letThrough&&!t._vip){if(t._state.openComplete)return H(new A.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return H(new A.DatabaseClosed);t.open().catch(F)}return t._state.dbReadyPromise.then(()=>Vn(t,e,r,n))}else{var i=t._createTransaction(e,r,t._dbSchema);try{i.create(),t._state.PR1398_maxLoop=3}catch(o){return o.name===ci.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>Vn(t,e,r,n))):H(o)}return i._promise(e,(o,s)=>Re(()=>(P.trans=i,n(o,s,i)))).then(o=>i._completion.then(()=>o))}}var Vo="3.2.2",Ne=String.fromCharCode(65535),$n=-1/0,be="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",gs="String expected.",Ot=[],en=typeof navigator!="undefined"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),ic=en,oc=en,vs=t=>!/(dexie\.js|dexie\.min\.js)/.test(t),tn="__dbnames",Pn="readonly",An="readwrite";function qe(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}var bs={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Rr(t){return typeof t=="string"&&!/\./.test(t)?e=>(e[t]===void 0&&t in e&&(e=Lt(e),delete e[t]),e):e=>e}var qn=class{_trans(e,r,n){let i=this._tx||P.trans,o=this.name;function s(c,u,l){if(!l.schema[o])throw new A.NotFound("Table "+o+" not part of transaction");return r(l.idbtrans,l)}let a=Bt();try{return i&&i.db===this.db?i===P.trans?i._promise(e,s,n):Re(()=>i._promise(e,s,n),{trans:i,transless:P.transless||P}):Vn(this.db,e,[this.name],s)}finally{a&&Vt()}}get(e,r){return e&&e.constructor===Object?this.where(e).first(r):this._trans("readonly",n=>this.core.get({trans:n,key:e}).then(i=>this.hook.reading.fire(i))).then(r)}where(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(Q(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);let r=$(e);if(r.length===1)return this.where(r[0]).equals(e[r[0]]);let n=this.schema.indexes.concat(this.schema.primKey).filter(u=>u.compound&&r.every(l=>u.keyPath.indexOf(l)>=0)&&u.keyPath.every(l=>r.indexOf(l)>=0))[0];if(n&&this.db._maxKey!==Ne)return this.where(n.name).equals(n.keyPath.map(u=>e[u]));!n&&ye&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${r.join("+")}]`);let{idxByName:i}=this.schema,o=this.db._deps.indexedDB;function s(u,l){try{return o.cmp(u,l)===0}catch(d){return!1}}let[a,c]=r.reduce(([u,l],d)=>{let f=i[d],h=e[d];return[u||f,u||!f?qe(l,f&&f.multi?g=>{let p=Ie(g,d);return Q(p)&&p.some(b=>s(h,b))}:g=>s(h,Ie(g,d))):l]},[null,null]);return a?this.where(a.name).equals(e[a.keyPath]).filter(c):n?this.filter(c):this.where(r).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,Q(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;let r=n=>{if(!n)return n;let i=Object.create(e.prototype);for(var o in n)if(ie(n,o))try{i[o]=n[o]}catch(s){}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=r,this.hook("reading",r),e}defineClass(){function e(r){Z(this,r)}return this.mapToClass(e)}add(e,r){let{auto:n,keyPath:i}=this.schema.primKey,o=e;return i&&n&&(o=Rr(i)(e)),this._trans("readwrite",s=>this.core.mutate({trans:s,type:"add",keys:r!=null?[r]:null,values:[o]})).then(s=>s.numFailures?S.reject(s.failures[0]):s.lastResult).then(s=>{if(i)try{he(e,i,s)}catch(a){}return s})}update(e,r){if(typeof e=="object"&&!Q(e)){let n=Ie(e,this.schema.primKey.keyPath);if(n===void 0)return H(new A.InvalidArgument("Given object does not contain its primary key"));try{typeof r!="function"?$(r).forEach(i=>{he(e,i,r[i])}):r(e,{value:e,primKey:n})}catch(i){}return this.where(":id").equals(n).modify(r)}else return this.where(":id").equals(e).modify(r)}put(e,r){let{auto:n,keyPath:i}=this.schema.primKey,o=e;return i&&n&&(o=Rr(i)(e)),this._trans("readwrite",s=>this.core.mutate({trans:s,type:"put",values:[o],keys:r!=null?[r]:null})).then(s=>s.numFailures?S.reject(s.failures[0]):s.lastResult).then(s=>{if(i)try{he(e,i,s)}catch(a){}return s})}delete(e){return this._trans("readwrite",r=>this.core.mutate({trans:r,type:"delete",keys:[e]})).then(r=>r.numFailures?S.reject(r.failures[0]):void 0)}clear(){return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"deleteRange",range:bs})).then(e=>e.numFailures?S.reject(e.failures[0]):void 0)}bulkGet(e){return this._trans("readonly",r=>this.core.getMany({keys:e,trans:r}).then(n=>n.map(i=>this.hook.reading.fire(i))))}bulkAdd(e,r,n){let i=Array.isArray(r)?r:void 0;n=n||(i?void 0:r);let o=n?n.allKeys:void 0;return this._trans("readwrite",s=>{let{auto:a,keyPath:c}=this.schema.primKey;if(c&&i)throw new A.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new A.InvalidArgument("Arguments objects and keys must have the same length");let u=e.length,l=c&&a?e.map(Rr(c)):e;return this.core.mutate({trans:s,type:"add",keys:i,values:l,wantResults:o}).then(({numFailures:d,results:f,lastResult:h,failures:g})=>{let p=o?f:h;if(d===0)return p;throw new Ct(`${this.name}.bulkAdd(): ${d} of ${u} operations failed`,g)})})}bulkPut(e,r,n){let i=Array.isArray(r)?r:void 0;n=n||(i?void 0:r);let o=n?n.allKeys:void 0;return this._trans("readwrite",s=>{let{auto:a,keyPath:c}=this.schema.primKey;if(c&&i)throw new A.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new A.InvalidArgument("Arguments objects and keys must have the same length");let u=e.length,l=c&&a?e.map(Rr(c)):e;return this.core.mutate({trans:s,type:"put",keys:i,values:l,wantResults:o}).then(({numFailures:d,results:f,lastResult:h,failures:g})=>{let p=o?f:h;if(d===0)return p;throw new Ct(`${this.name}.bulkPut(): ${d} of ${u} operations failed`,g)})})}bulkDelete(e){let r=e.length;return this._trans("readwrite",n=>this.core.mutate({trans:n,type:"delete",keys:e})).then(({numFailures:n,lastResult:i,failures:o})=>{if(n===0)return i;throw new Ct(`${this.name}.bulkDelete(): ${n} of ${r} operations failed`,o)})}};function $t(t){var e={},r=function(a,c){if(c){for(var u=arguments.length,l=new Array(u-1);--u;)l[u-1]=arguments[u];return e[a].subscribe.apply(null,l),t}else if(typeof a=="string")return e[a]};r.addEventType=o;for(var n=1,i=arguments.length;n<i;++n)o(arguments[n]);return r;function o(a,c,u){if(typeof a=="object")return s(a);c||(c=Ha),u||(u=F);var l={subscribers:[],fire:u,subscribe:function(d){l.subscribers.indexOf(d)===-1&&(l.subscribers.push(d),l.fire=c(l.fire,d))},unsubscribe:function(d){l.subscribers=l.subscribers.filter(function(f){return f!==d}),l.fire=l.subscribers.reduce(c,u)}};return e[a]=r[a]=l,l}function s(a){$(a).forEach(function(c){var u=a[c];if(Q(u))o(c,a[c][0],a[c][1]);else if(u==="asap")var l=o(c,Nt,function(){for(var f=arguments.length,h=new Array(f);f--;)h[f]=arguments[f];l.subscribers.forEach(function(g){Zo(function(){g.apply(null,h)})})});else throw new A.InvalidArgument("Invalid event config")})}}function qt(t,e){return pt(e).from({prototype:t}),e}function sc(t){return qt(qn.prototype,function(r,n,i){this.db=t,this._tx=i,this.name=r,this.schema=n,this.hook=t._allTables[r]?t._allTables[r].hook:$t(null,{creating:[Va,F],reading:[Ba,Nt],updating:[qa,F],deleting:[$a,F]})})}function ct(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function Tn(t,e){t.filter=qe(t.filter,e)}function Wn(t,e,r){var n=t.replayFilter;t.replayFilter=n?()=>qe(n(),e()):e,t.justLimit=r&&!n}function ac(t,e){t.isMatch=qe(t.isMatch,e)}function Nr(t,e){if(t.isPrimKey)return e.primaryKey;let r=e.getIndexByKeyPath(t.index);if(!r)throw new A.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return r}function $o(t,e,r){let n=Nr(t,e.schema);return e.openCursor({trans:r,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:n,range:t.range}})}function Ur(t,e,r,n){let i=t.replayFilter?qe(t.filter,t.replayFilter()):t.filter;if(t.or){let o={},s=(a,c,u)=>{if(!i||i(c,u,f=>c.stop(f),f=>c.fail(f))){var l=c.primaryKey,d=""+l;d==="[object ArrayBuffer]"&&(d=""+new Uint8Array(l)),ie(o,d)||(o[d]=!0,e(a,c,u))}};return Promise.all([t.or._iterate(s,r),qo($o(t,n,r),t.algorithm,s,!t.keysOnly&&t.valueMapper)])}else return qo($o(t,n,r),qe(t.algorithm,i),e,!t.keysOnly&&t.valueMapper)}function qo(t,e,r,n){var i=n?(s,a,c)=>r(n(s),a,c):r,o=B(i);return t.then(s=>{if(s)return s.start(()=>{var a=()=>s.continue();(!e||e(s,c=>a=c,c=>{s.stop(c),a=F},c=>{s.fail(c),a=F}))&&o(s.value,s,c=>a=c),a()})})}function X(t,e){try{let r=Ho(t),n=Ho(e);if(r!==n)return r==="Array"?1:n==="Array"?-1:r==="binary"?1:n==="binary"?-1:r==="string"?1:n==="string"?-1:r==="Date"?1:n!=="Date"?NaN:-1;switch(r){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return uc(Yo(t),Yo(e));case"Array":return cc(t,e)}}catch(r){}return NaN}function cc(t,e){let r=t.length,n=e.length,i=r<n?r:n;for(let o=0;o<i;++o){let s=X(t[o],e[o]);if(s!==0)return s}return r===n?0:r<n?-1:1}function uc(t,e){let r=t.length,n=e.length,i=r<n?r:n;for(let o=0;o<i;++o)if(t[o]!==e[o])return t[o]<e[o]?-1:1;return r===n?0:r<n?-1:1}function Ho(t){let e=typeof t;if(e!=="object")return e;if(ArrayBuffer.isView(t))return"binary";let r=Rn(t);return r==="ArrayBuffer"?"binary":r}function Yo(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}var Hn=class{_read(e,r){var n=this._ctx;return n.error?n.table._trans(null,H.bind(null,n.error)):n.table._trans("readonly",e).then(r)}_write(e){var r=this._ctx;return r.error?r.table._trans(null,H.bind(null,r.error)):r.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var r=this._ctx;r.algorithm=qe(r.algorithm,e)}_iterate(e,r){return Ur(this._ctx,e,r,this._ctx.table.core)}clone(e){var r=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&Z(n,e),r._ctx=n,r}raw(){return this._ctx.valueMapper=null,this}each(e){var r=this._ctx;return this._read(n=>Ur(r,e,n,r.table.core))}count(e){return this._read(r=>{let n=this._ctx,i=n.table.core;if(ct(n,!0))return i.count({trans:r,query:{index:Nr(n,i.schema),range:n.range}}).then(s=>Math.min(s,n.limit));var o=0;return Ur(n,()=>(++o,!1),r,i).then(()=>o)}).then(e)}sortBy(e,r){let n=e.split(".").reverse(),i=n[0],o=n.length-1;function s(u,l){return l?s(u[n[l]],l-1):u[i]}var a=this._ctx.dir==="next"?1:-1;function c(u,l){var d=s(u,o),f=s(l,o);return d<f?-a:d>f?a:0}return this.toArray(function(u){return u.sort(c)}).then(r)}toArray(e){return this._read(r=>{var n=this._ctx;if(n.dir==="next"&&ct(n,!0)&&n.limit>0){let{valueMapper:i}=n,o=Nr(n,n.table.core.schema);return n.table.core.query({trans:r,limit:n.limit,values:!0,query:{index:o,range:n.range}}).then(({result:s})=>i?s.map(i):s)}else{let i=[];return Ur(n,o=>i.push(o),r,n.table.core).then(()=>i)}},e)}offset(e){var r=this._ctx;return e<=0?this:(r.offset+=e,ct(r)?Wn(r,()=>{var n=e;return(i,o)=>n===0?!0:n===1?(--n,!1):(o(()=>{i.advance(n),n=0}),!1)}):Wn(r,()=>{var n=e;return()=>--n<0}),this)}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Wn(this._ctx,()=>{var r=e;return function(n,i,o){return--r<=0&&i(o),r>=0}},!0),this}until(e,r){return Tn(this._ctx,function(n,i,o){return e(n.value)?(i(o),r):!0}),this}first(e){return this.limit(1).toArray(function(r){return r[0]}).then(e)}last(e){return this.reverse().first(e)}filter(e){return Tn(this._ctx,function(r){return e(r.value)}),ac(this._ctx,e),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var r=this._ctx;return r.keysOnly=!r.isMatch,this.each(function(n,i){e(i.key,i)})}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var r=this._ctx;return r.keysOnly=!r.isMatch,this.each(function(n,i){e(i.primaryKey,i)})}keys(e){var r=this._ctx;r.keysOnly=!r.isMatch;var n=[];return this.each(function(i,o){n.push(o.key)}).then(function(){return n}).then(e)}primaryKeys(e){var r=this._ctx;if(r.dir==="next"&&ct(r,!0)&&r.limit>0)return this._read(i=>{var o=Nr(r,r.table.core.schema);return r.table.core.query({trans:i,values:!1,limit:r.limit,query:{index:o,range:r.range}})}).then(({result:i})=>i).then(e);r.keysOnly=!r.isMatch;var n=[];return this.each(function(i,o){n.push(o.primaryKey)}).then(function(){return n}).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys(function(r){return r[0]}).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,r=e.index&&e.table.schema.idxByName[e.index];if(!r||!r.multi)return this;var n={};return Tn(this._ctx,function(i){var o=i.primaryKey.toString(),s=ie(n,o);return n[o]=!0,!s}),this}modify(e){var r=this._ctx;return this._write(n=>{var i;if(typeof e=="function")i=e;else{var o=$(e),s=o.length;i=function(p){for(var b=!1,y=0;y<s;++y){var x=o[y],v=e[x];Ie(p,x)!==v&&(he(p,x,v),b=!0)}return b}}let a=r.table.core,{outbound:c,extractKey:u}=a.schema.primaryKey,l=this.db._options.modifyChunkSize||200,d=[],f=0,h=[],g=(p,b)=>{let{failures:y,numFailures:x}=b;f+=p-x;for(let v of $(y))d.push(y[v])};return this.clone().primaryKeys().then(p=>{let b=y=>{let x=Math.min(l,p.length-y);return a.getMany({trans:n,keys:p.slice(y,y+x),cache:"immutable"}).then(v=>{let m=[],w=[],_=c?[]:null,I=[];for(let W=0;W<x;++W){let k=v[W],R={value:Lt(k),primKey:p[y+W]};i.call(R,R.value,R)!==!1&&(R.value==null?I.push(p[y+W]):!c&&X(u(k),u(R.value))!==0?(I.push(p[y+W]),m.push(R.value)):(w.push(R.value),c&&_.push(p[y+W])))}let E=ct(r)&&r.limit===1/0&&(typeof e!="function"||e===Cn)&&{index:r.index,range:r.range};return Promise.resolve(m.length>0&&a.mutate({trans:n,type:"add",values:m}).then(W=>{for(let k in W.failures)I.splice(parseInt(k),1);g(m.length,W)})).then(()=>(w.length>0||E&&typeof e=="object")&&a.mutate({trans:n,type:"put",keys:_,values:w,criteria:E,changeSpec:typeof e!="function"&&e}).then(W=>g(w.length,W))).then(()=>(I.length>0||E&&e===Cn)&&a.mutate({trans:n,type:"delete",keys:I,criteria:E}).then(W=>g(I.length,W))).then(()=>p.length>y+x&&b(y+l))})};return b(0).then(()=>{if(d.length>0)throw new Br("Error modifying one or more objects",d,f,h);return p.length})})})}delete(){var e=this._ctx,r=e.range;return ct(e)&&(e.isPrimKey&&!oc||r.type===3)?this._write(n=>{let{primaryKey:i}=e.table.core.schema,o=r;return e.table.core.count({trans:n,query:{index:i,range:o}}).then(s=>e.table.core.mutate({trans:n,type:"deleteRange",range:o}).then(({failures:a,lastResult:c,results:u,numFailures:l})=>{if(l)throw new Br("Could not delete some values",Object.keys(a).map(d=>a[d]),s-l);return s-l}))}):this.modify(Cn)}},Cn=(t,e)=>e.value=null;function lc(t){return qt(Hn.prototype,function(r,n){this.db=t;let i=bs,o=null;if(n)try{i=n()}catch(u){o=u}let s=r._ctx,a=s.table,c=a.hook.reading.fire;this._ctx={table:a,index:s.index,isPrimKey:!s.index||a.schema.primKey.keyPath&&s.index===a.schema.primKey.name,range:i,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:o,or:s.or,valueMapper:c!==Nt?c:null}})}function fc(t,e){return t<e?-1:t===e?0:1}function hc(t,e){return t>e?-1:t===e?0:1}function ne(t,e,r){var n=t instanceof zr?new t.Collection(t):t;return n._ctx.error=r?new r(e):new TypeError(e),n}function ut(t){return new t.Collection(t,()=>_s("")).limit(0)}function pc(t){return t==="next"?e=>e.toUpperCase():e=>e.toLowerCase()}function dc(t){return t==="next"?e=>e.toLowerCase():e=>e.toUpperCase()}function mc(t,e,r,n,i,o){for(var s=Math.min(t.length,n.length),a=-1,c=0;c<s;++c){var u=e[c];if(u!==n[c])return i(t[c],r[c])<0?t.substr(0,c)+r[c]+r.substr(c+1):i(t[c],n[c])<0?t.substr(0,c)+n[c]+r.substr(c+1):a>=0?t.substr(0,a)+e[a]+r.substr(a+1):null;i(t[c],u)<0&&(a=c)}return s<n.length&&o==="next"?t+r.substr(t.length):s<t.length&&o==="prev"?t.substr(0,r.length):a<0?null:t.substr(0,a)+n[a]+r.substr(a+1)}function Mr(t,e,r,n){var i,o,s,a,c,u,l,d=r.length;if(!r.every(p=>typeof p=="string"))return ne(t,gs);function f(p){i=pc(p),o=dc(p),s=p==="next"?fc:hc;var b=r.map(function(y){return{lower:o(y),upper:i(y)}}).sort(function(y,x){return s(y.lower,x.lower)});a=b.map(function(y){return y.upper}),c=b.map(function(y){return y.lower}),u=p,l=p==="next"?"":n}f("next");var h=new t.Collection(t,()=>We(a[0],c[d-1]+n));h._ondirectionchange=function(p){f(p)};var g=0;return h._addAlgorithm(function(p,b,y){var x=p.key;if(typeof x!="string")return!1;var v=o(x);if(e(v,c,g))return!0;for(var m=null,w=g;w<d;++w){var _=mc(x,v,a[w],c[w],s,u);_===null&&m===null?g=w+1:(m===null||s(m,_)>0)&&(m=_)}return b(m!==null?function(){p.continue(m+l)}:y),!1}),h}function We(t,e,r,n){return{type:2,lower:t,upper:e,lowerOpen:r,upperOpen:n}}function _s(t){return{type:1,lower:t,upper:t}}var zr=class{get Collection(){return this._ctx.table.db.Collection}between(e,r,n,i){n=n!==!1,i=i===!0;try{return this._cmp(e,r)>0||this._cmp(e,r)===0&&(n||i)&&!(n&&i)?ut(this):new this.Collection(this,()=>We(e,r,!n,!i))}catch(o){return ne(this,be)}}equals(e){return e==null?ne(this,be):new this.Collection(this,()=>_s(e))}above(e){return e==null?ne(this,be):new this.Collection(this,()=>We(e,void 0,!0))}aboveOrEqual(e){return e==null?ne(this,be):new this.Collection(this,()=>We(e,void 0,!1))}below(e){return e==null?ne(this,be):new this.Collection(this,()=>We(void 0,e,!1,!0))}belowOrEqual(e){return e==null?ne(this,be):new this.Collection(this,()=>We(void 0,e))}startsWith(e){return typeof e!="string"?ne(this,gs):this.between(e,e+Ne,!0,!0)}startsWithIgnoreCase(e){return e===""?this.startsWith(e):Mr(this,(r,n)=>r.indexOf(n[0])===0,[e],Ne)}equalsIgnoreCase(e){return Mr(this,(r,n)=>r===n[0],[e],"")}anyOfIgnoreCase(){var e=we.apply(lt,arguments);return e.length===0?ut(this):Mr(this,(r,n)=>n.indexOf(r)!==-1,e,"")}startsWithAnyOfIgnoreCase(){var e=we.apply(lt,arguments);return e.length===0?ut(this):Mr(this,(r,n)=>n.some(i=>r.indexOf(i)===0),e,Ne)}anyOf(){let e=we.apply(lt,arguments),r=this._cmp;try{e.sort(r)}catch(o){return ne(this,be)}if(e.length===0)return ut(this);let n=new this.Collection(this,()=>We(e[0],e[e.length-1]));n._ondirectionchange=o=>{r=o==="next"?this._ascending:this._descending,e.sort(r)};let i=0;return n._addAlgorithm((o,s,a)=>{let c=o.key;for(;r(c,e[i])>0;)if(++i,i===e.length)return s(a),!1;return r(c,e[i])===0?!0:(s(()=>{o.continue(e[i])}),!1)}),n}notEqual(e){return this.inAnyRange([[$n,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){let e=we.apply(lt,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch(n){return ne(this,be)}let r=e.reduce((n,i)=>n?n.concat([[n[n.length-1][1],i]]):[[$n,i]],null);return r.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(r,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,r){let n=this._cmp,i=this._ascending,o=this._descending,s=this._min,a=this._max;if(e.length===0)return ut(this);if(!e.every(m=>m[0]!==void 0&&m[1]!==void 0&&i(m[0],m[1])<=0))return ne(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",A.InvalidArgument);let c=!r||r.includeLowers!==!1,u=r&&r.includeUppers===!0;function l(m,w){let _=0,I=m.length;for(;_<I;++_){let E=m[_];if(n(w[0],E[1])<0&&n(w[1],E[0])>0){E[0]=s(E[0],w[0]),E[1]=a(E[1],w[1]);break}}return _===I&&m.push(w),m}let d=i;function f(m,w){return d(m[0],w[0])}let h;try{h=e.reduce(l,[]),h.sort(f)}catch(m){return ne(this,be)}let g=0,p=u?m=>i(m,h[g][1])>0:m=>i(m,h[g][1])>=0,b=c?m=>o(m,h[g][0])>0:m=>o(m,h[g][0])>=0;function y(m){return!p(m)&&!b(m)}let x=p,v=new this.Collection(this,()=>We(h[0][0],h[h.length-1][1],!c,!u));return v._ondirectionchange=m=>{m==="next"?(x=p,d=i):(x=b,d=o),h.sort(f)},v._addAlgorithm((m,w,_)=>{for(var I=m.key;x(I);)if(++g,g===h.length)return w(_),!1;return y(I)?!0:(this._cmp(I,h[g][1])===0||this._cmp(I,h[g][0])===0||w(()=>{d===i?m.continue(h[g][0]):m.continue(h[g][1])}),!1)}),v}startsWithAnyOf(){let e=we.apply(lt,arguments);return e.every(r=>typeof r=="string")?e.length===0?ut(this):this.inAnyRange(e.map(r=>[r,r+Ne])):ne(this,"startsWithAnyOf() only works with strings")}};function yc(t){return qt(zr.prototype,function(r,n,i){this.db=t,this._ctx={table:r,index:n===":id"?null:n,or:i};let o=t._deps.indexedDB;if(!o)throw new A.MissingAPI;this._cmp=this._ascending=o.cmp.bind(o),this._descending=(s,a)=>o.cmp(a,s),this._max=(s,a)=>o.cmp(s,a)>0?s:a,this._min=(s,a)=>o.cmp(s,a)<0?s:a,this._IDBKeyRange=t._deps.IDBKeyRange})}function de(t){return B(function(e){return kt(e),t(e.target.error),!1})}function kt(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}var Ft="storagemutated",Oe="x-storagemutated-1",Me=$t(null,Ft),Yn=class{_lock(){return Tt(!P.global),++this._reculock,this._reculock===1&&!P.global&&(P.lockOwnerFor=this),this}_unlock(){if(Tt(!P.global),--this._reculock===0)for(P.global||(P.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{yt(e[1],e[0])}catch(r){}}return this}_locked(){return this._reculock&&P.lockOwnerFor!==this}create(e){if(!this.mode)return this;let r=this.db.idbdb,n=this.db._state.dbOpenError;if(Tt(!this.idbtrans),!e&&!r)switch(n&&n.name){case"DatabaseClosedError":throw new A.DatabaseClosed(n);case"MissingAPIError":throw new A.MissingAPI(n.message,n);default:throw new A.OpenFailed(n)}if(!this.active)throw new A.TransactionInactive;return Tt(this._completion._state===null),e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):r.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})),e.onerror=B(i=>{kt(i),this._reject(e.error)}),e.onabort=B(i=>{kt(i),this.active&&this._reject(new A.Abort(e.error)),this.active=!1,this.on("abort").fire(i)}),e.oncomplete=B(()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&Me.storagemutated.fire(e.mutatedParts)}),this}_promise(e,r,n){if(e==="readwrite"&&this.mode!=="readwrite")return H(new A.ReadOnly("Transaction is readonly"));if(!this.active)return H(new A.TransactionInactive);if(this._locked())return new S((o,s)=>{this._blockedFuncs.push([()=>{this._promise(e,r,n).then(o,s)},P])});if(n)return Re(()=>{var o=new S((s,a)=>{this._lock();let c=r(s,a,this);c&&c.then&&c.then(s,a)});return o.finally(()=>this._unlock()),o._lib=!0,o});var i=new S((o,s)=>{var a=r(o,s,this);a&&a.then&&a.then(o,s)});return i._lib=!0,i}_root(){return this.parent?this.parent._root():this}waitFor(e){var r=this._root();let n=S.resolve(e);if(r._waitingFor)r._waitingFor=r._waitingFor.then(()=>n);else{r._waitingFor=n,r._waitingQueue=[];var i=r.idbtrans.objectStore(r.storeNames[0]);(function s(){for(++r._spinCount;r._waitingQueue.length;)r._waitingQueue.shift()();r._waitingFor&&(i.get(-1/0).onsuccess=s)})()}var o=r._waitingFor;return new S((s,a)=>{n.then(c=>r._waitingQueue.push(B(s.bind(null,c))),c=>r._waitingQueue.push(B(a.bind(null,c)))).finally(()=>{r._waitingFor===o&&(r._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new A.Abort))}table(e){let r=this._memoizedTables||(this._memoizedTables={});if(ie(r,e))return r[e];let n=this.schema[e];if(!n)throw new A.NotFound("Table "+e+" not part of transaction");let i=new this.db.Table(e,n,this);return i.core=this.db.core.table(e),r[e]=i,i}};function gc(t){return qt(Yn.prototype,function(r,n,i,o,s){this.db=t,this.mode=r,this.storeNames=n,this.schema=i,this.chromeTransactionDurability=o,this.idbtrans=null,this.on=$t(this,"complete","error","abort"),this.parent=s||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new S((a,c)=>{this._resolve=a,this._reject=c}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},a=>{var c=this.active;return this.active=!1,this.on.error.fire(a),this.parent?this.parent._reject(a):c&&this.idbtrans&&this.idbtrans.abort(),H(a)})})}function zn(t,e,r,n,i,o,s){return{name:t,keyPath:e,unique:r,multi:n,auto:i,compound:o,src:(r&&!s?"&":"")+(n?"*":"")+(i?"++":"")+ws(e)}}function ws(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function xs(t,e,r){return{name:t,primKey:e,indexes:r,mappedClass:null,idxByName:es(r,n=>[n.name,n])}}function vc(t){return t.length===1?t[0]:t}var Kt=t=>{try{return t.only([[]]),Kt=()=>[[]],[[]]}catch(e){return Kt=()=>Ne,Ne}};function Gn(t){return t==null?()=>{}:typeof t=="string"?bc(t):e=>Ie(e,t)}function bc(t){return t.split(".").length===1?r=>r[t]:r=>Ie(r,t)}function zo(t){return[].slice.call(t)}var _c=0;function Rt(t){return t==null?":id":typeof t=="string"?t:`[${t.join("+")}]`}function wc(t,e,r){function n(l,d){let f=zo(l.objectStoreNames);return{schema:{name:l.name,tables:f.map(h=>d.objectStore(h)).map(h=>{let{keyPath:g,autoIncrement:p}=h,b=Q(g),y=g==null,x={},v={name:h.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:y,compound:b,keyPath:g,autoIncrement:p,unique:!0,extractKey:Gn(g)},indexes:zo(h.indexNames).map(m=>h.index(m)).map(m=>{let{name:w,unique:_,multiEntry:I,keyPath:E}=m,W=Q(E),k={name:w,compound:W,keyPath:E,unique:_,multiEntry:I,extractKey:Gn(E)};return x[Rt(E)]=k,k}),getIndexByKeyPath:m=>x[Rt(m)]};return x[":id"]=v.primaryKey,g!=null&&(x[Rt(g)]=v.primaryKey),v})},hasGetAll:f.length>0&&"getAll"in d.objectStore(f[0])&&!(typeof navigator!="undefined"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function i(l){if(l.type===3)return null;if(l.type===4)throw new Error("Cannot convert never type to IDBKeyRange");let{lower:d,upper:f,lowerOpen:h,upperOpen:g}=l;return d===void 0?f===void 0?null:e.upperBound(f,!!g):f===void 0?e.lowerBound(d,!!h):e.bound(d,f,!!h,!!g)}function o(l){let d=l.name;function f({trans:p,type:b,keys:y,values:x,range:v}){return new Promise((m,w)=>{m=B(m);let _=p.objectStore(d),I=_.keyPath==null,E=b==="put"||b==="add";if(!E&&b!=="delete"&&b!=="deleteRange")throw new Error("Invalid operation type: "+b);let{length:W}=y||x||{length:1};if(y&&x&&y.length!==x.length)throw new Error("Given keys array must have same length as given values array.");if(W===0)return m({numFailures:0,failures:{},results:[],lastResult:void 0});let k,R=[],te=[],C=0,ue=re=>{++C,kt(re)};if(b==="deleteRange"){if(v.type===4)return m({numFailures:C,failures:te,results:[],lastResult:void 0});v.type===3?R.push(k=_.clear()):R.push(k=_.delete(i(v)))}else{let[re,oe]=E?I?[x,y]:[x,null]:[y,null];if(E)for(let Y=0;Y<W;++Y)R.push(k=oe&&oe[Y]!==void 0?_[b](re[Y],oe[Y]):_[b](re[Y])),k.onerror=ue;else for(let Y=0;Y<W;++Y)R.push(k=_[b](re[Y])),k.onerror=ue}let le=re=>{let oe=re.target.result;R.forEach((Y,_t)=>Y.error!=null&&(te[_t]=Y.error)),m({numFailures:C,failures:te,results:b==="delete"?y:R.map(Y=>Y.result),lastResult:oe})};k.onerror=re=>{ue(re),le(re)},k.onsuccess=le})}function h({trans:p,values:b,query:y,reverse:x,unique:v}){return new Promise((m,w)=>{m=B(m);let{index:_,range:I}=y,E=p.objectStore(d),W=_.isPrimaryKey?E:E.index(_.name),k=x?v?"prevunique":"prev":v?"nextunique":"next",R=b||!("openKeyCursor"in W)?W.openCursor(i(I),k):W.openKeyCursor(i(I),k);R.onerror=de(w),R.onsuccess=B(te=>{let C=R.result;if(!C){m(null);return}C.___id=++_c,C.done=!1;let ue=C.continue.bind(C),le=C.continuePrimaryKey;le&&(le=le.bind(C));let re=C.advance.bind(C),oe=()=>{throw new Error("Cursor not started")},Y=()=>{throw new Error("Cursor not stopped")};C.trans=p,C.stop=C.continue=C.continuePrimaryKey=C.advance=oe,C.fail=B(w),C.next=function(){let _t=1;return this.start(()=>_t--?this.continue():this.stop()).then(()=>this)},C.start=_t=>{let Ms=new Promise((ze,Ci)=>{ze=B(ze),R.onerror=de(Ci),C.fail=Ci,C.stop=Ds=>{C.stop=C.continue=C.continuePrimaryKey=C.advance=Y,ze(Ds)}}),on=()=>{if(R.result)try{_t()}catch(ze){C.fail(ze)}else C.done=!0,C.start=()=>{throw new Error("Cursor behind last entry")},C.stop()};return R.onsuccess=B(ze=>{R.onsuccess=on,on()}),C.continue=ue,C.continuePrimaryKey=le,C.advance=re,on(),Ms},m(C)},w)})}function g(p){return b=>new Promise((y,x)=>{y=B(y);let{trans:v,values:m,limit:w,query:_}=b,I=w===1/0?void 0:w,{index:E,range:W}=_,k=v.objectStore(d),R=E.isPrimaryKey?k:k.index(E.name),te=i(W);if(w===0)return y({result:[]});if(p){let C=m?R.getAll(te,I):R.getAllKeys(te,I);C.onsuccess=ue=>y({result:ue.target.result}),C.onerror=de(x)}else{let C=0,ue=m||!("openKeyCursor"in R)?R.openCursor(te):R.openKeyCursor(te),le=[];ue.onsuccess=re=>{let oe=ue.result;if(!oe)return y({result:le});if(le.push(m?oe.value:oe.primaryKey),++C===w)return y({result:le});oe.continue()},ue.onerror=de(x)}})}return{name:d,schema:l,mutate:f,getMany({trans:p,keys:b}){return new Promise((y,x)=>{y=B(y);let v=p.objectStore(d),m=b.length,w=new Array(m),_=0,I=0,E,W=R=>{let te=R.target;(w[te._pos]=te.result)!=null,++I===_&&y(w)},k=de(x);for(let R=0;R<m;++R)b[R]!=null&&(E=v.get(b[R]),E._pos=R,E.onsuccess=W,E.onerror=k,++_);_===0&&y(w)})},get({trans:p,key:b}){return new Promise((y,x)=>{y=B(y);let m=p.objectStore(d).get(b);m.onsuccess=w=>y(w.target.result),m.onerror=de(x)})},query:g(a),openCursor:h,count({query:p,trans:b}){let{index:y,range:x}=p;return new Promise((v,m)=>{let w=b.objectStore(d),_=y.isPrimaryKey?w:w.index(y.name),I=i(x),E=I?_.count(I):_.count();E.onsuccess=B(W=>v(W.target.result)),E.onerror=de(m)})}}}let{schema:s,hasGetAll:a}=n(t,r),c=s.tables.map(l=>o(l)),u={};return c.forEach(l=>u[l.name]=l),{stack:"dbcore",transaction:t.transaction.bind(t),table(l){if(!u[l])throw new Error(`Table '${l}' not found`);return u[l]},MIN_KEY:-1/0,MAX_KEY:Kt(e),schema:s}}function xc(t,e){return e.reduce((r,{create:n})=>({...r,...n(r)}),t)}function Ic(t,e,{IDBKeyRange:r,indexedDB:n},i){return{dbcore:xc(wc(e,r,i),t.dbcore)}}function pi({_novip:t},e){let r=e.db,n=Ic(t._middlewares,r,t._deps,e);t.core=n.dbcore,t.tables.forEach(i=>{let o=i.name;t.core.schema.tables.some(s=>s.name===o)&&(i.core=t.core.table(o),t[o]instanceof t.Table&&(t[o].core=i.core))})}function Gr({_novip:t},e,r,n){r.forEach(i=>{let o=n[i];e.forEach(s=>{let a=oi(s,i);(!a||"value"in a&&a.value===void 0)&&(s===t.Transaction.prototype||s instanceof t.Transaction?Se(s,i,{get(){return this.table(i)},set(c){Qo(this,i,{value:c,writable:!0,configurable:!0,enumerable:!0})}}):s[i]=new t.Table(i,o))})})}function Jn({_novip:t},e){e.forEach(r=>{for(let n in r)r[n]instanceof t.Table&&delete r[n]})}function Sc(t,e){return t._cfg.version-e._cfg.version}function Ec(t,e,r,n){let i=t._dbSchema,o=t._createTransaction("readwrite",t._storeNames,i);o.create(r),o._completion.catch(n);let s=o._reject.bind(o),a=P.transless||P;Re(()=>{P.trans=o,P.transless=a,e===0?($(i).forEach(c=>{di(r,c,i[c].primKey,i[c].indexes)}),pi(t,r),S.follow(()=>t.on.populate.fire(o)).catch(s)):Pc(t,e,o,r).catch(s)})}function Pc({_novip:t},e,r,n){let i=[],o=t._versions,s=t._dbSchema=mi(t,t.idbdb,n),a=!1;o.filter(l=>l._cfg.version>=e).forEach(l=>{i.push(()=>{let d=s,f=l._cfg.dbschema;Xn(t,d,n),Xn(t,f,n),s=t._dbSchema=f;let h=Is(d,f);h.add.forEach(p=>{di(n,p[0],p[1].primKey,p[1].indexes)}),h.change.forEach(p=>{if(p.recreate)throw new A.Upgrade("Not yet support for changing primary key");{let b=n.objectStore(p.name);p.add.forEach(y=>Qn(b,y)),p.change.forEach(y=>{b.deleteIndex(y.name),Qn(b,y)}),p.del.forEach(y=>b.deleteIndex(y))}});let g=l._cfg.contentUpgrade;if(g&&l._cfg.version>e){pi(t,n),r._memoizedTables={},a=!0;let p=ts(f);h.del.forEach(v=>{p[v]=d[v]}),Jn(t,[t.Transaction.prototype]),Gr(t,[t.Transaction.prototype],$(p),p),r.schema=p;let b=si(g);b&&mt();let y,x=S.follow(()=>{if(y=g(r),y&&b){var v=Ee.bind(null,null);y.then(v,v)}});return y&&typeof y.then=="function"?S.resolve(y):x.then(()=>y)}}),i.push(d=>{if(!a||!ic){let f=l._cfg.dbschema;Tc(f,d)}Jn(t,[t.Transaction.prototype]),Gr(t,[t.Transaction.prototype],t._storeNames,t._dbSchema),r.schema=t._dbSchema})});function u(){return i.length?S.resolve(i.shift()(r.idbtrans)).then(u):S.resolve()}return u().then(()=>{Ac(s,n)})}function Is(t,e){let r={del:[],add:[],change:[]},n;for(n in t)e[n]||r.del.push(n);for(n in e){let i=t[n],o=e[n];if(!i)r.add.push([n,o]);else{let s={name:n,def:o,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(o.primKey.keyPath||"")||i.primKey.auto!==o.primKey.auto&&!en)s.recreate=!0,r.change.push(s);else{let a=i.idxByName,c=o.idxByName,u;for(u in a)c[u]||s.del.push(u);for(u in c){let l=a[u],d=c[u];l?l.src!==d.src&&s.change.push(d):s.add.push(d)}(s.del.length>0||s.add.length>0||s.change.length>0)&&r.change.push(s)}}}return r}function di(t,e,r,n){let i=t.db.createObjectStore(e,r.keyPath?{keyPath:r.keyPath,autoIncrement:r.auto}:{autoIncrement:r.auto});return n.forEach(o=>Qn(i,o)),i}function Ac(t,e){$(t).forEach(r=>{e.db.objectStoreNames.contains(r)||di(e,r,t[r].primKey,t[r].indexes)})}function Tc(t,e){[].slice.call(e.db.objectStoreNames).forEach(r=>t[r]==null&&e.db.deleteObjectStore(r))}function Qn(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function mi(t,e,r){let n={};return Xr(e.objectStoreNames,0).forEach(o=>{let s=r.objectStore(o),a=s.keyPath,c=zn(ws(a),a||"",!1,!1,!!s.autoIncrement,a&&typeof a!="string",!0),u=[];for(let d=0;d<s.indexNames.length;++d){let f=s.index(s.indexNames[d]);a=f.keyPath;var l=zn(f.name,a,!!f.unique,!!f.multiEntry,!1,a&&typeof a!="string",!1);u.push(l)}n[o]=xs(o,c,u)}),n}function Wc({_novip:t},e,r){t.verno=e.version/10;let n=t._dbSchema=mi(t,e,r);t._storeNames=Xr(e.objectStoreNames,0),Gr(t,[t._allTables],$(n),n)}function Cc(t,e){let r=mi(t,t.idbdb,e),n=Is(r,t._dbSchema);return!(n.add.length||n.change.some(i=>i.add.length||i.change.length))}function Xn({_novip:t},e,r){let n=r.db.objectStoreNames;for(let i=0;i<n.length;++i){let o=n[i],s=r.objectStore(o);t._hasGetAll="getAll"in s;for(let a=0;a<s.indexNames.length;++a){let c=s.indexNames[a],u=s.index(c).keyPath,l=typeof u=="string"?u:"["+Xr(u).join("+")+"]";if(e[o]){let d=e[o].idxByName[l];d&&(d.name=c,delete e[o].idxByName[l],e[o].idxByName[c]=d)}}}typeof navigator!="undefined"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&j.WorkerGlobalScope&&j instanceof j.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}function Oc(t){return t.split(",").map((e,r)=>{e=e.trim();let n=e.replace(/([&*]|\+\+)/g,""),i=/^\[/.test(n)?n.match(/^\[(.*)\]$/)[1].split("+"):n;return zn(n,i||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),Q(i),r===0)})}var Zn=class{_parseStoresSpec(e,r){$(e).forEach(n=>{if(e[n]!==null){var i=Oc(e[n]),o=i.shift();if(o.multi)throw new A.Schema("Primary key cannot be multi-valued");i.forEach(s=>{if(s.auto)throw new A.Schema("Only primary key can be marked as autoIncrement (++)");if(!s.keyPath)throw new A.Schema("Index must have a name and cannot be an empty string")}),r[n]=xs(n,o,i)}})}stores(e){let r=this.db;this._cfg.storesSource=this._cfg.storesSource?Z(this._cfg.storesSource,e):e;let n=r._versions,i={},o={};return n.forEach(s=>{Z(i,s._cfg.storesSource),o=s._cfg.dbschema={},s._parseStoresSpec(i,o)}),r._dbSchema=o,Jn(r,[r._allTables,r,r.Transaction.prototype]),Gr(r,[r._allTables,r,r.Transaction.prototype,this._cfg.tables],$(o),o),r._storeNames=$(o),this}upgrade(e){return this._cfg.contentUpgrade=ui(this._cfg.contentUpgrade||F,e),this}};function Rc(t){return qt(Zn.prototype,function(r){this.db=t,this._cfg={version:r,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function yi(t,e){let r=t._dbNamesDB;return r||(r=t._dbNamesDB=new me(tn,{addons:[],indexedDB:t,IDBKeyRange:e}),r.version(1).stores({dbnames:"name"})),r.table("dbnames")}function gi(t){return t&&typeof t.databases=="function"}function Uc({indexedDB:t,IDBKeyRange:e}){return gi(t)?Promise.resolve(t.databases()).then(r=>r.map(n=>n.name).filter(n=>n!==tn)):yi(t,e).toCollection().primaryKeys()}function Mc({indexedDB:t,IDBKeyRange:e},r){!gi(t)&&r!==tn&&yi(t,e).put({name:r}).catch(F)}function Dc({indexedDB:t,IDBKeyRange:e},r){!gi(t)&&r!==tn&&yi(t,e).delete(r).catch(F)}function ei(t){return Re(function(){return P.letThrough=!0,t()})}function kc(){var t=!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent);if(!t||!indexedDB.databases)return Promise.resolve();var e;return new Promise(function(r){var n=function(){return indexedDB.databases().finally(r)};e=setInterval(n,100),n()}).finally(function(){return clearInterval(e)})}function Fc(t){let e=t._state,{indexedDB:r}=t._deps;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(()=>e.dbOpenError?H(e.dbOpenError):t);ye&&(e.openCanceller._stackHolder=He()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;let n=e.openCanceller;function i(){if(e.openCanceller!==n)throw new A.DatabaseClosed("db.open() was cancelled")}let o=e.dbReadyResolve,s=null,a=!1;return S.race([n,(typeof navigator=="undefined"?S.resolve():kc()).then(()=>new S((c,u)=>{if(i(),!r)throw new A.MissingAPI;let l=t.name,d=e.autoSchema?r.open(l):r.open(l,Math.round(t.verno*10));if(!d)throw new A.MissingAPI;d.onerror=de(u),d.onblocked=B(t._fireOnBlocked),d.onupgradeneeded=B(f=>{if(s=d.transaction,e.autoSchema&&!t._options.allowEmptyDB){d.onerror=kt,s.abort(),d.result.close();let g=r.deleteDatabase(l);g.onsuccess=g.onerror=B(()=>{u(new A.NoSuchDatabase(`Database ${l} doesnt exist`))})}else{s.onerror=de(u);var h=f.oldVersion>Math.pow(2,62)?0:f.oldVersion;a=h<1,t._novip.idbdb=d.result,Ec(t,h/10,s,u)}},u),d.onsuccess=B(()=>{s=null;let f=t._novip.idbdb=d.result,h=Xr(f.objectStoreNames);if(h.length>0)try{let g=f.transaction(vc(h),"readonly");e.autoSchema?Wc(t,f,g):(Xn(t,t._dbSchema,g),Cc(t,g)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),pi(t,g)}catch(g){}Ot.push(t),f.onversionchange=B(g=>{e.vcFired=!0,t.on("versionchange").fire(g)}),f.onclose=B(g=>{t.on("close").fire(g)}),a&&Mc(t._deps,l),c()},u)}))]).then(()=>(i(),e.onReadyBeingFired=[],S.resolve(ei(()=>t.on.ready.fire(t.vip))).then(function c(){if(e.onReadyBeingFired.length>0){let u=e.onReadyBeingFired.reduce(ui,F);return e.onReadyBeingFired=[],S.resolve(ei(()=>u(t.vip))).then(c)}}))).finally(()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(()=>t).catch(c=>{e.dbOpenError=c;try{s&&s.abort()}catch(u){}return n===e.openCanceller&&t._close(),H(c)}).finally(()=>{e.openComplete=!0,o()})}function ti(t){var e=s=>t.next(s),r=s=>t.throw(s),n=o(e),i=o(r);function o(s){return a=>{var c=s(a),u=c.value;return c.done?u:!u||typeof u.then!="function"?Q(u)?Promise.all(u).then(n,i):n(u):u.then(n,i)}}return o(e)()}function Kc(t,e,r){var n=arguments.length;if(n<2)throw new A.InvalidArgument("Too few arguments");for(var i=new Array(n-1);--n;)i[n-1]=arguments[n];r=i.pop();var o=rs(i);return[t,o,r]}function Ss(t,e,r,n,i){return S.resolve().then(()=>{let o=P.transless||P,s=t._createTransaction(e,r,t._dbSchema,n),a={trans:s,transless:o};if(n)s.idbtrans=n.idbtrans;else try{s.create(),t._state.PR1398_maxLoop=3}catch(d){return d.name===ci.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>Ss(t,e,r,null,i))):H(d)}let c=si(i);c&&mt();let u,l=S.follow(()=>{if(u=i.call(s,s),u)if(c){var d=Ee.bind(null,null);u.then(d,d)}else typeof u.next=="function"&&typeof u.throw=="function"&&(u=ti(u))},a);return(u&&typeof u.then=="function"?S.resolve(u).then(d=>s.active?d:H(new A.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):l.then(()=>u)).then(d=>(n&&s._resolve(),s._completion.then(()=>d))).catch(d=>(s._reject(d),H(d)))})}function Dr(t,e,r){let n=Q(t)?t.slice():[t];for(let i=0;i<r;++i)n.push(e);return n}function jc(t){return{...t,table(e){let r=t.table(e),{schema:n}=r,i={},o=[];function s(f,h,g){let p=Rt(f),b=i[p]=i[p]||[],y=f==null?0:typeof f=="string"?1:f.length,x=h>0,v={...g,isVirtual:x,keyTail:h,keyLength:y,extractKey:Gn(f),unique:!x&&g.unique};if(b.push(v),v.isPrimaryKey||o.push(v),y>1){let m=y===2?f[0]:f.slice(0,y-1);s(m,h+1,g)}return b.sort((m,w)=>m.keyTail-w.keyTail),v}let a=s(n.primaryKey.keyPath,0,n.primaryKey);i[":id"]=[a];for(let f of n.indexes)s(f.keyPath,0,f);function c(f){let h=i[Rt(f)];return h&&h[0]}function u(f,h){return{type:f.type===1?2:f.type,lower:Dr(f.lower,f.lowerOpen?t.MAX_KEY:t.MIN_KEY,h),lowerOpen:!0,upper:Dr(f.upper,f.upperOpen?t.MIN_KEY:t.MAX_KEY,h),upperOpen:!0}}function l(f){let h=f.query.index;return h.isVirtual?{...f,query:{index:h,range:u(f.query.range,h.keyTail)}}:f}return{...r,schema:{...n,primaryKey:a,indexes:o,getIndexByKeyPath:c},count(f){return r.count(l(f))},query(f){return r.query(l(f))},openCursor(f){let{keyTail:h,isVirtual:g,keyLength:p}=f.query.index;if(!g)return r.openCursor(f);function b(y){function x(m){m!=null?y.continue(Dr(m,f.reverse?t.MAX_KEY:t.MIN_KEY,h)):f.unique?y.continue(y.key.slice(0,p).concat(f.reverse?t.MIN_KEY:t.MAX_KEY,h)):y.continue()}return Object.create(y,{continue:{value:x},continuePrimaryKey:{value(m,w){y.continuePrimaryKey(Dr(m,t.MAX_KEY,h),w)}},primaryKey:{get(){return y.primaryKey}},key:{get(){let m=y.key;return p===1?m[0]:m.slice(0,p)}},value:{get(){return y.value}}})}return r.openCursor(l(f)).then(y=>y&&b(y))}}}}}var Lc={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:jc};function vi(t,e,r,n){return r=r||{},n=n||"",$(t).forEach(i=>{if(!ie(e,i))r[n+i]=void 0;else{var o=t[i],s=e[i];if(typeof o=="object"&&typeof s=="object"&&o&&s){let a=Rn(o),c=Rn(s);a!==c?r[n+i]=e[i]:a==="Object"?vi(o,s,r,n+i+"."):o!==s&&(r[n+i]=e[i])}else o!==s&&(r[n+i]=e[i])}}),$(e).forEach(i=>{ie(t,i)||(r[n+i]=e[i])}),r}function Nc(t,e){return e.type==="delete"?e.keys:e.keys||e.values.map(t.extractKey)}var Bc={stack:"dbcore",name:"HooksMiddleware",level:2,create:t=>({...t,table(e){let r=t.table(e),{primaryKey:n}=r.schema;return{...r,mutate(o){let s=P.trans,{deleting:a,creating:c,updating:u}=s.table(e).hook;switch(o.type){case"add":if(c.fire===F)break;return s._promise("readwrite",()=>l(o),!0);case"put":if(c.fire===F&&u.fire===F)break;return s._promise("readwrite",()=>l(o),!0);case"delete":if(a.fire===F)break;return s._promise("readwrite",()=>l(o),!0);case"deleteRange":if(a.fire===F)break;return s._promise("readwrite",()=>d(o),!0)}return r.mutate(o);function l(h){let g=P.trans,p=h.keys||Nc(n,h);if(!p)throw new Error("Keys missing");return h=h.type==="add"||h.type==="put"?{...h,keys:p}:{...h},h.type!=="delete"&&(h.values=[...h.values]),h.keys&&(h.keys=[...h.keys]),Vc(r,h,p).then(b=>{let y=p.map((x,v)=>{let m=b[v],w={onerror:null,onsuccess:null};if(h.type==="delete")a.fire.call(w,x,m,g);else if(h.type==="add"||m===void 0){let _=c.fire.call(w,x,h.values[v],g);x==null&&_!=null&&(x=_,h.keys[v]=x,n.outbound||he(h.values[v],n.keyPath,x))}else{let _=vi(m,h.values[v]),I=u.fire.call(w,_,x,m,g);if(I){let E=h.values[v];Object.keys(I).forEach(W=>{ie(E,W)?E[W]=I[W]:he(E,W,I[W])})}}return w});return r.mutate(h).then(({failures:x,results:v,numFailures:m,lastResult:w})=>{for(let _=0;_<p.length;++_){let I=v?v[_]:p[_],E=y[_];I==null?E.onerror&&E.onerror(x[_]):E.onsuccess&&E.onsuccess(h.type==="put"&&b[_]?h.values[_]:I)}return{failures:x,results:v,numFailures:m,lastResult:w}}).catch(x=>(y.forEach(v=>v.onerror&&v.onerror(x)),Promise.reject(x)))})}function d(h){return f(h.trans,h.range,1e4)}function f(h,g,p){return r.query({trans:h,values:!1,query:{index:n,range:g},limit:p}).then(({result:b})=>l({type:"delete",keys:b,trans:h}).then(y=>y.numFailures>0?Promise.reject(y.failures[0]):b.length<p?{failures:[],numFailures:0,lastResult:void 0}:f(h,{...g,lower:b[b.length-1],lowerOpen:!0},p)))}}}}})};function Vc(t,e,r){return e.type==="add"?Promise.resolve([]):t.getMany({trans:e.trans,keys:r,cache:"immutable"})}function Es(t,e,r){try{if(!e||e.keys.length<t.length)return null;let n=[];for(let i=0,o=0;i<e.keys.length&&o<t.length;++i)X(e.keys[i],t[o])===0&&(n.push(r?Lt(e.values[i]):e.values[i]),++o);return n.length===t.length?n:null}catch(n){return null}}var $c={stack:"dbcore",level:-1,create:t=>({table:e=>{let r=t.table(e);return{...r,getMany:n=>{if(!n.cache)return r.getMany(n);let i=Es(n.keys,n.trans._cache,n.cache==="clone");return i?S.resolve(i):r.getMany(n).then(o=>(n.trans._cache={keys:n.keys,values:n.cache==="clone"?Lt(o):o},o))},mutate:n=>(n.type!=="add"&&(n.trans._cache=null),r.mutate(n))}}})};function bi(t){return!("from"in t)}var _e=function(t,e){if(this)Z(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0});else{let r=new _e;return t&&"d"in t&&Z(r,t),r}};ht(_e.prototype,{add(t){return Jr(this,t),this},addKey(t){return jt(this,t,t),this},addKeys(t){return t.forEach(e=>jt(this,e,e)),this},[Un](){return ri(this)}});function jt(t,e,r){let n=X(e,r);if(isNaN(n))return;if(n>0)throw RangeError();if(bi(t))return Z(t,{from:e,to:r,d:1});let i=t.l,o=t.r;if(X(r,t.from)<0)return i?jt(i,e,r):t.l={from:e,to:r,d:1,l:null,r:null},Go(t);if(X(e,t.to)>0)return o?jt(o,e,r):t.r={from:e,to:r,d:1,l:null,r:null},Go(t);X(e,t.from)<0&&(t.from=e,t.l=null,t.d=o?o.d+1:1),X(r,t.to)>0&&(t.to=r,t.r=null,t.d=t.l?t.l.d+1:1);let s=!t.r;i&&!t.l&&Jr(t,i),o&&s&&Jr(t,o)}function Jr(t,e){function r(n,{from:i,to:o,l:s,r:a}){jt(n,i,o),s&&r(n,s),a&&r(n,a)}bi(e)||r(t,e)}function qc(t,e){let r=ri(e),n=r.next();if(n.done)return!1;let i=n.value,o=ri(t),s=o.next(i.from),a=s.value;for(;!n.done&&!s.done;){if(X(a.from,i.to)<=0&&X(a.to,i.from)>=0)return!0;X(i.from,a.from)<0?i=(n=r.next(a.from)).value:a=(s=o.next(i.from)).value}return!1}function ri(t){let e=bi(t)?null:{s:0,n:t};return{next(r){let n=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,n)for(;e.n.l&&X(r,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!n||X(r,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function Go(t){var e,r;let n=(((e=t.r)===null||e===void 0?void 0:e.d)||0)-(((r=t.l)===null||r===void 0?void 0:r.d)||0),i=n>1?"r":n<-1?"l":"";if(i){let o=i==="r"?"l":"r",s={...t},a=t[i];t.from=a.from,t.to=a.to,t[i]=a[i],s[i]=a[o],t[o]=s,s.d=Jo(s)}t.d=Jo(t)}function Jo({r:t,l:e}){return(t?e?Math.max(t.d,e.d):t.d:e?e.d:0)+1}var Hc={stack:"dbcore",level:0,create:t=>{let e=t.schema.name,r=new _e(t.MIN_KEY,t.MAX_KEY);return{...t,table:n=>{let i=t.table(n),{schema:o}=i,{primaryKey:s}=o,{extractKey:a,outbound:c}=s,u={...i,mutate:f=>{let h=f.trans,g=h.mutatedParts||(h.mutatedParts={}),p=_=>{let I=`idb://${e}/${n}/${_}`;return g[I]||(g[I]=new _e)},b=p(""),y=p(":dels"),{type:x}=f,[v,m]=f.type==="deleteRange"?[f.range]:f.type==="delete"?[f.keys]:f.values.length<50?[[],f.values]:[],w=f.trans._cache;return i.mutate(f).then(_=>{if(Q(v)){x!=="delete"&&(v=_.results),b.addKeys(v);let I=Es(v,w);!I&&x!=="add"&&y.addKeys(v),(I||m)&&Yc(p,o,I,m)}else if(v){let I={from:v.lower,to:v.upper};y.add(I),b.add(I)}else b.add(r),y.add(r),o.indexes.forEach(I=>p(I.name).add(r));return _})}},l=({query:{index:f,range:h}})=>{var g,p;return[f,new _e((g=h.lower)!==null&&g!==void 0?g:t.MIN_KEY,(p=h.upper)!==null&&p!==void 0?p:t.MAX_KEY)]},d={get:f=>[s,new _e(f.key)],getMany:f=>[s,new _e().addKeys(f.keys)],count:l,query:l,openCursor:l};return $(d).forEach(f=>{u[f]=function(h){let{subscr:g}=P;if(g){let p=m=>{let w=`idb://${e}/${n}/${m}`;return g[w]||(g[w]=new _e)},b=p(""),y=p(":dels"),[x,v]=d[f](h);if(p(x.name||"").add(v),!x.isPrimaryKey)if(f==="count")y.add(r);else{let m=f==="query"&&c&&h.values&&i.query({...h,values:!1});return i[f].apply(this,arguments).then(w=>{if(f==="query"){if(c&&h.values)return m.then(({result:I})=>(b.addKeys(I),w));let _=h.values?w.result.map(a):w.result;h.values?b.addKeys(_):y.addKeys(_)}else if(f==="openCursor"){let _=w,I=h.values;return _&&Object.create(_,{key:{get(){return y.addKey(_.primaryKey),_.key}},primaryKey:{get(){let E=_.primaryKey;return y.addKey(E),E}},value:{get(){return I&&b.addKey(_.primaryKey),_.value}}})}return w})}}return i[f].apply(this,arguments)}}),u}}}};function Yc(t,e,r,n){function i(o){let s=t(o.name||"");function a(u){return u!=null?o.extractKey(u):null}let c=u=>o.multiEntry&&Q(u)?u.forEach(l=>s.addKey(l)):s.addKey(u);(r||n).forEach((u,l)=>{let d=r&&a(r[l]),f=n&&a(n[l]);X(d,f)!==0&&(d!=null&&c(d),f!=null&&c(f))})}e.indexes.forEach(i)}var me=class{constructor(e,r){this._middlewares={},this.verno=0;let n=me.dependencies;this._options=r={addons:me.addons,autoOpen:!0,indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange,...r},this._deps={indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange};let{addons:i}=r;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;let o={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:F,dbReadyPromise:null,cancelOpen:F,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};o.dbReadyPromise=new S(s=>{o.dbReadyResolve=s}),o.openCanceller=new S((s,a)=>{o.cancelOpen=a}),this._state=o,this.name=e,this.on=$t(this,"populate","blocked","versionchange","close",{ready:[ui,F]}),this.on.ready.subscribe=Xo(this.on.ready.subscribe,s=>(a,c)=>{me.vip(()=>{let u=this._state;if(u.openComplete)u.dbOpenError||S.resolve().then(a),c&&s(a);else if(u.onReadyBeingFired)u.onReadyBeingFired.push(a),c&&s(a);else{s(a);let l=this;c||s(function d(){l.on.ready.unsubscribe(a),l.on.ready.unsubscribe(d)})}})}),this.Collection=lc(this),this.Table=sc(this),this.Transaction=gc(this),this.Version=Rc(this),this.WhereClause=yc(this),this.on("versionchange",s=>{s.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",s=>{!s.newVersion||s.newVersion<s.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${s.oldVersion/10}`)}),this._maxKey=Kt(r.IDBKeyRange),this._createTransaction=(s,a,c,u)=>new this.Transaction(s,a,c,this._options.chromeTransactionDurability,u),this._fireOnBlocked=s=>{this.on("blocked").fire(s),Ot.filter(a=>a.name===this.name&&a!==this&&!a._state.vcFired).map(a=>a.on("versionchange").fire(s))},this.use(Lc),this.use(Bc),this.use(Hc),this.use($c),this.vip=Object.create(this,{_vip:{value:!0}}),i.forEach(s=>s(this))}version(e){if(isNaN(e)||e<.1)throw new A.Type("Given version is not a positive number");if(e=Math.round(e*10)/10,this.idbdb||this._state.isBeingOpened)throw new A.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);let r=this._versions;var n=r.filter(i=>i._cfg.version===e)[0];return n||(n=new this.Version(e),r.push(n),r.sort(Sc),n.stores({}),this._state.autoSchema=!1,n)}_whenReady(e){return this.idbdb&&(this._state.openComplete||P.letThrough||this._vip)?e():new S((r,n)=>{if(this._state.openComplete)return n(new A.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen){n(new A.DatabaseClosed);return}this.open().catch(F)}this._state.dbReadyPromise.then(r,n)}).then(e)}use({stack:e,create:r,level:n,name:i}){i&&this.unuse({stack:e,name:i});let o=this._middlewares[e]||(this._middlewares[e]=[]);return o.push({stack:e,create:r,level:n==null?10:n,name:i}),o.sort((s,a)=>s.level-a.level),this}unuse({stack:e,name:r,create:n}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(i=>n?i.create!==n:r?i.name!==r:!1)),this}open(){return Fc(this)}_close(){let e=this._state,r=Ot.indexOf(this);if(r>=0&&Ot.splice(r,1),this.idbdb){try{this.idbdb.close()}catch(n){}this._novip.idbdb=null}e.dbReadyPromise=new S(n=>{e.dbReadyResolve=n}),e.openCanceller=new S((n,i)=>{e.cancelOpen=i})}close(){this._close();let e=this._state;this._options.autoOpen=!1,e.dbOpenError=new A.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){let e=arguments.length>0,r=this._state;return new S((n,i)=>{let o=()=>{this.close();var s=this._deps.indexedDB.deleteDatabase(this.name);s.onsuccess=B(()=>{Dc(this._deps,this.name),n()}),s.onerror=de(i),s.onblocked=this._fireOnBlocked};if(e)throw new A.InvalidArgument("Arguments not allowed in db.delete()");r.isBeingOpened?r.dbReadyPromise.then(o):o()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){let e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return $(this._allTables).map(e=>this._allTables[e])}transaction(){let e=Kc.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,r,n){let i=P.trans;(!i||i.db!==this||e.indexOf("!")!==-1)&&(i=null);let o=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");let s,a;try{if(a=r.map(u=>{var l=u instanceof this.Table?u.name:u;if(typeof l!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return l}),e=="r"||e===Pn)s=Pn;else if(e=="rw"||e==An)s=An;else throw new A.InvalidArgument("Invalid transaction mode: "+e);if(i){if(i.mode===Pn&&s===An)if(o)i=null;else throw new A.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i&&a.forEach(u=>{if(i&&i.storeNames.indexOf(u)===-1)if(o)i=null;else throw new A.SubTransaction("Table "+u+" not included in parent transaction.")}),o&&i&&!i.active&&(i=null)}}catch(u){return i?i._promise(null,(l,d)=>{d(u)}):H(u)}let c=Ss.bind(null,this,s,a,i,n);return i?i._promise(s,c,"lock"):P.trans?yt(P.transless,()=>this._whenReady(c)):this._whenReady(c)}table(e){if(!ie(this._allTables,e))throw new A.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}},zc=typeof Symbol!="undefined"&&"observable"in Symbol?Symbol.observable:"@@observable",ni=class{constructor(e){this._subscribe=e}subscribe(e,r,n){return this._subscribe(!e||typeof e=="function"?{next:e,error:r,complete:n}:e)}[zc](){return this}};function Ps(t,e){return $(e).forEach(r=>{let n=t[r]||(t[r]=new _e);Jr(n,e[r])}),t}function _i(t){return new ni(e=>{let r=si(t);function n(h){r&&mt();let g=()=>Re(t,{subscr:h,trans:null}),p=P.trans?yt(P.transless,g):g();return r&&p.then(Ee,Ee),p}let i=!1,o={},s={},a={get closed(){return i},unsubscribe:()=>{i=!0,Me.storagemutated.unsubscribe(d)}};e.start&&e.start(a);let c=!1,u=!1;function l(){return $(s).some(h=>o[h]&&qc(o[h],s[h]))}let d=h=>{Ps(o,h),l()&&f()},f=()=>{if(c||i)return;o={};let h={},g=n(h);u||(Me(Ft,d),u=!0),c=!0,Promise.resolve(g).then(p=>{c=!1,!i&&(l()?f():(o={},s=h,e.next&&e.next(p)))},p=>{c=!1,e.error&&e.error(p),a.unsubscribe()})};return f(),a})}var ii;try{ii={indexedDB:j.indexedDB||j.mozIndexedDB||j.webkitIndexedDB||j.msIndexedDB,IDBKeyRange:j.IDBKeyRange||j.webkitIDBKeyRange}}catch(t){ii={indexedDB:null,IDBKeyRange:null}}var Le=me;ht(Le,{...Zr,delete(t){return new Le(t,{addons:[]}).delete()},exists(t){return new Le(t,{addons:[]}).open().then(e=>(e.close(),!0)).catch("NoSuchDatabaseError",()=>!1)},getDatabaseNames(t){try{return Uc(Le.dependencies).then(t)}catch(e){return H(new A.MissingAPI)}},defineClass(){function t(e){Z(this,e)}return t},ignoreTransaction(t){return P.trans?yt(P.transless,t):t()},vip:ei,async:function(t){return function(){try{var e=ti(t.apply(this,arguments));return!e||typeof e.then!="function"?S.resolve(e):e}catch(r){return H(r)}}},spawn:function(t,e,r){try{var n=ti(t.apply(r,e||[]));return!n||typeof n.then!="function"?S.resolve(n):n}catch(i){return H(i)}},currentTransaction:{get:()=>P.trans||null},waitFor:function(t,e){let r=S.resolve(typeof t=="function"?Le.ignoreTransaction(t):t).timeout(e||6e4);return P.trans?P.trans.waitFor(r):r},Promise:S,debug:{get:()=>ye,set:t=>{is(t,t==="dexie"?()=>!0:vs)}},derive:pt,extend:Z,props:ht,override:Xo,Events:$t,on:Me,liveQuery:_i,extendObservabilitySet:Ps,getByKeyPath:Ie,setByKeyPath:he,delByKeyPath:Ra,shallowClone:ts,deepClone:Lt,getObjectDiff:vi,cmp:X,asap:Zo,minKey:$n,addons:[],connections:Ot,errnames:ci,dependencies:ii,semVer:Vo,version:Vo.split(".").map(t=>parseInt(t)).reduce((t,e,r)=>t+e/Math.pow(10,r*2))});Le.maxKey=Kt(Le.dependencies.IDBKeyRange);typeof dispatchEvent!="undefined"&&typeof addEventListener!="undefined"&&(Me(Ft,t=>{if(!xe){let e;en?(e=document.createEvent("CustomEvent"),e.initCustomEvent(Oe,!0,!0,t)):e=new CustomEvent(Oe,{detail:t}),xe=!0,dispatchEvent(e),xe=!1}}),addEventListener(Oe,({detail:t})=>{xe||Qr(t)}));function Qr(t){let e=xe;try{xe=!0,Me.storagemutated.fire(t)}finally{xe=e}}var xe=!1;if(typeof BroadcastChannel!="undefined"){let t=new BroadcastChannel(Oe);Me(Ft,e=>{xe||t.postMessage(e)}),t.onmessage=e=>{e.data&&Qr(e.data)}}else if(typeof self!="undefined"&&typeof navigator!="undefined"){Me(Ft,e=>{try{xe||(typeof localStorage!="undefined"&&localStorage.setItem(Oe,JSON.stringify({trig:Math.random(),changedParts:e})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(r=>r.postMessage({type:Oe,changedParts:e})))}catch(r){}}),typeof addEventListener!="undefined"&&addEventListener("storage",e=>{if(e.key===Oe){let r=JSON.parse(e.newValue);r&&Qr(r.changedParts)}});let t=self.document&&navigator.serviceWorker;t&&t.addEventListener("message",Gc)}function Gc({data:t}){t&&t.type===Oe&&Qr(t.changedParts)}S.rejectionMapper=Na;is(ye,vs);var Ws=or(Ii());var Wi={};Ns(Wi,{addProductToWishlistItem:()=>Ei,filterWishlistItem:()=>Ti,findProductVariant:()=>Pi,findWishlistItem:()=>Zc,getSessionId:()=>rn,isWishlistItem:()=>Ai,loginRequired:()=>Qc,mapApiToCacheProductInfo:()=>Ye,mapApiToProductInfo:()=>nn,mapApiToWishlist:()=>Si,mapApiToWishlistItem:()=>Ts,mapApiToWishlistItemRef:()=>Xc});var As=or(Ii()),Jc=new As.default({length:10}),rn=()=>{if(localStorage.getItem("wk_session_id"))return localStorage.getItem("wk_session_id");let t=localStorage.getItem("appmate-session");if(t)try{let r=JSON.parse(t).state.sid;return localStorage.setItem("wk_session_id",r),r}catch(r){console.error(r)}let e=Jc();return localStorage.setItem("wk_session_id",e),e},Qc=(t,e)=>!!t&&!e;function Si(t,e){return{id:t.isMine?"mine":t.id,publicId:t.publicId,isMine:t.isMine,numItems:t.numItems,items:e==="all"?t.items:void 0}}function nn({productInfo:t,variantId:e}){let r=t.wishlistItems.find(n=>e?n.variantId===e:!0);return{productId:t.productId,variantId:e,inWishlist:!!r,wishlistItemId:r==null?void 0:r.id}}function Ye({productInfo:t}){let e=t.wishlistItems.map(r=>r.id);return{...t,wishlistItemIds:e.length?e:void 0}}function Ts(t){return t}function Xc(t){return t}function Ei(t,e){return{...t,product:e}}function Zc(t,e){var r;return(r=t.items)==null?void 0:r.find(n=>Ai(n,e))}function Pi(t,e){return t.variants.find(r=>r.id===e)}function Ai(t,e){return t.id===e.itemId}function Ti(t,e){return t==null?void 0:t.filter(r=>!Ai(r,e))}var eu=new Ws.default({length:10}),gt=class extends me{constructor(){super("WishlistKing");this.version(1).stores({shopifyProducts:"handle",wishlists:"id",wishlistItems:"id",productInfo:"productId,*wishlistItemIds"})}storeShopifyProduct({product:r}){return U(q(()=>this.shopifyProducts.put(r)).pipe(O(()=>r)))}storeWishlist({wishlist:r}){return this.getWishlist({wishlistId:r.id}).pipe(G(()=>Ke(null)),D(n=>{var i;return U(this.wishlists.put({...r,items:(i=r.items)!=null?i:n==null?void 0:n.items}))}),O(()=>r))}storeProductInfo({productInfo:r}){return U(q(()=>this.productInfo.put(Ye({productInfo:r}))))}storeWishlistItem({wishlistItem:r}){return U(q(()=>this.wishlistItems.put(r)))}getProductInfo({productId:r}){return U(q(()=>this.productInfo.get(r)))}getProductInfoByItemId({itemId:r}){return U(q(()=>this.productInfo.where("wishlistItemIds").equals(r).first()))}getProductInfos(){return U(q(()=>this.productInfo.toArray()))}getWishlist({wishlistId:r}){return U(q(()=>this.wishlists.get(r)))}getWishlistItems(){return U(q(()=>this.wishlistItems.toArray()))}getShopifyProduct({productHandle:r}){return U(q(()=>this.shopifyProducts.get(r)).pipe(O(n=>{if(!n)throw new Error("Product not found");return n})))}getWishlistItem({itemId:r}){return U(q(()=>this.wishlistItems.get(r)))}addItemToWishlist({productId:r,variantId:n}){return ce([this.getWishlist({wishlistId:"mine"}),this.getProductInfo({productId:r})]).pipe(D(([i,o])=>{let s={id:`temp-${eu()}`},a=tu({wishlistId:"mine",item:s},i),c=()=>this.wishlists.put(a),u=()=>i?this.wishlists.put(i):this.wishlists.delete("mine"),l=()=>this.productInfo.put(Ye({productInfo:{productId:r,wishlistItems:o?[...o.wishlistItems,{id:s.id,variantId:n}]:[{id:s.id,variantId:n}]}})),d=()=>o?this.productInfo.put(o):this.productInfo.delete(r);return U(q(()=>this.transaction("rw",this.wishlists,this.productInfo,()=>Promise.all([c(),l()])))).pipe(O(()=>({wishlist:a,item:s,revertStateUpdate:()=>U(this.transaction("rw",this.wishlists,this.productInfo,()=>Promise.all([u(),d()])))})))}))}removeItemFromWishlist({itemId:r}){return ce([this.getWishlist({wishlistId:"mine"}),this.getProductInfoByItemId({itemId:r}),this.getWishlistItem({itemId:r})]).pipe(D(([n,i,o])=>{let s=ru({itemId:r},n),a=()=>this.wishlists.put(s),c=()=>n?this.wishlists.put(n):this.wishlists.delete("mine"),u=()=>{if(i)return this.productInfo.put(Ye({productInfo:{productId:i.productId,wishlistItems:i.wishlistItems.filter(h=>h.id!==r)}}))},l=()=>{if(i)return this.productInfo.put(i)},d=()=>{if(o)return this.wishlistItems.delete(o.id)},f=()=>{if(o)return this.wishlistItems.put(o)};return U(q(()=>this.transaction("rw",this.wishlists,this.productInfo,this.wishlistItems,()=>Promise.all([a(),u(),d()])))).pipe(O(()=>({wishlist:s,revertStateUpdate:()=>U(this.transaction("rw",this.wishlists,this.productInfo,this.wishlistItems,()=>Promise.all([c(),l(),f()])))})))}))}clearWishlist(){return ce([this.getWishlist({wishlistId:"mine"}),this.getProductInfos(),this.getWishlistItems()]).pipe(D(([r,n,i])=>{let o=nu(r),s=()=>{if(o)return this.wishlists.put(o)},a=()=>{var f;return r?this.wishlists.put(r):this.wishlists.delete((f=o==null?void 0:o.id)!=null?f:"mine")},c=()=>this.productInfo.clear(),u=()=>{if(n)return this.productInfo.bulkPut(n)},l=()=>this.wishlistItems.clear(),d=()=>{if(i)return this.wishlistItems.bulkPut(i)};return U(q(()=>this.transaction("rw",this.wishlists,this.productInfo,this.wishlistItems,()=>Promise.all([s(),c(),l()])))).pipe(O(()=>({wishlist:o,revertStateUpdate:()=>U(this.transaction("rw",this.wishlists,this.productInfo,this.wishlistItems,()=>Promise.all([a(),u(),d()])))})))}))}updateWishlistItem({itemId:r,changes:n}){return ce([this.getWishlistItem({itemId:r}),this.getProductInfoByItemId({itemId:r})]).pipe(D(([i,o])=>{let s=()=>{if(i)return this.wishlistItems.put({...i,selectedVariantId:n.variantId})},a=()=>{if(i)return this.wishlistItems.put(i)},c=()=>{if(o)return this.productInfo.put(Ye({productInfo:{...o,wishlistItems:o.wishlistItems.map(l=>l.id===r?{...l,variantId:n.variantId}:l)}}))},u=()=>{if(o)return this.productInfo.put(o)};return U(q(()=>this.transaction("rw",this.wishlistItems,this.productInfo,()=>Promise.all([s(),c()])))).pipe(O(()=>({revertStateUpdate:()=>U(this.transaction("rw",this.wishlistItems,this.productInfo,()=>Promise.all([a(),u()])))})))}))}changeWishlistItemRef({itemId:r,changes:n}){return ce([this.getWishlist({wishlistId:"mine"}),this.getProductInfoByItemId({itemId:r})]).pipe(D(([i,o])=>{let s={id:n.id},a=()=>{var u;if(i)return this.wishlists.put({...i,items:(u=i.items)==null?void 0:u.map(l=>l.id===r?s:l)})},c=()=>{if(o)return this.productInfo.put(Ye({productInfo:{...o,wishlistItems:o.wishlistItems.map(u=>u.id===r?{...u,id:n.id}:u)}}))};return U(Promise.all([a(),c()])).pipe(O(()=>({item:s})))}))}liveQuery(r){return new M(n=>{_i(r).subscribe({error:n.error.bind(n),next:n.next.bind(n),complete:n.complete.bind(n)})})}},tu=(t,e)=>e?{...e,numItems:e.numItems+1,items:e.items?[...e.items,t.item]:[t.item]}:{id:t.wishlistId,publicId:void 0,isMine:!0,numItems:1,items:[t.item]},ru=(t,e)=>e?{...e,numItems:e.numItems-1,items:e.items?Ti(e.items,t):[]}:{id:"mine",publicId:void 0,isMine:!0,numItems:0},nu=t=>{if(!!t)return{...t,numItems:0,items:[]}};function Ht(){return mn(wn(t=>t!=null))}var vt=class{constructor({wishlistApi:e,shopifyApi:r,settings:n,events:i,utils:o}){this.cacheDb=new gt;this.cacheDb.open(),this.wishlistApi=e,this.shopifyApi=r,this.settings=n,this.loadWishlistCache=new Map,this.loadWishlistItemCache=new Map,this.loadProductInfoCache=new Map,this.loadShopifyProductCache=new Map,this.events=i,this.utils=o}loadWishlist({wishlistId:e,format:r}){let n=[e,r].join("-");if(!this.loadWishlistCache.has(n)){let i=this.wishlistApi.loadWishlist({wishlistId:e,format:r}),o=s=>this.cacheDb.storeWishlist({wishlist:s}).pipe(O(()=>Si(s,r)));this.loadWishlistCache.set(n,i.pipe(D(({wishlist:s})=>o(s)),it()))}return this.loadWishlistCache.get(n)}observeWishlist({wishlistId:e,format:r}){let n=this.loadWishlist({wishlistId:e,format:r}),i=this.cacheDb.liveQuery(()=>this.cacheDb.wishlists.get(e));return n.pipe(nt(i),Ht(),rt((o,s)=>JSON.stringify(o)===JSON.stringify(s)))}loadProductInfo({productId:e,variantId:r=0}){if(!this.loadProductInfoCache.has(e)){let n=this.wishlistApi.loadProductInfo({productId:e}),i=o=>this.cacheDb.storeProductInfo({productInfo:o}).pipe(O(()=>nn({productInfo:o,variantId:r})));this.loadProductInfoCache.set(e,n.pipe(D(({productInfo:o})=>i(o)),it()))}return this.loadProductInfoCache.get(e)}observeProductInfo({productId:e,variantId:r}){let n={productId:e,variantId:r,inWishlist:!1},i=this.loadProductInfo({productId:e}),o=this.cacheDb.liveQuery(()=>this.cacheDb.productInfo.get(e)).pipe(O(s=>s?nn({productInfo:s,variantId:r}):void 0));return i.pipe(nt(o),Ht(),Tr(n),rt((s,a)=>JSON.stringify(s)===JSON.stringify(a)),G(s=>(console.error(s),Ke(n))))}loadWishlistItem({wishlistId:e,itemId:r}){let n=r;if(!this.loadWishlistItemCache.has(n)){let i=this.wishlistApi.loadWishlistItem({wishlistId:e,itemId:r}),o=s=>this.cacheDb.storeWishlistItem({wishlistItem:s}).pipe(O(()=>s));this.loadWishlistItemCache.set(n,i.pipe(D(({wishlistItem:s})=>o(s)),it()))}return this.loadWishlistItemCache.get(n)}observeWishlistItem({wishlistId:e,itemId:r}){let n={id:r,product:{id:0,handle:""}},i=this.loadWishlistItem({wishlistId:e,itemId:r}),o=this.cacheDb.liveQuery(()=>this.cacheDb.wishlistItems.get(r)).pipe(O(a=>a?a:null)),s=a=>a.product.handle?this.observeShopifyProduct({productHandle:a.product.handle}).pipe(O(c=>Ei(a,c))):Ke(a);return i.pipe(Tr(n),nt(o),Ht(),D(a=>s(a)),rt((a,c)=>JSON.stringify(a)===JSON.stringify(c)))}loadShopifyProduct({productHandle:e}){let r=e;if(!this.loadShopifyProductCache.has(r)){let n=this.shopifyApi.loadProduct({productHandle:e}),i=o=>this.cacheDb.storeShopifyProduct({product:o}).pipe(O(()=>o));this.loadShopifyProductCache.set(r,n.pipe(D(o=>i(o)),it()))}return this.loadShopifyProductCache.get(r)}observeShopifyProduct({productHandle:e}){let r=this.loadShopifyProduct({productHandle:e}),n=this.cacheDb.liveQuery(()=>this.cacheDb.shopifyProducts.get(e));return r.pipe(nt(n),Ht(),rt((i,o)=>JSON.stringify(i)===JSON.stringify(o)))}loadWishlistProduct({wishlistId:e,itemId:r}){return this.loadWishlistItem({wishlistId:e,itemId:r}).pipe(D(n=>this.loadShopifyProduct({productHandle:n.product.handle})))}publishWishlistItemEvent({eventName:e,wishlistId:r,productHandle:n,variantId:i}){return ce([this.loadWishlist({wishlistId:r,format:"minimal"}),this.loadShopifyProduct({productHandle:n})]).pipe(Wr(([o,s])=>this.events.publish({name:e,data:{wishlist:o,product:s,variant:Pi(s,i),quantity:1}})))}publishWishlistEvent({eventName:e,wishlistId:r}){return this.loadWishlist({wishlistId:r,format:"minimal"}).pipe(Wr(n=>this.events.publish({name:e,data:{wishlist:n}})))}addWishlistItem(e){let r=typeof e.productId=="string"?parseInt(e.productId):e.productId,n=typeof e.variantId=="string"?parseInt(e.variantId):e.variantId,i=this.cacheDb.addItemToWishlist({productId:r,variantId:n}),o=this.wishlistApi.addItem({productId:r,variantId:n});return i.pipe(D(({item:s,revertStateUpdate:a})=>o.pipe(D(({wishlistItem:c})=>ce([this.cacheDb.storeWishlistItem({wishlistItem:c}),this.cacheDb.changeWishlistItemRef({itemId:s.id,changes:{id:c.id}})]).pipe(O(()=>({wishlistItem:c})))),D(c=>this.publishWishlistItemEvent({wishlistId:"mine",eventName:"addToWishlistSuccess",productHandle:c.wishlistItem.product.handle,variantId:c.wishlistItem.selectedVariantId}).pipe(O(()=>c))),G(c=>(console.error(c),this.events.publish({name:"addToWishlistError"}),a())))))}updateWishlistItem(e){let r={variantId:typeof e.changes.variantId=="string"?parseInt(e.changes.variantId):e.changes.variantId},n=this.cacheDb.updateWishlistItem({itemId:e.itemId,changes:r}),i=this.wishlistApi.updateItem({itemId:e.itemId,changes:r});return n.pipe(D(({revertStateUpdate:o})=>i.pipe(D(s=>this.publishWishlistItemEvent({wishlistId:"mine",eventName:"changeVariantSuccess",productHandle:s.wishlistItem.product.handle,variantId:s.wishlistItem.selectedVariantId}).pipe(O(()=>s))),G(s=>(console.error(s),this.events.publish({name:"changeVariantError"}),o())))))}removeWishlistItem({itemId:e}){let r=this.cacheDb.removeItemFromWishlist({itemId:e}),n=this.wishlistApi.removeItem({wishlistId:"mine",itemId:e});return r.pipe(D(({wishlist:i,revertStateUpdate:o})=>n.pipe(O(({wishlistItem:s})=>({wishlist:i,wishlistItem:s})),D(s=>this.publishWishlistItemEvent({wishlistId:"mine",eventName:"removeFromWishlistSuccess",productHandle:s.wishlistItem.product.handle,variantId:s.wishlistItem.selectedVariantId}).pipe(O(()=>s))),G(s=>(console.error(s),this.events.publish({name:"removeFromWishlistError"}),o())))))}clearWishlist(){let e=this.cacheDb.clearWishlist(),r=this.wishlistApi.clearWishlist();return e.pipe(D(({revertStateUpdate:n})=>r.pipe(D(()=>this.publishWishlistEvent({wishlistId:"mine",eventName:"clearWishlistSuccess"})),G(i=>(console.error(i),this.events.publish({name:"clearWishlistError"}),n())))))}addToCart({wishlistId:e,wishlistItemId:r,variantId:n,quantity:i=1,sectionsToRender:o,sectionsUrl:s}){return this.shopifyApi.addToCart({id:n,quantity:i,sections:o,sections_url:s}).pipe(D(a=>this.loadWishlistItem({wishlistId:e,itemId:r}).pipe(O(c=>({wishlistItem:c,cartResponse:a})))),D(a=>this.publishWishlistItemEvent({wishlistId:"mine",eventName:"addToCartSuccess",productHandle:a.wishlistItem.product.handle,variantId:a.wishlistItem.selectedVariantId}).pipe(O(()=>a))),G(a=>(this.events.publish({name:"addToCartError"}),_n(()=>a))),D(a=>this.settings.moveToCart?this.removeWishlistItem({itemId:r}).pipe(O(()=>a)):Ke(a)))}shareWishlist({wishlistId:e,title:r,text:n}){let i={url:this.utils.url.getPublicWishlistUrl(e),title:r,text:n},o=U(q(async()=>{try{await navigator.share(i)}catch(a){throw new Error("Web share api not available")}}).pipe(D(()=>this.publishWishlistEvent({wishlistId:e,eventName:"shareWishlistSuccess"})),O(()=>({webShare:!0,clipboard:!1})))),s=U(q(async()=>{try{await navigator.clipboard.writeText(i.url)}catch(a){throw new Error("Web clipboard api not available")}}).pipe(D(()=>this.publishWishlistEvent({wishlistId:e,eventName:"shareWishlistSuccess"})),O(()=>({webShare:!1,clipboard:!0}))));return o.pipe(G(()=>s.pipe(G(()=>this.publishWishlistEvent({wishlistId:e,eventName:"shareWishlistError"}).pipe(O(()=>({webShare:!1,clipboard:!1})))))))}getFormData(e){let r=new FormData(e),{wishlistId:n,itemId:i}=e.dataset;if(!n||!i)throw new Error("Required form attributes missing: data-wishlist-id, data-item-id");return this.loadWishlistProduct({wishlistId:n,itemId:i}).pipe(O(o=>({wishlistId:n,itemId:i,product:o,variant:this.utils.product.getFormVariant({formData:r,product:o}),quantity:r.get("quantity")||1})))}};function iu(t){for(var e=[],r=0;r<t.length;){var n=t[r];if(n==="*"||n==="+"||n==="?"){e.push({type:"MODIFIER",index:r,value:t[r++]});continue}if(n==="\\"){e.push({type:"ESCAPED_CHAR",index:r++,value:t[r++]});continue}if(n==="{"){e.push({type:"OPEN",index:r,value:t[r++]});continue}if(n==="}"){e.push({type:"CLOSE",index:r,value:t[r++]});continue}if(n===":"){for(var i="",o=r+1;o<t.length;){var s=t.charCodeAt(o);if(s>=48&&s<=57||s>=65&&s<=90||s>=97&&s<=122||s===95){i+=t[o++];continue}break}if(!i)throw new TypeError("Missing parameter name at ".concat(r));e.push({type:"NAME",index:r,value:i}),r=o;continue}if(n==="("){var a=1,c="",o=r+1;if(t[o]==="?")throw new TypeError('Pattern cannot start with "?" at '.concat(o));for(;o<t.length;){if(t[o]==="\\"){c+=t[o++]+t[o++];continue}if(t[o]===")"){if(a--,a===0){o++;break}}else if(t[o]==="("&&(a++,t[o+1]!=="?"))throw new TypeError("Capturing groups are not allowed at ".concat(o));c+=t[o++]}if(a)throw new TypeError("Unbalanced pattern at ".concat(r));if(!c)throw new TypeError("Missing pattern at ".concat(r));e.push({type:"PATTERN",index:r,value:c}),r=o;continue}e.push({type:"CHAR",index:r,value:t[r++]})}return e.push({type:"END",index:r,value:""}),e}function ou(t,e){e===void 0&&(e={});for(var r=iu(t),n=e.prefixes,i=n===void 0?"./":n,o="[^".concat(bt(e.delimiter||"/#?"),"]+?"),s=[],a=0,c=0,u="",l=function(_){if(c<r.length&&r[c].type===_)return r[c++].value},d=function(_){var I=l(_);if(I!==void 0)return I;var E=r[c],W=E.type,k=E.index;throw new TypeError("Unexpected ".concat(W," at ").concat(k,", expected ").concat(_))},f=function(){for(var _="",I;I=l("CHAR")||l("ESCAPED_CHAR");)_+=I;return _};c<r.length;){var h=l("CHAR"),g=l("NAME"),p=l("PATTERN");if(g||p){var b=h||"";i.indexOf(b)===-1&&(u+=b,b=""),u&&(s.push(u),u=""),s.push({name:g||a++,prefix:b,suffix:"",pattern:p||o,modifier:l("MODIFIER")||""});continue}var y=h||l("ESCAPED_CHAR");if(y){u+=y;continue}u&&(s.push(u),u="");var x=l("OPEN");if(x){var b=f(),v=l("NAME")||"",m=l("PATTERN")||"",w=f();d("CLOSE"),s.push({name:v||(m?a++:""),pattern:v&&!m?o:m,prefix:b,suffix:w,modifier:l("MODIFIER")||""});continue}d("END")}return s}function ge(t,e){var r=[],n=Os(t,r,e);return su(n,r,e)}function su(t,e,r){r===void 0&&(r={});var n=r.decode,i=n===void 0?function(o){return o}:n;return function(o){var s=t.exec(o);if(!s)return!1;for(var a=s[0],c=s.index,u=Object.create(null),l=function(f){if(s[f]===void 0)return"continue";var h=e[f-1];h.modifier==="*"||h.modifier==="+"?u[h.name]=s[f].split(h.prefix+h.suffix).map(function(g){return i(g,h)}):u[h.name]=i(s[f],h)},d=1;d<s.length;d++)l(d);return{path:a,index:c,params:u}}}function bt(t){return t.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function Cs(t){return t&&t.sensitive?"":"i"}function au(t,e){if(!e)return t;for(var r=/\((?:\?<(.*?)>)?(?!\?)/g,n=0,i=r.exec(t.source);i;)e.push({name:i[1]||n++,prefix:"",suffix:"",modifier:"",pattern:""}),i=r.exec(t.source);return t}function cu(t,e,r){var n=t.map(function(i){return Os(i,e,r).source});return new RegExp("(?:".concat(n.join("|"),")"),Cs(r))}function uu(t,e,r){return lu(ou(t,r),e,r)}function lu(t,e,r){r===void 0&&(r={});for(var n=r.strict,i=n===void 0?!1:n,o=r.start,s=o===void 0?!0:o,a=r.end,c=a===void 0?!0:a,u=r.encode,l=u===void 0?function(k){return k}:u,d=r.delimiter,f=d===void 0?"/#?":d,h=r.endsWith,g=h===void 0?"":h,p="[".concat(bt(g),"]|$"),b="[".concat(bt(f),"]"),y=s?"^":"",x=0,v=t;x<v.length;x++){var m=v[x];if(typeof m=="string")y+=bt(l(m));else{var w=bt(l(m.prefix)),_=bt(l(m.suffix));if(m.pattern)if(e&&e.push(m),w||_)if(m.modifier==="+"||m.modifier==="*"){var I=m.modifier==="*"?"?":"";y+="(?:".concat(w,"((?:").concat(m.pattern,")(?:").concat(_).concat(w,"(?:").concat(m.pattern,"))*)").concat(_,")").concat(I)}else y+="(?:".concat(w,"(").concat(m.pattern,")").concat(_,")").concat(m.modifier);else m.modifier==="+"||m.modifier==="*"?y+="((?:".concat(m.pattern,")").concat(m.modifier,")"):y+="(".concat(m.pattern,")").concat(m.modifier);else y+="(?:".concat(w).concat(_,")").concat(m.modifier)}}if(c)i||(y+="".concat(b,"?")),y+=r.endsWith?"(?=".concat(p,")"):"$";else{var E=t[t.length-1],W=typeof E=="string"?b.indexOf(E[E.length-1])>-1:E===void 0;i||(y+="(?:".concat(b,"(?=").concat(p,"))?")),W||(y+="(?=".concat(b,"|").concat(p,")"))}return new RegExp(y,Cs(r))}function Os(t,e,r){return t instanceof RegExp?au(t,e):Array.isArray(t)?cu(t,e,r):uu(t,e,r)}var Pe={isHome:ge("/:locale?/"),isCollection:ge("/:locale?/collections/:collection"),isProduct:ge("/:locale?/products/:product"),isNestedProduct:ge("/:locale?/collections/:collection?/products/:product"),isPage:ge("/:locale?/pages/:page/:rest?"),isAccount:ge("/:locale?/account/:account?"),isBlog:ge("/:locale?/blog/:blog?"),isCart:ge("/:locale?/cart/:cart?"),isProxy:ge("/:locale?/apps/(.*)")},fu=[{template:"product",match:t=>Pe.isProduct(t)||Pe.isNestedProduct(t)},{template:"collection",match:t=>Pe.isCollection(t)},{template:"page",match:t=>Pe.isPage(t)},{template:"account",match:t=>Pe.isAccount(t)},{template:"blog",match:t=>Pe.isBlog(t)},{template:"cart",match:t=>Pe.isCart(t)},{template:"home",match:t=>Pe.isHome(t)},{template:"proxy",match:t=>Pe.isProxy(t)}],Yt=class{constructor({wishlistRootUrl:e}){this.wishlistRootUrl=e}parse(e){for(let r of fu){let n=r.match(e);if(n)return r.template==="proxy"&&e.startsWith(this.wishlistRootUrl)?{template:e.endsWith("mine")?"wishlist":"shared-wishlist",handle:n.params.page}:{template:r.template,handle:n.params.page}}return{template:void 0}}};var zt=class{constructor(e){this.locale=this.decodeLocale(e.locale)}decodeHtmlEntities(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&#39;/g,"'")}decodeLocale(e){let r={};for(let n in e){r[n]={};for(let i in e[n])r[n][i]=this.decodeHtmlEntities(e[n][i])}return r}translate(e){var i,o;let[r,n]=e.split(".");return(o=(i=this.locale[r])==null?void 0:i[n])!=null?o:`translation missing: ${e}`}};var hu="${{amount}}";function Rs(t,e){typeof t=="string"&&(t=t.replace(".",""));let r="",n=/\{\{\s*(\w+)\s*\}\}/,i=e||hu;function o(s,a=2,c=",",u="."){if(isNaN(s)||s==null)return 0;s=(s/100).toFixed(a);let l=s.split("."),d=l[0].replace(/(\d)(?=(\d\d\d)+(?!\d))/g,`$1${c}`),f=l[1]?u+l[1]:"";return d+f}switch(i.match(n)[1]){case"amount":r=o(t,2);break;case"amount_no_decimals":r=o(t,0);break;case"amount_with_comma_separator":r=o(t,2,".",",");break;case"amount_no_decimals_with_comma_separator":r=o(t,0,".",",");break}return i.replace(n,r)}var Gt=class{constructor(e){this.moneyFormat=e.moneyFormat,this.currencyRate=e.currencyRate,this.activeCurrency=e.activeCurrency}formatMoney(e){return typeof e=="string"&&(e=parseFloat(e)),Rs(e,this.moneyFormat)}};var Jt=class{constructor(e){this.rootUrl=e.rootUrl,this.shopDomain=e.shopDomain,this.wishlistRootUrl=e.wishlistRootUrl,this.placeholderImageUrl=e.placeholderImageUrl}getPublicWishlistUrl(e){return"https://"+this.shopDomain+this.wishlistRootUrl+e}getImageUrl(e,r){var i;let n=this.getImage(e);return n!=null&&n.src?this.appendSize(n.src,r):(i=this.placeholderImageUrl)!=null?i:""}getImage(e){var r,n,i,o,s;if(e.hasOwnProperty("sku"))return{src:(n=(r=e.featured_image)==null?void 0:r.src)!=null?n:""};if(e!=null&&e.selected_or_first_available_variant){let a=e;return(i=a.selected_or_first_available_variant)!=null&&i.featured_image?this.getImage(a.selected_or_first_available_variant):{src:(o=a.featured_image)!=null?o:a.images[0]}}else if(e!=null&&e.images.length){let a=e;return{src:(s=a.featured_image)!=null?s:a.images[0]}}else if(e.hasOwnProperty("src"))return{src:e.src};return null}appendSize(e,r){let n=new URL(e.startsWith("//")?`https://${e}`:e);return r!=null&&r.width&&n.searchParams.set("width",r==null?void 0:r.width.toString()),r!=null&&r.height&&n.searchParams.set("height",r==null?void 0:r.height.toString()),n.href}getVariantUrl(e,r){if(!!e)return r?this.prependRootUrl(e+`?variant=${r}`):this.prependRootUrl(e)}prependRootUrl(e){return e.startsWith("/")?this.rootUrl+e.substring(1):this.rootUrl+e}};var Qt=class{constructor(){}getOptionsWithValues({product:e,selectedOptions:r}){return e.options.map(n=>({...n,selected_value:r[`option${n.position}`],soldout_values:e.variants.filter(i=>!i.available).map(i=>i[`option${n.position}`]).filter((i,o,s)=>!!i&&s.indexOf(i)===o)}))}getFormVariant({formData:e,product:r}){var i;let n=Array.from(e.entries()).reduce((o,[s,a])=>{var l;let c=(l=s.match(/\[(.*?)\]/))==null?void 0:l[1];if(!c)return o;let u=r.options.findIndex(d=>d.name===c);return u!==-1&&(o[u]=a.toString()),o},new Array(3).fill(null));return(i=r.variants.find(o=>{var s,a;return n[0]?n.every((c,u)=>o[`option${u+1}`]===c):o.id===parseInt((a=(s=e.get("id"))==null?void 0:s.toString())!=null?a:"")}))!=null?i:r.variants[0]}};var Xt=class{constructor({host:e,sessionId:r,customerId:n}){this.host=e,this.customerId=n,this.sessionId=r,this.eventNames=new Map([["viewWishlist","wishlist_viewed"],["addToCart","product_added_to_cart"],["shareWishlist","wishlist_shared"]])}track({eventName:e,wishlist:r,product:n,variant:i,quantity:o=1,source:s}){let a=this.eventNames.get(e);return!a||!r?ae:It(this.host+`track/${a}`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({wid:r.id,sid:this.sessionId,cid:this.customerId,pid:n==null?void 0:n.id,vid:i==null?void 0:i.id,qty:o,src:s})}).pipe(G(()=>ae))}};var{ga:Zt}=window,er=class{constructor(){this.eventNames=new Map([["addToWishlist","WK Added Product"],["removeFromWishlist","WK Removed Product"],["addToCart","WK Added to Cart"],["shareWishlist","WK Shared Wishlist"],["clearWishlist","WK Cleared Wishlist"]])}track({eventName:e,product:r,variant:n,quantity:i=1}){var s;let o=this.eventNames.get(e);return!o||!(Zt!=null&&Zt.loaded)||!r?ae:(Zt("ec:addProduct",{id:(s=(n==null?void 0:n.sku)||(n==null?void 0:n.id))!=null?s:r.id,name:r.title,category:r.type,brand:r.vendor,variant:n==null?void 0:n.title,quantity:i}),new M(a=>{Zt("send",{eventAction:o,hitType:"event",eventCategory:"Wishlist",eventLabel:"Wishlist King",eventCallback:()=>a.complete()})}))}};var tr=class{constructor({urlUtil:e,moneyUtil:r}){this.urlUtil=e,this.moneyUtil=r,this.eventNames=new Map([["addToWishlist","Added To Wishlist"],["removeFromWishlist","Removed From Wishlist"],["clearWishlist","Cleared Wishlist"]])}track({eventName:e,wishlist:r,product:n,variant:i,quantity:o=1}){let s=this.eventNames.get(e);return!s||!r||!n?ae:(window._learnq||(window._learnq=[]),window._learnq.push(["track",s,{URL:this.urlUtil.getVariantUrl(n.url,i==null?void 0:i.id),Name:n.title,ProductID:n.id,VariantID:i==null?void 0:i.id,SKU:i==null?void 0:i.sku,Tags:n.tags,Brand:n.vendor,ImageURL:this.urlUtil.getImageUrl(n,{width:1e3}),Price:i==null?void 0:i.price,PriceFormatted:i?this.moneyUtil.formatMoney(i.price):null,CompareAtPrice:i==null?void 0:i.compare_at_price,CompareAtPriceFormatted:i!=null&&i.compare_at_price?this.moneyUtil.formatMoney(i.compare_at_price):null,Quantity:o,WishlistUrl:this.urlUtil.getPublicWishlistUrl(r.id)}]),ae)}};var{fbq:Us}=window,rr=class{constructor({currency:e}){this.currency=e,this.eventNames=new Map([["addToWishlist","AddToWishlist"]])}track({eventName:e,product:r,variant:n}){let i=this.eventNames.get(e);return!i||typeof Us!="function"||!r?ae:(Us("track",i,{value:n==null?void 0:n.price,currency:this.currency,content_ids:[r.id],content_name:[r.title,n==null?void 0:n.title].filter(o=>!!o).join(" - "),content_category:r.type,content_type:"product_group",num_items:1}),ae)}};var nr=class{constructor({settings:e,events:r,appmateAnalyticsHost:n,utils:i,sessionId:o,customerId:s}){this.utils=i,this.services=[],e.appmateAnalytics&&this.services.push(new Xt({host:n,customerId:s,sessionId:o})),e.klaviyo&&this.services.push(new tr({urlUtil:this.utils.url,moneyUtil:this.utils.money})),e.facebookPixel&&this.services.push(new rr({currency:window.Shopify.currency.active})),e.googleAnalytics&&this.services.push(new er);let a=this.utils.route.parse(window.location.pathname).template,c=u=>l=>{var d,f,h,g;return this.track({eventName:u,source:a,wishlist:(d=l.data)==null?void 0:d.wishlist,product:(f=l.data)==null?void 0:f.product,variant:(h=l.data)==null?void 0:h.variant,quantity:(g=l.data)==null?void 0:g.quantity}).subscribe()};r.subscribeMany({addToCartSuccess:c("addToCart"),addToWishlistSuccess:c("addToWishlist"),changeVariantSuccess:c("changeVariant"),clearWishlistSuccess:c("clearWishlist"),removeFromWishlistSuccess:c("removeFromWishlist"),shareWishlistSuccess:c("shareWishlist"),viewWishlist:c("viewWishlist")})}track(e){return ce(this.services.map(r=>r.track(e)))}};var ir=class{constructor(){this.dispatcher=document}publish(e){this.dispatcher.dispatchEvent(new CustomEvent(e.name,{detail:e,bubbles:!1,cancelable:!1}))}subscribe(e,r){return At(this.dispatcher,e).pipe(O(n=>{let i=n;return{name:i.type,data:i.detail.data}})).subscribe(r)}subscribeMany(e){return Object.entries(e).map(([r,n])=>this.subscribe(r,n))}};var K=class{static init({customer:e,shop:r,routes:n,products:i,settings:o,locale:s}){var u,l,d,f,h,g;let a=n.rootUrl+((l=(u=n.apiHost)==null?void 0:u.replace("/",""))!=null?l:"apps/wishlist-king/")+"wishlists/";K.routes={rootUrl:n.rootUrl,wishlistRootUrl:a,wishlistUrl:a+"mine",accountUrl:n.rootUrl+"account",accountLoginUrl:n.rootUrl+"account/login",accountLogoutUrl:n.rootUrl+"account/logout",accountRegisterUrl:n.rootUrl+"account/register",accountAddressesUrl:n.rootUrl+"account/addresses",collectionsUrl:n.rootUrl+"collections",allProductsCollectionUrl:n.rootUrl+"collections/all",searchUrl:n.rootUrl+"search",predictiveSearchUrl:n.rootUrl+"search/suggest",cartUrl:n.rootUrl+"cart",cartAddUrl:n.rootUrl+"cart/add",cartChangeUrl:n.rootUrl+"cart/change",cartClearUrl:n.rootUrl+"cart/clear",cartUpdateUrl:n.rootUrl+"cart/update",productRecommendationsUrl:n.rootUrl+"recommendations/products"},K.settings=o,K.shop=r,K.customer=e.id?{id:e.id,email:e.email}:null,K.utils={url:new Jt({rootUrl:window.Shopify.routes.root,wishlistRootUrl:K.routes.wishlistRootUrl,shopDomain:r.domain,placeholderImageUrl:i.fallbackImage}),money:new Gt({moneyFormat:r.moneyFormat,currencyRate:parseFloat(window.Shopify.currency.rate),activeCurrency:window.Shopify.currency.active}),product:new Qt,locale:new zt({locale:s}),route:new Yt({wishlistRootUrl:K.routes.wishlistRootUrl})},K.events=new ir,K.observer=new at({routeUtil:K.utils.route}),K.api={wishlist:new ot({host:(d=n.apiHost)!=null?d:"/apps/wishlist-king/",shop:window.Shopify.shop,customerId:(f=e.id)!=null?f:void 0,sessionId:rn(),trackingSource:K.utils.route.parse(window.location.pathname).template}),shopify:new st({host:window.Shopify.routes.root}),tracking:new nr({appmateAnalyticsHost:(h=n.apiHost)!=null?h:"/apps/wishlist-king/",events:K.events,customerId:(g=e.id)!=null?g:void 0,sessionId:rn(),utils:K.utils,settings:o})},K.state=new vt({wishlistApi:K.api.wishlist,shopifyApi:K.api.shopify,settings:K.settings,events:K.events,utils:K.utils});let c=K.utils.route.parse(window.location.pathname).template;if(c!=null&&c.includes("wishlist")){let p=window.location.pathname.split("/").pop();p&&K.state.publishWishlistEvent({eventName:"viewWishlist",wishlistId:p}).subscribe()}}static createComponent(e,r){let n=document.createElement(e);return Object.entries(r!=null?r:{}).forEach(([i,o])=>{n.dataset[i]=o}),n}static createElement(e,r={},...n){let i=Object.assign(document.createElement(e),r);return n&&i.append(...n),i}};window.WishlistKing||(window.WishlistKing=K);export{K as default};
