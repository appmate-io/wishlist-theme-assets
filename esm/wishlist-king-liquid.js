/* Wishlist King SDK 4.0.0 */
var C=Object.defineProperty;var W=Object.getOwnPropertyDescriptor;var I=(u,s,i,t)=>{for(var e=t>1?void 0:t?W(s,i):s,r=u.length-1,o;r>=0;r--)(o=u[r])&&(e=(t?o(s,i,e):o(e))||e);return t&&e&&C(s,i,e),e};import{Liquid as T}from"https://cdn.jsdelivr.net/npm/liquidjs@9.39.2/+esm";import{html as A,unsafeStatic as N}from"https://cdn.jsdelivr.net/npm/lit@2.2.8/static-html.js/+esm";var f=class{constructor(s){this.mapWishlistState=(s,i="minimal")=>{var t;return{id:s.id,public_id:s.publicId,is_mine:s.isMine,num_items:s.numItems,items:i==="all"?(t=s.items)==null?void 0:t.map(e=>({id:e.id})):void 0}};this.mapProductInfo=s=>({product_id:s.productId,variant_id:s.variantId,in_wishlist:s.inWishlist,wishlist_item_id:s.wishlistItemId});this.mapWishlistItem=s=>{var i,t;return{id:s.id,loading:!((i=s.product)!=null&&i.url),selected_variant_id:s.selectedVariantId,product:(t=s.product)!=null&&t.url?this.mapShopifyProduct(s):void 0}};this.utils=s.utils}mapShopifyProduct(s){var o;let i=s.product,t=i.variants.find(n=>n.available),e=i.variants.find(n=>n.id===s.selectedVariantId),r=(o=e!=null?e:t)!=null?o:i.variants[0];return{...i,selected_variant:e,first_available_variant:t,selected_or_first_available_variant:r,has_only_default_variant:i.variants.length===1,options_with_values:this.utils.product.getOptionsWithValues({product:i,selectedOptions:r})}}};var{WishlistKing:h}=window,v=()=>function(){if(!h)throw new Error("Wishlist King SDK not found");let u=e=>{var r;return h.utils.url.getVariantUrl(e.url,(r=e.selected_variant)==null?void 0:r.id)},s=(e,...r)=>h.utils.url.getImageUrl(e,b(r)),i=e=>h.utils.money.formatMoney(e),t=(e,...r)=>r.length?this.parseAndRenderSync(h.utils.locale.translate(e),b(r)):h.utils.locale.translate(e);this.registerFilter("variant_url",u),this.registerFilter("image_url",s),this.registerFilter("money",i),this.registerFilter("t",t)},b=u=>u.reduce((s,[i,t])=>t?{...s,[i]:t}:s,{});import{combineLatest as q,from as P,fromEvent as L,isObservable as x,of as y}from"https://cdn.jsdelivr.net/npm/rxjs@7.5.6/+esm";import{distinctUntilChanged as U,filter as E,map as m,switchMap as R,tap as S}from"https://cdn.jsdelivr.net/npm/rxjs@7.5.6/operators/+esm";import{LitElement as F}from"https://cdn.jsdelivr.net/npm/lit@2.2.8/+esm";import{state as O}from"https://cdn.jsdelivr.net/npm/lit@2.2.8/decorators.js/+esm";var{WishlistKing:g}=window,p=class extends F{constructor(){super();this.eventConfig={};this.stateConfig={};this.eventPending=!1;this.state={}}updateState(i){this.state={...this.state,...i}}createRenderRoot(){return this}connectedCallback(){super.connectedCallback(),this.innerHTML="",g.stylesLoaded||(this.style.opacity="0",g.events.subscribe("wishlist:load-styles:success",()=>{this.style.opacity=""})),this.stateConfig.loading==="lazy"?(this.initFallbackState(),this.initObserver()):this.initState()}disconnectedCallback(){var i,t;super.disconnectedCallback(),(i=this.subscription)==null||i.unsubscribe(),(t=this.observer)==null||t.disconnect()}updated(){this.initEventListener()}initState(){var e,r,o,n;let i=this.parseStyleConfig(),t=[];if((e=this.stateConfig)!=null&&e.wishlist){let l=(r=this.parseConfigString(this.stateConfig.wishlist.params.wishlistId))!=null?r:"mine";t.push(g.rx.observeWishlist({format:this.stateConfig.wishlist.format,wishlistId:l}).pipe(m(d=>({wishlist:d}))))}if((o=this.stateConfig)!=null&&o.productInfo){let l=this.parseConfigNumber(this.stateConfig.productInfo.params.productId);if(!l)throw new Error("Product id is required");let d=this.parseConfigNumber(this.stateConfig.productInfo.params.variantId);t.push(g.rx.observeProductInfo({productId:l,variantId:d}).pipe(m(c=>({productInfo:c}))))}if((n=this.stateConfig)!=null&&n.wishlistItem){let l=this.parseConfigString(this.stateConfig.wishlistItem.params.wishlistId);if(!l)throw new Error("Wishlist id is required");let d=this.parseConfigString(this.stateConfig.wishlistItem.params.itemId);if(!d)throw new Error("Wishlist item id is required");t.push(g.rx.observeWishlistItem({wishlistId:l,itemId:d}).pipe(m(c=>({wishlistItem:c}))))}t.length||t.push(y({})),this.subscription=q(t).pipe(m(l=>l.reduce((d,c)=>c.wishlist?{...d,wishlist:c.wishlist}:c.wishlistItem?{...d,wishlistItem:c.wishlistItem}:c.productInfo?{...d,productInfo:c.productInfo}:d,{})),m(l=>({...l,style:i})),U((l,d)=>JSON.stringify(l)===JSON.stringify(d))).subscribe(l=>{this.updateState(l)})}initFallbackState(){var e,r,o,n;let t={style:this.parseStyleConfig()};if((e=this.stateConfig)!=null&&e.wishlist){let l=(r=this.parseConfigString(this.stateConfig.wishlist.params.wishlistId))!=null?r:"mine";t.wishlist={id:l,isMine:l==="mine",numItems:0,items:void 0}}if((o=this.stateConfig)!=null&&o.productInfo){let l=this.parseConfigNumber(this.stateConfig.productInfo.params.productId);if(!l)throw new Error("Product id is required");let d=this.parseConfigNumber(this.stateConfig.productInfo.params.variantId);t.productInfo={productId:l,variantId:d,inWishlist:!1}}if((n=this.stateConfig)!=null&&n.wishlistItem){if(!this.parseConfigString(this.stateConfig.wishlistItem.params.wishlistId))throw new Error("Wishlist id is required");let d=this.parseConfigString(this.stateConfig.wishlistItem.params.itemId);if(!d)throw new Error("Wishlist item id is required");t.wishlistItem={id:d,product:{id:0,handle:""}}}this.updateState(t)}initObserver(){this.observer=new IntersectionObserver(i=>this.handleIntersect(i),{root:null,rootMargin:"0px"}),this.observer.observe(this)}handleIntersect([i]){var t;i.isIntersecting&&((t=this.observer)==null||t.disconnect(),this.initState())}initEventListener(){if(!this.eventConfig)return;let i=({element:t,eventName:e,handler:r})=>{L(t,e).pipe(S(o=>{this.eventPending&&o.preventDefault()}),E(()=>!this.eventPending),S(()=>{this.eventPending=!0}),R(o=>{let n=r(o);return x(n)?n:typeof(n==null?void 0:n.then)=="function"?P(n):y(n)})).subscribe(()=>{this.eventPending=!1})};Object.entries(this.eventConfig).forEach(([t,e])=>{let[r,o]=t.split(/ (.*)/s);r&&o&&(r==="render"?this.renderRoot.querySelectorAll(o).forEach(n=>{e(n)}):this.renderRoot.querySelectorAll(o).forEach(n=>{i({element:n,eventName:r,handler:e})}))})}parseConfigString(i){var e;if(!i)return;let t=(e=i.match(/\$\{dataset\.(.*?)\}/))==null?void 0:e[1];return t?this.dataset[t]:i}parseConfigNumber(i){let t=this.parseConfigString(i);if(!!t)return parseFloat(t)}parseConfigBoolean(i){let t=this.parseConfigString(i);if(!!t)return t==="true"}parseStyleConfig(){var i,t;return Object.entries((t=(i=this.stateConfig)==null?void 0:i.style)!=null?t:{}).reduce((e,[r,o])=>{let n=typeof o=="string"?this.parseConfigString(o):o;return{...e,[r]:n==="true"||n==="false"?n==="true":n}},{})}};I([O()],p.prototype,"state",2);var{WishlistKing:a}=window,w=new T({cache:!0,relativeReference:!1,fs:{readFileSync(u){return""},async readFile(u){return""},existsSync(u){return!1},async exists(u){return!1},contains(){return!1},resolve(u,s,i){return s}}});w.plugin(v());var _=class extends p{constructor(){super();this.liquidEngine=w;this.liquidTemplate="";this.dataUtil=new f({utils:a.utils}),this.globals={settings:{login_required:a.settings.loginRequired},customer:a.customer,shop:{currency:a.shop.currency,customer_accounts_enabled:a.shop.customerAccountsEnabled,domain:a.shop.domain,money_format:a.shop.moneyFormat,name:a.shop.name,permanent_domain:a.shop.permanentDomain},routes:{root_url:a.routes.rootUrl,wishlist_url:a.routes.wishlistUrl,account_url:a.routes.accountUrl,account_login_url:a.routes.accountLoginUrl,account_logout_url:a.routes.accountLogoutUrl,account_register_url:a.routes.accountRegisterUrl,account_addresses_url:a.routes.accountAddressesUrl,collections_url:a.routes.collectionsUrl,all_products_collection_url:a.routes.allProductsCollectionUrl,search_url:a.routes.searchUrl,predictive_search_url:a.routes.predictiveSearchUrl,cart_url:a.routes.cartUrl,cart_add_url:a.routes.cartAddUrl,cart_change_url:a.routes.cartChangeUrl,cart_clear_url:a.routes.cartClearUrl,cart_update_url:a.routes.cartUpdateUrl,product_recommendations_url:a.routes.productRecommendationsUrl}}}connectedCallback(){super.connectedCallback(),this.initTemplate()}disconnectedCallback(){super.disconnectedCallback(),this.parsedTemplates=void 0}initTemplate(){return this.parsedTemplates?this.parsedTemplates:(this.parsedTemplates=this.liquidEngine.parse(this.liquidTemplate),this.parsedTemplates)}render(){var l,d;if(!this.parsedTemplates)return;let{wishlist:i,wishlistItem:t,productInfo:e,...r}=this.state,o={...r,wishlist:i?this.dataUtil.mapWishlistState(i,(d=(l=this.stateConfig)==null?void 0:l.wishlist)==null?void 0:d.format):void 0,wishlist_item:t?this.dataUtil.mapWishlistItem(t):void 0,product_info:e?this.dataUtil.mapProductInfo(e):void 0},n=this.liquidEngine.renderSync(this.parsedTemplates,o,{globals:this.globals});return A`${N(n)}`}};export{_ as LiquidElement};
