/* Wishlist King SDK 4.0.0 */
var zt=Object.create;var ft=Object.defineProperty;var te=Object.getOwnPropertyDescriptor;var ee=Object.getOwnPropertyNames;var ie=Object.getPrototypeOf,se=Object.prototype.hasOwnProperty;var Rt=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports),re=(s,e)=>{for(var t in e)ft(s,t,{get:e[t],enumerable:!0})},ae=(s,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of ee(e))!se.call(s,r)&&r!==t&&ft(s,r,{get:()=>e[r],enumerable:!(i=te(e,r))||i.enumerable});return s};var gt=(s,e,t)=>(t=s!=null?zt(ie(s)):{},ae(e||!s||!s.__esModule?ft(t,"default",{value:s,enumerable:!0}):t,s));var Nt=Rt((ri,Ft)=>{"use strict";var ce=function(){function s(t,i){if(typeof t!="function")throw new TypeError("DataLoader must be constructed with a function which accepts "+("Array<key> and returns Promise<Array<value>>, but got: "+t+"."));this._batchLoadFn=t,this._maxBatchSize=de(i),this._batchScheduleFn=me(i),this._cacheKeyFn=fe(i),this._cacheMap=ge(i),this._batch=null}var e=s.prototype;return e.load=function(i){if(i==null)throw new TypeError("The loader.load() function must be called with a value, "+("but got: "+String(i)+"."));var r=pe(this),a=this._cacheMap,n=this._cacheKeyFn(i);if(a){var o=a.get(n);if(o){var c=r.cacheHits||(r.cacheHits=[]);return new Promise(function(l){c.push(function(){l(o)})})}}r.keys.push(i);var h=new Promise(function(l,m){r.callbacks.push({resolve:l,reject:m})});return a&&a.set(n,h),h},e.loadMany=function(i){if(!Mt(i))throw new TypeError("The loader.loadMany() function must be called with Array<key> "+("but got: "+i+"."));for(var r=[],a=0;a<i.length;a++)r.push(this.load(i[a]).catch(function(n){return n}));return Promise.all(r)},e.clear=function(i){var r=this._cacheMap;if(r){var a=this._cacheKeyFn(i);r.delete(a)}return this},e.clearAll=function(){var i=this._cacheMap;return i&&i.clear(),this},e.prime=function(i,r){var a=this._cacheMap;if(a){var n=this._cacheKeyFn(i);if(a.get(n)===void 0){var o;r instanceof Error?(o=Promise.reject(r),o.catch(function(){})):o=Promise.resolve(r),a.set(n,o)}}return this},s}(),he=typeof process=="object"&&typeof process.nextTick=="function"?function(s){yt||(yt=Promise.resolve()),yt.then(function(){process.nextTick(s)})}:typeof setImmediate=="function"?function(s){setImmediate(s)}:function(s){setTimeout(s)},yt;function pe(s){var e=s._batch;if(e!==null&&!e.hasDispatched&&e.keys.length<s._maxBatchSize&&(!e.cacheHits||e.cacheHits.length<s._maxBatchSize))return e;var t={hasDispatched:!1,keys:[],callbacks:[]};return s._batch=t,s._batchScheduleFn(function(){ue(s,t)}),t}function ue(s,e){if(e.hasDispatched=!0,e.keys.length===0){It(e);return}var t=s._batchLoadFn(e.keys);if(!t||typeof t.then!="function")return Dt(s,e,new TypeError("DataLoader must be constructed with a function which accepts Array<key> and returns Promise<Array<value>>, but the function did "+("not return a Promise: "+String(t)+".")));t.then(function(i){if(!Mt(i))throw new TypeError("DataLoader must be constructed with a function which accepts Array<key> and returns Promise<Array<value>>, but the function did "+("not return a Promise of an Array: "+String(i)+"."));if(i.length!==e.keys.length)throw new TypeError("DataLoader must be constructed with a function which accepts Array<key> and returns Promise<Array<value>>, but the function did not return a Promise of an Array of the same length as the Array of keys."+(`

Keys:
`+String(e.keys))+(`

Values:
`+String(i)));It(e);for(var r=0;r<e.callbacks.length;r++){var a=i[r];a instanceof Error?e.callbacks[r].reject(a):e.callbacks[r].resolve(a)}}).catch(function(i){Dt(s,e,i)})}function Dt(s,e,t){It(e);for(var i=0;i<e.keys.length;i++)s.clear(e.keys[i]),e.callbacks[i].reject(t)}function It(s){if(s.cacheHits)for(var e=0;e<s.cacheHits.length;e++)s.cacheHits[e]()}function de(s){var e=!s||s.batch!==!1;if(!e)return 1;var t=s&&s.maxBatchSize;if(t===void 0)return 1/0;if(typeof t!="number"||t<1)throw new TypeError("maxBatchSize must be a positive number: "+t);return t}function me(s){var e=s&&s.batchScheduleFn;if(e===void 0)return he;if(typeof e!="function")throw new TypeError("batchScheduleFn must be a function: "+e);return e}function fe(s){var e=s&&s.cacheKeyFn;if(e===void 0)return function(t){return t};if(typeof e!="function")throw new TypeError("cacheKeyFn must be a function: "+e);return e}function ge(s){var e=!s||s.cache!==!1;if(!e)return null;var t=s&&s.cacheMap;if(t===void 0)return new Map;if(t!==null){var i=["get","set","delete","clear"],r=i.filter(function(a){return t&&typeof t[a]!="function"});if(r.length!==0)throw new TypeError("Custom cacheMap missing methods: "+r.join(", "))}return t}function Mt(s){return typeof s=="object"&&s!==null&&typeof s.length=="number"&&(s.length===0||s.length>0&&Object.prototype.hasOwnProperty.call(s,s.length-1))}Ft.exports=ce});var Pt=Rt((bi,Wt)=>{var vt=(()=>{var s=Object.defineProperty,e=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,r=(v,y,I)=>y in v?s(v,y,{enumerable:!0,configurable:!0,writable:!0,value:I}):v[y]=I,a=(v,y)=>{for(var I in y||(y={}))t.call(y,I)&&r(v,I,y[I]);if(e)for(var I of e(y))i.call(y,I)&&r(v,I,y[I]);return v},n=v=>s(v,"__esModule",{value:!0}),o=(v,y)=>{n(v);for(var I in y)s(v,I,{get:y[I],enumerable:!0})},c={};o(c,{DEFAULT_UUID_LENGTH:()=>l,default:()=>g});var h="4.4.4",l=6,m={dictionary:"alphanum",shuffle:!0,debug:!1,length:l},b=class extends Function{constructor(v={}){super(),this.dictIndex=0,this.dictRange=[],this.lowerBound=0,this.upperBound=0,this.dictLength=0,this._digit_first_ascii=48,this._digit_last_ascii=58,this._alpha_lower_first_ascii=97,this._alpha_lower_last_ascii=123,this._hex_last_ascii=103,this._alpha_upper_first_ascii=65,this._alpha_upper_last_ascii=91,this._number_dict_ranges={digits:[this._digit_first_ascii,this._digit_last_ascii]},this._alpha_dict_ranges={lowerCase:[this._alpha_lower_first_ascii,this._alpha_lower_last_ascii],upperCase:[this._alpha_upper_first_ascii,this._alpha_upper_last_ascii]},this._alpha_lower_dict_ranges={lowerCase:[this._alpha_lower_first_ascii,this._alpha_lower_last_ascii]},this._alpha_upper_dict_ranges={upperCase:[this._alpha_upper_first_ascii,this._alpha_upper_last_ascii]},this._alphanum_dict_ranges={digits:[this._digit_first_ascii,this._digit_last_ascii],lowerCase:[this._alpha_lower_first_ascii,this._alpha_lower_last_ascii],upperCase:[this._alpha_upper_first_ascii,this._alpha_upper_last_ascii]},this._alphanum_lower_dict_ranges={digits:[this._digit_first_ascii,this._digit_last_ascii],lowerCase:[this._alpha_lower_first_ascii,this._alpha_lower_last_ascii]},this._alphanum_upper_dict_ranges={digits:[this._digit_first_ascii,this._digit_last_ascii],upperCase:[this._alpha_upper_first_ascii,this._alpha_upper_last_ascii]},this._hex_dict_ranges={decDigits:[this._digit_first_ascii,this._digit_last_ascii],alphaDigits:[this._alpha_lower_first_ascii,this._hex_last_ascii]},this.log=(...d)=>{let u=[...d];if(u[0]=`[short-unique-id] ${d[0]}`,this.debug===!0&&typeof console!="undefined"&&console!==null)return console.log(...u)},this.setDictionary=(d,u)=>{let w;if(d&&Array.isArray(d)&&d.length>1)w=d;else{w=[];let f;this.dictIndex=f=0;let U=`_${d}_dict_ranges`,E=this[U];Object.keys(E).forEach(J=>{let Q=J;for(this.dictRange=E[Q],this.lowerBound=this.dictRange[0],this.upperBound=this.dictRange[1],this.dictIndex=f=this.lowerBound;this.lowerBound<=this.upperBound?f<this.upperBound:f>this.upperBound;this.dictIndex=this.lowerBound<=this.upperBound?f+=1:f-=1)w.push(String.fromCharCode(this.dictIndex))})}u&&(w=w.sort(()=>Math.random()-.5)),this.dict=w,this.dictLength=this.dict.length,this.counter=0},this.seq=()=>this.sequentialUUID(),this.sequentialUUID=()=>{let d,u,w="";d=this.counter;do u=d%this.dictLength,d=Math.trunc(d/this.dictLength),w+=this.dict[u];while(d!==0);return this.counter+=1,w},this.randomUUID=(d=this.uuidLength||l)=>{let u,w,f;if(d===null||typeof d=="undefined"||d<1)throw new Error("Invalid UUID Length Provided");let U=d>=0;for(u="",f=0;f<d;f+=1)w=parseInt((Math.random()*this.dictLength).toFixed(0),10)%this.dictLength,u+=this.dict[w];return u},this.availableUUIDs=(d=this.uuidLength)=>parseFloat(Math.pow([...new Set(this.dict)].length,d).toFixed(0)),this.approxMaxBeforeCollision=(d=this.availableUUIDs(this.uuidLength))=>parseFloat(Math.sqrt(Math.PI/2*d).toFixed(20)),this.collisionProbability=(d=this.availableUUIDs(this.uuidLength),u=this.uuidLength)=>parseFloat((this.approxMaxBeforeCollision(d)/this.availableUUIDs(u)).toFixed(20)),this.uniqueness=(d=this.availableUUIDs(this.uuidLength))=>{let u=parseFloat((1-this.approxMaxBeforeCollision(d)/d).toFixed(20));return u>1?1:u<0?0:u},this.getVersion=()=>this.version,this.stamp=d=>{if(typeof d!="number"||d<10)throw new Error("Param finalLength must be number greater than 10");let u=Math.floor(+new Date/1e3).toString(16),w=d-9,f=Math.round(Math.random()*(w>15?15:w)),U=this.randomUUID(w);return`${U.substr(0,f)}${u}${U.substr(f)}${f.toString(16)}`},this.parseStamp=d=>{if(d.length<10)throw new Error("Stamp length invalid");let u=parseInt(d.substr(d.length-1,1),16);return new Date(parseInt(d.substr(u,8),16)*1e3)};let y=a(a({},m),v);this.counter=0,this.debug=!1,this.dict=[],this.version=h;let{dictionary:I,shuffle:_,length:F}=y;return this.uuidLength=F,this.setDictionary(I,_),this.debug=y.debug,this.log(this.dict),this.log(`Generator instantiated with Dictionary Size ${this.dictLength}`),new Proxy(this,{apply:(d,u,w)=>this.randomUUID(...w)})}},g=b;return g.default=b,c})();typeof Wt!="undefined"&&(Wt.exports=vt.default),typeof window!="undefined"&&(vt=vt.default)});import{fromFetch as ne}from"https://cdn.jsdelivr.net/npm/rxjs@7.5.6/fetch/+esm";import{switchMap as oe}from"https://cdn.jsdelivr.net/npm/rxjs@7.5.6/operators/+esm";var N=class{constructor(e){this.host=e.host,this.headers={"content-type":"application/json"}}fetch({path:e,method:t="GET",query:i,body:r}){return ne(this.host+e+this.getQuerystring(i),{method:t,headers:this.headers,body:r}).pipe(oe(a=>{if(a.ok)return a.json();throw Error(`Error ${a.status}`)}))}getQuerystring(e){if(!e)return"";let t=new URLSearchParams;return Object.entries(e).forEach(([i,r])=>{Array.isArray(r)?r.forEach(a=>t.append(i,a)):r&&t.append(i,r)}),"?"+t.toString()}get({path:e,query:t}){return this.fetch({method:"GET",path:e,query:t})}post({path:e,query:t,body:i}){return this.fetch({method:"POST",path:e,query:t,body:i?JSON.stringify(i):void 0})}put({path:e,query:t,body:i}){return this.fetch({method:"PUT",path:e,query:t,body:i?JSON.stringify(i):void 0})}delete({path:e,query:t,body:i}){return this.fetch({method:"DELETE",path:e,query:t,body:i?JSON.stringify(i):void 0})}};var Ct="4.0.0";var ht=gt(Nt());import{from as wt,lastValueFrom as bt}from"https://cdn.jsdelivr.net/npm/rxjs@7.5.6/+esm";var k=class extends N{constructor(t){var i,r,a;super(t);this.headers={"content-type":"application/json","x-appmate-shp":t.shop,"x-appmate-tkv":Ct,"x-appmate-sid":t.sessionId,"x-appmate-cid":(r=(i=t.customerId)==null?void 0:i.toString())!=null?r:"","x-appmate-src":(a=t.trackingSource)!=null?a:""},this.wishlistLoader=this.createWishlistLoader(),this.productInfoLoader=this.createProductInfoLoader(),this.wishlistItemLoader=this.createWishlistItemLoader()}createWishlistLoader(){return new ht.default(async t=>{let i=t.map(a=>a.split("-")).reduce((a,[n,o])=>(a[n]||(a[n]=[]),a[n].push(o),a),{}),r=await Promise.all(Object.entries(i).map(([a,n])=>bt(this.get({path:`/wishlists/${a}`,query:{format:n.includes("all")?"all":"minimal"}})))).then(a=>a.map(n=>n.wishlist));return t.map(a=>{var o;let[n]=a.split("-");return(o=r.find(c=>n==="mine"?c.isMine:c.publicId===n))!=null?o:new Error("Wishlist not found")})},{cache:!0,batchScheduleFn:t=>window.requestAnimationFrame(t)})}createProductInfoLoader(){return new ht.default(async t=>{let{productInfo:i}=await bt(this.get({path:"/wishlists/mine/product-info",query:{ids:t}}));return t.map(r=>{var a;return(a=i.find(n=>n.productId===r))!=null?a:{productId:r,wishlistItems:[]}})},{cache:!0,batchScheduleFn:t=>window.requestAnimationFrame(t)})}createWishlistItemLoader(){return new ht.default(async t=>{let i=t.map(a=>a.split("-")).reduce((a,[n,o])=>(a[n]||(a[n]=[]),a[n].push(o),a),{}),r=await Promise.all(Object.entries(i).map(([a,n])=>bt(this.get({path:`/wishlists/${a}/items`,query:{ids:n}})))).then(a=>a.flatMap(n=>n.items));return t.map(a=>{var o;let[,n]=a.split("-");return(o=r.find(c=>c.id===n))!=null?o:new Error("Product not found")})},{cache:!0,batchScheduleFn:t=>setTimeout(t,100)})}loadWishlist({wishlistId:t,format:i}){return wt(this.wishlistLoader.load([t,i].join("-")).then(r=>({wishlist:r})))}loadProductInfo({productId:t}){return wt(this.productInfoLoader.load(t).then(i=>({productInfo:i})))}loadWishlistItem({wishlistId:t,itemId:i}){return wt(this.wishlistItemLoader.load([t,i].join("-")).then(r=>({wishlistItem:r})))}addItem({productId:t,variantId:i}){return typeof t=="string"&&(t=parseInt(t)),typeof i=="string"&&(i=parseInt(i)),this.post({path:"/wishlists/mine/items",body:{productId:t,variantId:i}})}updateItem({itemId:t,changes:i}){return this.put({path:`/wishlists/mine/items/${t}`,body:{changes:i}})}removeItem({wishlistId:t,itemId:i}){return this.delete({path:`/wishlists/${t}/items/${i}`})}clearWishlist(){return this.delete({path:"/wishlists/mine/items"})}};var q=class extends N{loadProduct({productHandle:e}){return this.get({path:`/products/${e}.js`})}addToCart(e){return this.post({path:"/cart/add.js",body:e})}};var R=class{constructor(e){this.element=e!=null?e:window.document.body}replace(e){return this.element.replaceWith(e),e}append(e){return this.element.append(e),e}prepend(e){return this.element.prepend(e),e}insertBefore(e){return this.element.before(e),e}insertAfter(e){return this.element.after(e),e}closest(e){let t=this.element.closest(e);return t?new R(t):null}find(e){let t=this.element.querySelector(e);return t?new R(t):null}};var $=class{constructor({routeUtil:e}){this.subscriber=[],this.routeUtil=e,this.observer=new MutationObserver(t=>{t.reduce((i,r)=>i.concat(Array.from(r.addedNodes)),[]).filter(i=>i instanceof Element&&!i.hasAttribute("data-appmate")).forEach(i=>this.scan(i))}),this.observer.observe(document.body,{subtree:!0,childList:!0,attributes:!1})}watch(e,t){if(!e.template&&e.handle)throw new Error("Template required when watching for handle.");let i={target:e,callback:t};this.subscriber.push(i),Lt(i,this.routeUtil.parse(window.location.pathname))&&this.scan(document.body)}scan(e){this.subscriber.filter(t=>Lt(t,this.routeUtil.parse(window.location.pathname))).forEach(t=>{e.matches(t.target.selector)&&this.notify(t,e),e.querySelectorAll(t.target.selector).forEach(i=>{this.notify(t,i)})})}notify(e,t){if(!t.hasAttribute("data-appmate")){t.setAttribute("data-appmate","");let i=new R(t);e.callback(i)}}};function Lt({target:s},e){return s.template?s.handle?s.handle===e.handle:e.template===s.template:!0}var qt=gt(Pt());import{catchError as ve,defer as S,forkJoin as Y,from as P,map as O,Observable as We,of as Pe,switchMap as j}from"https://cdn.jsdelivr.net/npm/rxjs@7.5.6/+esm";import{Dexie as xe,liveQuery as _e}from"https://cdn.jsdelivr.net/npm/dexie@3.2.2/+esm";var Et={};re(Et,{addProductToWishlistItem:()=>_t,filterWishlistItem:()=>Ut,findProductVariant:()=>St,findWishlistItem:()=>be,getSessionId:()=>pt,isWishlistItem:()=>At,loginRequired:()=>Ie,mapApiToCacheProductInfo:()=>L,mapApiToProductInfo:()=>G,mapApiToWishlist:()=>xt,mapApiToWishlistItem:()=>kt,mapApiToWishlistItemRef:()=>we});var Ot=gt(Pt()),ye=new Ot.default({length:10}),pt=()=>{if(localStorage.getItem("wk_session_id"))return localStorage.getItem("wk_session_id");let s=localStorage.getItem("appmate-session");if(s)try{let t=JSON.parse(s).state.sid;return localStorage.setItem("wk_session_id",t),t}catch(t){console.error(t)}let e=ye();return localStorage.setItem("wk_session_id",e),e},Ie=(s,e)=>!!s&&!e;function xt(s,e){return{id:s.isMine?"mine":s.id,publicId:s.publicId,isMine:s.isMine,numItems:s.numItems,items:e==="all"?s.items:void 0}}function G({productInfo:s,variantId:e}){let t=s.wishlistItems.find(i=>e?i.variantId===e:!0);return{productId:s.productId,variantId:e,inWishlist:!!t,wishlistItemId:t==null?void 0:t.id}}function L({productInfo:s}){let e=s.wishlistItems.map(t=>t.id);return{...s,wishlistItemIds:e.length?e:void 0}}function kt(s){return s}function we(s){return s}function _t(s,e){return{...s,product:e}}function be(s,e){var t;return(t=s.items)==null?void 0:t.find(i=>At(i,e))}function St(s,e){return s.variants.find(t=>t.id===e)}function At(s,e){return s.id===e.itemId}function Ut(s,e){return s==null?void 0:s.filter(t=>!At(t,e))}var Se=new qt.default({length:10}),K=class extends xe{constructor(){super("WishlistKing");this.version(1).stores({shopifyProducts:"handle",wishlists:"id",wishlistItems:"id",productInfo:"productId,*wishlistItemIds"})}storeShopifyProduct({product:t}){return P(S(()=>this.shopifyProducts.put(t)).pipe(O(()=>t)))}storeWishlist({wishlist:t}){return this.getWishlist({wishlistId:t.id}).pipe(ve(()=>Pe(null)),j(i=>{var r;return P(this.wishlists.put({...t,items:(r=t.items)!=null?r:i==null?void 0:i.items}))}),O(()=>t))}storeProductInfo({productInfo:t}){return P(S(()=>this.productInfo.put(L({productInfo:t}))))}storeWishlistItem({wishlistItem:t}){return P(S(()=>this.wishlistItems.put(t)))}getProductInfo({productId:t}){return P(S(()=>this.productInfo.get(t)))}getProductInfoByItemId({itemId:t}){return P(S(()=>this.productInfo.where("wishlistItemIds").equals(t).first()))}getProductInfos(){return P(S(()=>this.productInfo.toArray()))}getWishlist({wishlistId:t}){return P(S(()=>this.wishlists.get(t)))}getWishlistItems(){return P(S(()=>this.wishlistItems.toArray()))}getShopifyProduct({productHandle:t}){return P(S(()=>this.shopifyProducts.get(t)))}getWishlistItem({itemId:t}){return P(S(()=>this.wishlistItems.get(t)))}addItemToWishlist({productId:t,variantId:i}){return Y([this.getWishlist({wishlistId:"mine"}),this.getProductInfo({productId:t})]).pipe(j(([r,a])=>{let n={id:`temp-${Se()}`},o=Ae({wishlistId:"mine",item:n},r),c=()=>this.wishlists.put(o),h=()=>r?this.wishlists.put(r):this.wishlists.delete("mine"),l=()=>this.productInfo.put(L({productInfo:{productId:t,wishlistItems:a?[...a.wishlistItems,{id:n.id,variantId:i}]:[{id:n.id,variantId:i}]}})),m=()=>a?this.productInfo.put(a):this.productInfo.delete(t);return P(S(()=>this.transaction("rw",this.wishlists,this.productInfo,()=>Promise.all([c(),l()])))).pipe(O(()=>({wishlist:o,item:n,revertStateUpdate:()=>P(this.transaction("rw",this.wishlists,this.productInfo,()=>Promise.all([h(),m()])))})))}))}removeItemFromWishlist({itemId:t}){return Y([this.getWishlist({wishlistId:"mine"}),this.getProductInfoByItemId({itemId:t}),this.getWishlistItem({itemId:t})]).pipe(j(([i,r,a])=>{let n=Ue({itemId:t},i),o=()=>this.wishlists.put(n),c=()=>i?this.wishlists.put(i):this.wishlists.delete("mine"),h=()=>{if(r)return this.productInfo.put(L({productInfo:{productId:r.productId,wishlistItems:r.wishlistItems.filter(g=>g.id!==t)}}))},l=()=>{if(r)return this.productInfo.put(r)},m=()=>{if(a)return this.wishlistItems.delete(a.id)},b=()=>{if(a)return this.wishlistItems.put(a)};return P(S(()=>this.transaction("rw",this.wishlists,this.productInfo,this.wishlistItems,()=>Promise.all([o(),h(),m()])))).pipe(O(()=>({wishlist:n,revertStateUpdate:()=>P(this.transaction("rw",this.wishlists,this.productInfo,this.wishlistItems,()=>Promise.all([c(),l(),b()])))})))}))}clearWishlist(){return Y([this.getWishlist({wishlistId:"mine"}),this.getProductInfos(),this.getWishlistItems()]).pipe(j(([t,i,r])=>{let a=Ee(t),n=()=>{if(a)return this.wishlists.put(a)},o=()=>{var b;return t?this.wishlists.put(t):this.wishlists.delete((b=a==null?void 0:a.id)!=null?b:"mine")},c=()=>this.productInfo.clear(),h=()=>{if(i)return this.productInfo.bulkPut(i)},l=()=>this.wishlistItems.clear(),m=()=>{if(r)return this.wishlistItems.bulkPut(r)};return P(S(()=>this.transaction("rw",this.wishlists,this.productInfo,this.wishlistItems,()=>Promise.all([n(),c(),l()])))).pipe(O(()=>({wishlist:a,revertStateUpdate:()=>P(this.transaction("rw",this.wishlists,this.productInfo,this.wishlistItems,()=>Promise.all([o(),h(),m()])))})))}))}updateWishlistItem({itemId:t,changes:i}){return Y([this.getWishlistItem({itemId:t}),this.getProductInfoByItemId({itemId:t})]).pipe(j(([r,a])=>{let n=()=>{if(r)return this.wishlistItems.put({...r,selectedVariantId:i.variantId})},o=()=>{if(r)return this.wishlistItems.put(r)},c=()=>{if(a)return this.productInfo.put(L({productInfo:{...a,wishlistItems:a.wishlistItems.map(l=>l.id===t?{...l,variantId:i.variantId}:l)}}))},h=()=>{if(a)return this.productInfo.put(a)};return P(S(()=>this.transaction("rw",this.wishlistItems,this.productInfo,()=>Promise.all([n(),c()])))).pipe(O(()=>({revertStateUpdate:()=>P(this.transaction("rw",this.wishlistItems,this.productInfo,()=>Promise.all([o(),h()])))})))}))}changeWishlistItemRef({itemId:t,changes:i}){return Y([this.getWishlist({wishlistId:"mine"}),this.getProductInfoByItemId({itemId:t})]).pipe(j(([r,a])=>{let n={id:i.id},o=()=>{var h;if(r)return this.wishlists.put({...r,items:(h=r.items)==null?void 0:h.map(l=>l.id===t?n:l)})},c=()=>{if(a)return this.productInfo.put(L({productInfo:{...a,wishlistItems:a.wishlistItems.map(h=>h.id===t?{...h,id:i.id}:h)}}))};return P(Promise.all([o(),c()])).pipe(O(()=>({item:n})))}))}liveQuery(t){return new We(i=>{_e(t).subscribe({error:i.error.bind(i),next:i.next.bind(i),complete:i.complete.bind(i)})})}},Ae=(s,e)=>e?{...e,numItems:e.numItems+1,items:e.items?[...e.items,s.item]:[s.item]}:{id:s.wishlistId,publicId:void 0,isMine:!0,numItems:1,items:[s.item]},Ue=(s,e)=>e?{...e,numItems:e.numItems-1,items:e.items?Ut(e.items,s):[]}:{id:"mine",publicId:void 0,isMine:!0,numItems:0},Ee=s=>{if(!!s)return{...s,numItems:0,items:[]}};import{defer as $t,forkJoin as jt,from as Kt,of as D,throwError as Ce}from"https://cdn.jsdelivr.net/npm/rxjs@7.5.6/+esm";import{switchMap as W,map as x,catchError as M,mergeWith as ut,startWith as Tt,distinctUntilChanged as dt,shareReplay as mt,tap as Bt}from"https://cdn.jsdelivr.net/npm/rxjs@7.5.6/operators/+esm";import{pipe as Te,filter as Re}from"https://cdn.jsdelivr.net/npm/rxjs@7.5.6/+esm";function X(){return Te(Re(s=>s!=null))}var B=class{constructor({wishlistApi:e,shopifyApi:t,settings:i,events:r,utils:a}){this.cacheDb=new K;this.cacheDb.open(),this.wishlistApi=e,this.shopifyApi=t,this.settings=i,this.loadWishlistCache=new Map,this.loadWishlistItemCache=new Map,this.loadProductInfoCache=new Map,this.loadShopifyProductCache=new Map,this.events=r,this.utils=a}loadWishlist({wishlistId:e,format:t,strategy:i="network-only"}){let r=[e,t].join("-");if(!this.loadWishlistCache.has(r)){let n=this.wishlistApi.loadWishlist({wishlistId:e,format:t}),o=c=>this.cacheDb.storeWishlist({wishlist:c}).pipe(x(()=>xt(c,t)));this.loadWishlistCache.set(r,n.pipe(W(({wishlist:c})=>o(c)),mt()))}let a=this.loadWishlistCache.get(r);return i==="cache-first"?this.cacheDb.getWishlist({wishlistId:e}).pipe(W(n=>n?D(n):a)):a}observeWishlist({wishlistId:e,format:t}){let i=this.loadWishlist({wishlistId:e,format:t}),r=this.cacheDb.liveQuery(()=>this.cacheDb.wishlists.get(e)),a={id:e,isMine:e==="mine",numItems:0,items:void 0};return i.pipe(ut(r),Tt(t==="minimal"?a:null),X(),dt((n,o)=>JSON.stringify(n)===JSON.stringify(o)))}loadProductInfo({productId:e,variantId:t=0,strategy:i}){if(!this.loadProductInfoCache.has(e)){let a=this.wishlistApi.loadProductInfo({productId:e}),n=o=>this.cacheDb.storeProductInfo({productInfo:o}).pipe(x(()=>G({productInfo:o,variantId:t})));this.loadProductInfoCache.set(e,a.pipe(W(({productInfo:o})=>n(o)),mt()))}let r=this.loadProductInfoCache.get(e);return i==="cache-first"?this.cacheDb.getProductInfo({productId:e}).pipe(W(a=>a?D(G({productInfo:a,variantId:t})):r)):r}observeProductInfo({productId:e,variantId:t}){let i={productId:e,variantId:t,inWishlist:!1},r=this.loadProductInfo({productId:e}),a=this.cacheDb.liveQuery(()=>this.cacheDb.productInfo.get(e)).pipe(x(n=>n?G({productInfo:n,variantId:t}):void 0));return r.pipe(ut(a),X(),Tt(i),dt((n,o)=>JSON.stringify(n)===JSON.stringify(o)),M(n=>(console.error(n),D(i))))}loadWishlistItem({wishlistId:e,itemId:t,strategy:i}){let r=t;if(!this.loadWishlistItemCache.has(r)){let n=this.wishlistApi.loadWishlistItem({wishlistId:e,itemId:t}),o=c=>this.cacheDb.storeWishlistItem({wishlistItem:c}).pipe(x(()=>c));this.loadWishlistItemCache.set(r,n.pipe(W(({wishlistItem:c})=>o(c)),mt()))}let a=this.loadWishlistItemCache.get(r);return i==="cache-first"?this.cacheDb.getWishlistItem({itemId:t}).pipe(W(n=>n?D(n):a)):a}observeWishlistItem({wishlistId:e,itemId:t}){let i={id:t,product:{id:0,handle:""}},r=this.loadWishlistItem({wishlistId:e,itemId:t}),a=this.cacheDb.liveQuery(()=>this.cacheDb.wishlistItems.get(t)).pipe(x(o=>o?o:null)),n=o=>o.product.handle?this.observeShopifyProduct({productHandle:o.product.handle}).pipe(x(c=>_t(o,c))):D(o);return r.pipe(Tt(i),ut(a),X(),W(o=>n(o)),dt((o,c)=>JSON.stringify(o)===JSON.stringify(c)))}loadShopifyProduct({productHandle:e,strategy:t}){let i=e;if(!this.loadShopifyProductCache.has(i)){let a=this.shopifyApi.loadProduct({productHandle:e}),n=o=>this.cacheDb.storeShopifyProduct({product:o}).pipe(x(()=>o));this.loadShopifyProductCache.set(i,a.pipe(W(o=>n(o)),mt()))}let r=this.loadShopifyProductCache.get(i);return t==="cache-first"?this.cacheDb.getShopifyProduct({productHandle:e}).pipe(W(a=>a?D(a):r)):r}observeShopifyProduct({productHandle:e}){let t=this.loadShopifyProduct({productHandle:e}),i=this.cacheDb.liveQuery(()=>this.cacheDb.shopifyProducts.get(e));return t.pipe(ut(i),X(),dt((r,a)=>JSON.stringify(r)===JSON.stringify(a)))}loadWishlistProduct({wishlistId:e,itemId:t}){return this.loadWishlistItem({wishlistId:e,itemId:t}).pipe(W(i=>this.loadShopifyProduct({productHandle:i.product.handle})))}publishWishlistItemEvent({eventName:e,wishlistId:t,productHandle:i,variantId:r}){return jt([this.loadWishlist({wishlistId:t,format:"minimal",strategy:"cache-first"}),this.loadShopifyProduct({productHandle:i,strategy:"cache-first"})]).pipe(Bt(([a,n])=>this.events.publish({name:e,data:{wishlist:a,product:n,variant:St(n,r),quantity:1}})))}publishWishlistEvent({eventName:e,wishlistId:t}){return this.loadWishlist({wishlistId:t,format:"minimal",strategy:"cache-first"}).pipe(Bt(i=>this.events.publish({name:e,data:{wishlist:i}})))}addWishlistItem(e){let t=typeof e.productId=="string"?parseInt(e.productId):e.productId,i=typeof e.variantId=="string"?parseInt(e.variantId):e.variantId,r=this.cacheDb.addItemToWishlist({productId:t,variantId:i}),a=this.wishlistApi.addItem({productId:t,variantId:i});return r.pipe(W(({item:n,revertStateUpdate:o})=>a.pipe(W(({wishlistItem:c})=>jt([this.cacheDb.storeWishlistItem({wishlistItem:c}),this.cacheDb.changeWishlistItemRef({itemId:n.id,changes:{id:c.id}})]).pipe(x(()=>({wishlistItem:c})))),W(c=>this.publishWishlistItemEvent({wishlistId:"mine",eventName:"wishlist:add:success",productHandle:c.wishlistItem.product.handle,variantId:c.wishlistItem.selectedVariantId}).pipe(x(()=>c))),M(c=>(console.error(c),this.events.publish({name:"wishlist:add:error",error:c}),o())))))}updateWishlistItem(e){let t={variantId:typeof e.changes.variantId=="string"?parseInt(e.changes.variantId):e.changes.variantId},i=this.cacheDb.updateWishlistItem({itemId:e.itemId,changes:t}),r=this.wishlistApi.updateItem({itemId:e.itemId,changes:t});return i.pipe(W(({revertStateUpdate:a})=>r.pipe(W(n=>this.publishWishlistItemEvent({wishlistId:"mine",eventName:"wishlist:change-variant:success",productHandle:n.wishlistItem.product.handle,variantId:n.wishlistItem.selectedVariantId}).pipe(x(()=>n))),M(n=>(console.error(n),this.events.publish({name:"wishlist:change-variant:error",error:n}),a())))))}removeWishlistItem({itemId:e}){let t=this.cacheDb.removeItemFromWishlist({itemId:e}),i=this.wishlistApi.removeItem({wishlistId:"mine",itemId:e});return t.pipe(W(({wishlist:r,revertStateUpdate:a})=>i.pipe(x(({wishlistItem:n})=>({wishlist:r,wishlistItem:n})),W(n=>this.publishWishlistItemEvent({wishlistId:"mine",eventName:"wishlist:remove:success",productHandle:n.wishlistItem.product.handle,variantId:n.wishlistItem.selectedVariantId}).pipe(x(()=>n))),M(n=>(console.error(n),this.events.publish({name:"wishlist:remove:error",error:n}),a())))))}clearWishlist(){let e=this.cacheDb.clearWishlist(),t=this.wishlistApi.clearWishlist();return e.pipe(W(({revertStateUpdate:i})=>t.pipe(W(()=>this.publishWishlistEvent({wishlistId:"mine",eventName:"wishlist:clear:success"})),M(r=>(console.error(r),this.events.publish({name:"wishlist:clear:error",error:r}),i())))))}addToCart({wishlistId:e,wishlistItemId:t,variantId:i,quantity:r=1,sectionsToRender:a,sectionsUrl:n}){return this.shopifyApi.addToCart({id:i,quantity:r,sections:a,sections_url:n}).pipe(W(o=>this.loadWishlistItem({wishlistId:e,itemId:t}).pipe(x(c=>({wishlistItem:c,cartResponse:o})))),W(o=>this.publishWishlistItemEvent({wishlistId:"mine",eventName:"wishlist:add-to-cart:success",productHandle:o.wishlistItem.product.handle,variantId:o.wishlistItem.selectedVariantId}).pipe(x(()=>o))),M(o=>(this.events.publish({name:"wishlist:add-to-cart:error",error:o}),Ce(()=>o))),W(o=>this.settings.moveToCart?this.removeWishlistItem({itemId:t}).pipe(x(()=>o)):D(o)))}shareWishlist({wishlistId:e,title:t,text:i}){let r={url:this.utils.url.getPublicWishlistUrl(e),title:t,text:i},a=Kt($t(async()=>{try{await navigator.share(r)}catch(o){throw new Error("Web share api not available")}}).pipe(W(()=>this.publishWishlistEvent({wishlistId:e,eventName:"wishlist:share:success"})),x(()=>({webShare:!0,clipboard:!1})))),n=Kt($t(async()=>{try{await navigator.clipboard.writeText(r.url)}catch(o){throw new Error("Web clipboard api not available")}}).pipe(W(()=>this.publishWishlistEvent({wishlistId:e,eventName:"wishlist:share:success"})),x(()=>({webShare:!1,clipboard:!0}))));return a.pipe(M(()=>n.pipe(M(o=>(this.events.publish({name:"wishlist:share:error",error:o}),D({webShare:!1,clipboard:!1}))))))}getFormData(e){let t=new FormData(e),{wishlistId:i,itemId:r}=e.dataset;if(!i||!r)throw new Error("Required form attributes missing: data-wishlist-id, data-item-id");return this.loadWishlistProduct({wishlistId:i,itemId:r}).pipe(x(a=>({wishlistId:i,itemId:r,product:a,variant:this.utils.product.getFormVariant({formData:t,product:a}),quantity:t.get("quantity")||1})))}};function De(s){for(var e=[],t=0;t<s.length;){var i=s[t];if(i==="*"||i==="+"||i==="?"){e.push({type:"MODIFIER",index:t,value:s[t++]});continue}if(i==="\\"){e.push({type:"ESCAPED_CHAR",index:t++,value:s[t++]});continue}if(i==="{"){e.push({type:"OPEN",index:t,value:s[t++]});continue}if(i==="}"){e.push({type:"CLOSE",index:t,value:s[t++]});continue}if(i===":"){for(var r="",a=t+1;a<s.length;){var n=s.charCodeAt(a);if(n>=48&&n<=57||n>=65&&n<=90||n>=97&&n<=122||n===95){r+=s[a++];continue}break}if(!r)throw new TypeError("Missing parameter name at ".concat(t));e.push({type:"NAME",index:t,value:r}),t=a;continue}if(i==="("){var o=1,c="",a=t+1;if(s[a]==="?")throw new TypeError('Pattern cannot start with "?" at '.concat(a));for(;a<s.length;){if(s[a]==="\\"){c+=s[a++]+s[a++];continue}if(s[a]===")"){if(o--,o===0){a++;break}}else if(s[a]==="("&&(o++,s[a+1]!=="?"))throw new TypeError("Capturing groups are not allowed at ".concat(a));c+=s[a++]}if(o)throw new TypeError("Unbalanced pattern at ".concat(t));if(!c)throw new TypeError("Missing pattern at ".concat(t));e.push({type:"PATTERN",index:t,value:c}),t=a;continue}e.push({type:"CHAR",index:t,value:s[t++]})}return e.push({type:"END",index:t,value:""}),e}function Me(s,e){e===void 0&&(e={});for(var t=De(s),i=e.prefixes,r=i===void 0?"./":i,a="[^".concat(H(e.delimiter||"/#?"),"]+?"),n=[],o=0,c=0,h="",l=function(f){if(c<t.length&&t[c].type===f)return t[c++].value},m=function(f){var U=l(f);if(U!==void 0)return U;var E=t[c],J=E.type,Q=E.index;throw new TypeError("Unexpected ".concat(J," at ").concat(Q,", expected ").concat(f))},b=function(){for(var f="",U;U=l("CHAR")||l("ESCAPED_CHAR");)f+=U;return f};c<t.length;){var g=l("CHAR"),v=l("NAME"),y=l("PATTERN");if(v||y){var I=g||"";r.indexOf(I)===-1&&(h+=I,I=""),h&&(n.push(h),h=""),n.push({name:v||o++,prefix:I,suffix:"",pattern:y||a,modifier:l("MODIFIER")||""});continue}var _=g||l("ESCAPED_CHAR");if(_){h+=_;continue}h&&(n.push(h),h="");var F=l("OPEN");if(F){var I=b(),d=l("NAME")||"",u=l("PATTERN")||"",w=b();m("CLOSE"),n.push({name:d||(u?o++:""),pattern:d&&!u?a:u,prefix:I,suffix:w,modifier:l("MODIFIER")||""});continue}m("END")}return n}function T(s,e){var t=[],i=Vt(s,t,e);return Fe(i,t,e)}function Fe(s,e,t){t===void 0&&(t={});var i=t.decode,r=i===void 0?function(a){return a}:i;return function(a){var n=s.exec(a);if(!n)return!1;for(var o=n[0],c=n.index,h=Object.create(null),l=function(b){if(n[b]===void 0)return"continue";var g=e[b-1];g.modifier==="*"||g.modifier==="+"?h[g.name]=n[b].split(g.prefix+g.suffix).map(function(v){return r(v,g)}):h[g.name]=r(n[b],g)},m=1;m<n.length;m++)l(m);return{path:o,index:c,params:h}}}function H(s){return s.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function Ht(s){return s&&s.sensitive?"":"i"}function Ne(s,e){if(!e)return s;for(var t=/\((?:\?<(.*?)>)?(?!\?)/g,i=0,r=t.exec(s.source);r;)e.push({name:r[1]||i++,prefix:"",suffix:"",modifier:"",pattern:""}),r=t.exec(s.source);return s}function Le(s,e,t){var i=s.map(function(r){return Vt(r,e,t).source});return new RegExp("(?:".concat(i.join("|"),")"),Ht(t))}function Oe(s,e,t){return ke(Me(s,t),e,t)}function ke(s,e,t){t===void 0&&(t={});for(var i=t.strict,r=i===void 0?!1:i,a=t.start,n=a===void 0?!0:a,o=t.end,c=o===void 0?!0:o,h=t.encode,l=h===void 0?function(Q){return Q}:h,m=t.delimiter,b=m===void 0?"/#?":m,g=t.endsWith,v=g===void 0?"":g,y="[".concat(H(v),"]|$"),I="[".concat(H(b),"]"),_=n?"^":"",F=0,d=s;F<d.length;F++){var u=d[F];if(typeof u=="string")_+=H(l(u));else{var w=H(l(u.prefix)),f=H(l(u.suffix));if(u.pattern)if(e&&e.push(u),w||f)if(u.modifier==="+"||u.modifier==="*"){var U=u.modifier==="*"?"?":"";_+="(?:".concat(w,"((?:").concat(u.pattern,")(?:").concat(f).concat(w,"(?:").concat(u.pattern,"))*)").concat(f,")").concat(U)}else _+="(?:".concat(w,"(").concat(u.pattern,")").concat(f,")").concat(u.modifier);else u.modifier==="+"||u.modifier==="*"?_+="((?:".concat(u.pattern,")").concat(u.modifier,")"):_+="(".concat(u.pattern,")").concat(u.modifier);else _+="(?:".concat(w).concat(f,")").concat(u.modifier)}}if(c)r||(_+="".concat(I,"?")),_+=t.endsWith?"(?=".concat(y,")"):"$";else{var E=s[s.length-1],J=typeof E=="string"?I.indexOf(E[E.length-1])>-1:E===void 0;r||(_+="(?:".concat(I,"(?=").concat(y,"))?")),J||(_+="(?=".concat(I,"|").concat(y,")"))}return new RegExp(_,Ht(t))}function Vt(s,e,t){return s instanceof RegExp?Ne(s,e):Array.isArray(s)?Le(s,e,t):Oe(s,e,t)}var C={isHome:T("/:locale?/"),isCollection:T("/:locale?/collections/:collection"),isProduct:T("/:locale?/products/:product"),isNestedProduct:T("/:locale?/collections/:collection?/products/:product"),isPage:T("/:locale?/pages/:page/:rest?"),isAccount:T("/:locale?/account/:account?"),isBlog:T("/:locale?/blog/:blog?"),isCart:T("/:locale?/cart/:cart?"),isProxy:T("/:locale?/apps/(.*)")},qe=[{template:"product",match:s=>C.isProduct(s)||C.isNestedProduct(s)},{template:"collection",match:s=>C.isCollection(s)},{template:"page",match:s=>C.isPage(s)},{template:"account",match:s=>C.isAccount(s)},{template:"blog",match:s=>C.isBlog(s)},{template:"cart",match:s=>C.isCart(s)},{template:"home",match:s=>C.isHome(s)},{template:"proxy",match:s=>C.isProxy(s)}],Z=class{constructor({wishlistUrl:e}){this.wishlistUrl=e}parse(e){for(let t of qe){let i=t.match(e);if(i)return e.startsWith(this.wishlistUrl)?{template:"wishlist",handle:i.params.page}:{template:t.template,handle:i.params.page}}return{template:void 0}}};var z=class{constructor(e){this.locale=this.decodeLocale(e.locale)}decodeHtmlEntities(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&#39;/g,"'")}decodeLocale(e){let t={};for(let i in e){t[i]={};for(let r in e[i])t[i][r]=this.decodeHtmlEntities(e[i][r])}return t}translate(e){var r,a;let[t,i]=e.split(".");return(a=(r=this.locale[t])==null?void 0:r[i])!=null?a:`translation missing: ${e}`}};var $e="${{amount}}";function Jt(s,e){typeof s=="string"&&(s=s.replace(".",""));let t="",i=/\{\{\s*(\w+)\s*\}\}/,r=e||$e;function a(n,o=2,c=",",h="."){if(isNaN(n)||n==null)return 0;n=(n/100).toFixed(o);let l=n.split("."),m=l[0].replace(/(\d)(?=(\d\d\d)+(?!\d))/g,`$1${c}`),b=l[1]?h+l[1]:"";return m+b}switch(r.match(i)[1]){case"amount":t=a(s,2);break;case"amount_no_decimals":t=a(s,0);break;case"amount_with_comma_separator":t=a(s,2,".",",");break;case"amount_no_decimals_with_comma_separator":t=a(s,0,".",",");break}return r.replace(i,t)}var tt=class{constructor(e){this.moneyFormat=e.moneyFormat,this.currencyRate=e.currencyRate,this.activeCurrency=e.activeCurrency}formatMoney(e){return typeof e=="string"&&(e=parseFloat(e)),Jt(e,this.moneyFormat)}};var et=class{constructor(e){this.rootUrl=e.rootUrl,this.shopDomain=e.shopDomain,this.wishlistUrl=e.wishlistUrl,this.placeholderImageUrl=e.placeholderImageUrl}getWishlistIdFromUrl(e){let t=e.split("/");return t.length===4?t.pop():"mine"}getPublicWishlistUrl(e){return`https://${this.shopDomain}${this.wishlistUrl}/${e}`}getImageUrl(e,t){var r;let i=this.getImage(e);return i!=null&&i.src?this.appendSize(i.src,t):(r=this.placeholderImageUrl)!=null?r:""}getImage(e){var t,i,r,a,n;if(e.hasOwnProperty("sku"))return{src:(i=(t=e.featured_image)==null?void 0:t.src)!=null?i:""};if(e!=null&&e.selected_or_first_available_variant){let o=e;return(r=o.selected_or_first_available_variant)!=null&&r.featured_image?this.getImage(o.selected_or_first_available_variant):{src:(a=o.featured_image)!=null?a:o.images[0]}}else if(e!=null&&e.images.length){let o=e;return{src:(n=o.featured_image)!=null?n:o.images[0]}}else if(e.hasOwnProperty("src"))return{src:e.src};return null}appendSize(e,t){let i=new URL(e.startsWith("//")?`https://${e}`:e);return t!=null&&t.width&&i.searchParams.set("width",t==null?void 0:t.width.toString()),t!=null&&t.height&&i.searchParams.set("height",t==null?void 0:t.height.toString()),i.href}getVariantUrl(e,t){if(!!e)return t?this.prependRootUrl(e+`?variant=${t}`):this.prependRootUrl(e)}prependRootUrl(e){return e.startsWith("/")?this.rootUrl+e.substring(1):this.rootUrl+e}};var it=class{constructor(){}getOptionsWithValues({product:e,selectedOptions:t}){return e.options.map(i=>({...i,selected_value:t[`option${i.position}`],soldout_values:e.variants.filter(r=>!r.available).map(r=>r[`option${i.position}`]).filter((r,a,n)=>!!r&&n.indexOf(r)===a)}))}getFormVariant({formData:e,product:t}){var r;let i=Array.from(e.entries()).reduce((a,[n,o])=>{var l;let c=(l=n.match(/\[(.*?)\]/))==null?void 0:l[1];if(!c)return a;let h=t.options.findIndex(m=>m.name===c);return h!==-1&&(a[h]=o.toString()),a},new Array(3).fill(null));return(r=t.variants.find(a=>{var n,o;return i[0]?i.every((c,h)=>a[`option${h+1}`]===c):a.id===parseInt((o=(n=e.get("id"))==null?void 0:n.toString())!=null?o:"")}))!=null?r:t.variants[0]}};import{forkJoin as Ve,lastValueFrom as Je}from"https://cdn.jsdelivr.net/npm/rxjs@7.5.6/+esm";import{catchError as Ke,map as Be,of as Qt}from"https://cdn.jsdelivr.net/npm/rxjs@7.5.6/+esm";import{fromFetch as He}from"https://cdn.jsdelivr.net/npm/rxjs@7.5.6/fetch/+esm";var st=class{constructor({host:e,shop:t,sessionId:i,customerId:r}){this.host=e,this.shop=t,this.customerId=r,this.sessionId=i,this.eventNames=new Map([["viewWishlist","wishlist_viewed"],["addToCart","product_added_to_cart"],["shareWishlist","wishlist_shared"]])}track({eventName:e,wishlist:t,product:i,variant:r,quantity:a,source:n}){var c,h;let o=this.eventNames.get(e);return!o||!t?Qt(!1):He(this.host+`/track/${o}`,{method:"POST",headers:{"content-type":"application/json","x-appmate-shp":this.shop,"x-appmate-sid":this.sessionId,"x-appmate-cid":(h=(c=this.customerId)==null?void 0:c.toString())!=null?h:""},body:JSON.stringify({wid:t.publicId,pid:i==null?void 0:i.id,vid:r==null?void 0:r.id,qty:a,src:n})}).pipe(Be(()=>!0),Ke(()=>Qt(!1)))}};import{of as Gt}from"https://cdn.jsdelivr.net/npm/rxjs@7.5.6/+esm";var{ga:rt}=window,at=class{constructor(){this.eventNames=new Map([["addToWishlist","WK Added Product"],["removeFromWishlist","WK Removed Product"],["addToCart","WK Added to Cart"],["shareWishlist","WK Shared Wishlist"],["clearWishlist","WK Cleared Wishlist"]])}track({eventName:e,product:t,variant:i,quantity:r=1}){var n;let a=this.eventNames.get(e);return!a||!(rt!=null&&rt.loaded)||!t?Gt(!1):(rt("ec:addProduct",{id:(n=(i==null?void 0:i.sku)||(i==null?void 0:i.id))!=null?n:t.id,name:t.title,category:t.type,brand:t.vendor,variant:i==null?void 0:i.title,quantity:r}),rt("send",{eventAction:a,hitType:"event",eventCategory:"Wishlist",eventLabel:"Wishlist King"}),Gt(!0))}};import{of as Yt}from"https://cdn.jsdelivr.net/npm/rxjs@7.5.6/+esm";var nt=class{constructor({urlUtil:e,moneyUtil:t}){this.urlUtil=e,this.moneyUtil=t,this.eventNames=new Map([["addToWishlist","Added To Wishlist"],["removeFromWishlist","Removed From Wishlist"],["clearWishlist","Cleared Wishlist"]])}track({eventName:e,wishlist:t,product:i,variant:r,quantity:a=1}){let n=this.eventNames.get(e);return!n||!t||!i?Yt(!1):(window._learnq||(window._learnq=[]),window._learnq.push(["track",n,{URL:this.urlUtil.getVariantUrl(i.url,r==null?void 0:r.id),Name:i.title,ProductID:i.id,VariantID:r==null?void 0:r.id,SKU:r==null?void 0:r.sku,Tags:i.tags,Brand:i.vendor,ImageURL:this.urlUtil.getImageUrl(i,{width:1e3}),Price:r==null?void 0:r.price,PriceFormatted:r?this.moneyUtil.formatMoney(r.price):null,CompareAtPrice:r==null?void 0:r.compare_at_price,CompareAtPriceFormatted:r!=null&&r.compare_at_price?this.moneyUtil.formatMoney(r.compare_at_price):null,Quantity:a,WishlistUrl:this.urlUtil.getPublicWishlistUrl(t.id)}]),Yt(!0))}};import{of as Xt}from"https://cdn.jsdelivr.net/npm/rxjs@7.5.6/+esm";var{fbq:Zt}=window,ot=class{constructor({currency:e}){this.currency=e,this.eventNames=new Map([["addToWishlist","AddToWishlist"]])}track({eventName:e,product:t,variant:i}){let r=this.eventNames.get(e);return!r||typeof Zt!="function"||!t?Xt(!1):(Zt("track",r,{value:i==null?void 0:i.price,currency:this.currency,content_ids:[t.id],content_name:[t.title,i==null?void 0:i.title].filter(a=>!!a).join(" - "),content_category:t.type,content_type:"product_group",num_items:1}),Xt(!0))}};var lt=class{constructor({settings:e,events:t,appmateAnalyticsHost:i,utils:r,shop:a,sessionId:n,customerId:o}){this.utils=r,this.services=[],e.appmateAnalytics&&this.services.push(new st({host:i,shop:a,customerId:o,sessionId:n})),e.klaviyo&&this.services.push(new nt({urlUtil:this.utils.url,moneyUtil:this.utils.money})),e.facebookPixel&&this.services.push(new ot({currency:window.Shopify.currency.active})),e.googleAnalytics&&this.services.push(new at);let c=this.utils.route.parse(window.location.pathname).template,h=l=>m=>{var b,g,v,y;return Je(this.track({eventName:l,source:c,wishlist:(b=m.data)==null?void 0:b.wishlist,product:(g=m.data)==null?void 0:g.product,variant:(v=m.data)==null?void 0:v.variant,quantity:(y=m.data)==null?void 0:y.quantity}))};t.subscribeMany({"wishlist:add-to-cart:success":h("addToCart"),"wishlist:add:success":h("addToWishlist"),"wishlist:change-variant:success":h("changeVariant"),"wishlist:clear:success":h("clearWishlist"),"wishlist:remove:success":h("removeFromWishlist"),"wishlist:share:success":h("shareWishlist"),"wishlist:page-view":h("viewWishlist")})}track(e){return Ve(this.services.map(t=>t.track(e)))}};import{fromEvent as Qe,map as Ge}from"https://cdn.jsdelivr.net/npm/rxjs@7.5.6/+esm";var ct=class{constructor(){this.dispatcher=document}publish(e){this.dispatcher.dispatchEvent(new CustomEvent(e.name,{detail:e,bubbles:!1,cancelable:!1}))}subscribe(e,t){return Qe(this.dispatcher,e).pipe(Ge(i=>{let r=i;return{name:r.type,data:r.detail.data}})).subscribe(t)}subscribeMany(e){return Object.entries(e).map(([t,i])=>this.subscribe(t,i))}};import{lastValueFrom as A}from"https://cdn.jsdelivr.net/npm/rxjs@7.5.6/+esm";var p=class{static init({settings:e,stylesheets:t,...i}){var o,c,h;let r=Ye(i);p.settings=e,p.shop=r.shop,p.events=new ct,p.routes=Xe({rootUrl:r.routes.rootUrl,wishlistPath:(o=e.wishlistPath)!=null?o:"/apps/wishlist"}),p.customer=r.customer.id?{id:r.customer.id,email:r.customer.email}:null,p.utils=Ze({shopDomain:r.shop.domain,placeholderImageUrl:r.products.fallbackImage,moneyFormat:r.shop.moneyFormat,locale:r.locale}),p.observer=new $({routeUtil:p.utils.route}),p.api={wishlist:new k({host:r.routes.apiHost,shop:window.Shopify.shop,customerId:(c=r.customer.id)!=null?c:void 0,sessionId:pt(),trackingSource:p.utils.route.parse(window.location.pathname).template}),shopify:new q({host:window.Shopify.routes.root.substring(0,window.Shopify.routes.root.length-1)}),tracking:new lt({appmateAnalyticsHost:r.routes.apiHost,events:p.events,shop:window.Shopify.shop,customerId:(h=r.customer.id)!=null?h:void 0,sessionId:pt(),utils:p.utils,settings:e})},p.rx=new B({wishlistApi:p.api.wishlist,shopifyApi:p.api.shopify,settings:p.settings,events:p.events,utils:p.utils}),p.addToCart=(...l)=>A(p.rx.addToCart(...l)),p.addWishlistItem=(...l)=>A(p.rx.addWishlistItem(...l)),p.clearWishlist=(...l)=>A(p.rx.clearWishlist(...l)),p.getFormData=(...l)=>A(p.rx.getFormData(...l)),p.loadProductInfo=(...l)=>A(p.rx.loadProductInfo(...l)),p.loadShopifyProduct=(...l)=>A(p.rx.loadShopifyProduct(...l)),p.loadWishlist=(...l)=>A(p.rx.loadWishlist(...l)),p.loadWishlistItem=(...l)=>A(p.rx.loadWishlistItem(...l)),p.loadWishlistProduct=(...l)=>A(p.rx.loadWishlistProduct(...l)),p.publishWishlistEvent=(...l)=>A(p.rx.publishWishlistEvent(...l)),p.publishWishlistItemEvent=(...l)=>A(p.rx.publishWishlistItemEvent(...l)),p.removeWishlistItem=(...l)=>A(p.rx.removeWishlistItem(...l)),p.shareWishlist=(...l)=>A(p.rx.shareWishlist(...l)),p.updateWishlistItem=(...l)=>A(p.rx.updateWishlistItem(...l));let a=()=>{p.stylesLoaded=!0,p.events.publish({name:"wishlist:load-styles:success"})};t!=null&&t.length?Promise.all(t.map(l=>new Promise((m,b)=>{let g=document.createElement("link");g.rel="stylesheet",g.href=l,g.onload=m,g.onerror=b,document.head.appendChild(g)}))).then(()=>{a()}).catch(l=>{console.warn(l),p.events.publish({name:"wishlist:load-styles:error"})}):a();let n=p.utils.route.parse(window.location.pathname).template;n!=null&&n.includes("wishlist")&&p.publishWishlistEvent({eventName:"wishlist:page-view",wishlistId:p.utils.url.getWishlistIdFromUrl(window.location.pathname)})}static createComponent(e,t){let i=document.createElement(e);return Object.entries(t!=null?t:{}).forEach(([r,a])=>{i.dataset[r]=a}),i}static createElement(e,t={},...i){let r=Object.assign(document.createElement(e),t);return i&&r.append(...i),r}},V=p;V.stylesLoaded=!1;var Ye=({config:s})=>{var e,t,i,r,a,n,o,c,h;return{customer:{id:s.customerId?parseInt(s.customerId):null,email:(e=s.customerEmail)!=null?e:""},shop:{name:(t=s.shopName)!=null?t:"",domain:(i=s.shopDomain)!=null?i:"",permanentDomain:(r=s.shopPermanentDomain)!=null?r:"",currency:(a=s.shopCurrency)!=null?a:"",moneyFormat:(n=s.shopMoneyFormat)!=null?n:"",customerAccountsEnabled:s.shopCustomerAccountsEnabled?s.shopCustomerAccountsEnabled==="true":!1},routes:{apiHost:(o=s.apiHost)!=null?o:"https://api.appmate.io/v2",rootUrl:(c=s.rootUrl)!=null?c:"//cdn.shopify.com/s/files/1/0533/2089/files/placeholder-images-image_large.png?format=webp&v=1530129081"},products:{fallbackImage:(h=s.productFallbackImage)!=null?h:""},locale:s.localeJson?JSON.parse(s.localeJson):{}}},Xe=({rootUrl:s,wishlistPath:e})=>({rootUrl:s,wishlistUrl:s+e.split("/").filter(t=>!!t).join("/"),accountUrl:s+"account",accountLoginUrl:s+"account/login",accountLogoutUrl:s+"account/logout",accountRegisterUrl:s+"account/register",accountAddressesUrl:s+"account/addresses",collectionsUrl:s+"collections",allProductsCollectionUrl:s+"collections/all",searchUrl:s+"search",predictiveSearchUrl:s+"search/suggest",cartUrl:s+"cart",cartAddUrl:s+"cart/add",cartChangeUrl:s+"cart/change",cartClearUrl:s+"cart/clear",cartUpdateUrl:s+"cart/update",productRecommendationsUrl:s+"recommendations/products"}),Ze=({shopDomain:s,placeholderImageUrl:e,moneyFormat:t,locale:i})=>({url:new et({rootUrl:window.Shopify.routes.root,wishlistUrl:V.routes.wishlistUrl,shopDomain:s,placeholderImageUrl:e}),money:new tt({moneyFormat:t,currencyRate:parseFloat(window.Shopify.currency.rate),activeCurrency:window.Shopify.currency.active}),product:new it,locale:new z({locale:i}),route:new Z({wishlistUrl:V.routes.wishlistUrl})});window.WishlistKing||(window.WishlistKing=V);export{V as WishlistKing};
